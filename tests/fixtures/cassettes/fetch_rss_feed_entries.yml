interactions:
- request:
    body: ''
    headers:
      accept:
      - '*/*'
      accept-encoding:
      - gzip, deflate
      connection:
      - keep-alive
      host:
      - alexwlchan.net
      user-agent:
      - python-httpx/0.26.0
    method: GET
    uri: https://alexwlchan.net/atom.xml
  response:
    content: "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<feed xmlns=\"http://www.w3.org/2005/Atom\"
      xml:lang=\"en\">\n  <generator uri=\"https://jekyllrb.com/\" version=\"4.3.3\">Jekyll</generator>\n
      \ <updated>2024-04-24T07:32:38+00:00</updated>\n  <author>\n    <name>Alex Chan</name>\n
      \   <email>alex@alexwlchan.net</email>\n  </author>\n  <link href=\"https://alexwlchan.net/atom.xml\"
      rel=\"self\" type=\"application/atom+xml\"/>\n  <link href=\"https://alexwlchan.net/\"
      rel=\"alternate\" type=\"text/html\"/>\n  <id>https://alexwlchan.net/</id>\n
      \ <title type=\"html\">alexwlchan</title>\n  <subtitle>Alex Chan's personal
      website</subtitle>\n  <entry>\n    <title type=\"html\">Taking regular screenshots
      of my website</title>\n    <link href=\"https://alexwlchan.net/2024/scheduled-screenshots/\"
      rel=\"alternate\" type=\"text/html\" title=\"Taking regular screenshots of my
      website\"/>\n    <published>2024-04-23T08:16:35+00:00</published>\n    <updated>2024-04-23T08:16:35+00:00</updated>\n
      \   <id>https://alexwlchan.net/2024/scheduled-screenshots</id>\n    <content
      type=\"html\" xml:base=\"https://alexwlchan.net/2024/scheduled-screenshots/\"><![CDATA[\n<p>A
      few weeks ago I was reading the <a href=\"https://www.dpconline.org/digipres/champion-digital-preservation/bit-list\"><abbr
      title=\"Digital Preservation Coalition\">DPC</abbr> Bit List</a>, an inventory
      of digital materials and the risks associated with their long-term preservation.\nWhat
      formats need urgent attention before they\u2019re lost forever, what mediums
      are already being well-preserved, and so on.\nFor example, Adobe Flash animations
      are \u201Cpractically extinct\u201D, while emails are merely \u201Cendangered\u201D.</p>\n\n<p>Something
      that struck me is how the Bit List treats the content and interface of online
      services as two separate concerns.\nMost preservation efforts focus on saving
      the <em>content</em> \u2013 the photos, videos, and text that we upload to the
      web.\nWe don\u2019t have as many records of the <em>interfaces</em> \u2013 the
      \u201Clook and feel\u201D of these sites.\nBut if you only save one and not
      the other, you\u2019re losing a lot of important context about how we use those
      sites, and the influence of their designs.</p>\n\n<p>One present-day example
      is TikTok.\nIt popularised the use of vertical swiping to move between videos,
      and that design makes it easy for users to watch a continuous stream of content.\nIt\u2019s
      very effective at keeping people in the app, and it\u2019s been copied by lots
      of other services.\nAlthough it seems well-known and obvious to us today, it\u2019ll
      be easy to forget the novelty and impact of this idea as social media continues
      to evolve.</p>\n\n<p>This user interface is behind concerns about the addictive
      nature of TikTok, because it requires minimal effort to stay in the app and
      watch another video.\nIt\u2019s also affected how videos are made, because creators
      need to capture your attention quickly before you swipe to watch something else.\nPopular
      videos on TikTok look different to those on YouTube, on television, or in cinema.</p>\n\n<p>You
      can\u2019t understand TikTok or its effect on the world without understanding
      this interface.\nWatching a single TikTok video in an isolated player isn\u2019t
      the same as experiencing it in the app.</p>\n\n<p>This distinction between content
      and interfaces got me thinking about how you preserve user interfaces.\nOne
      challenge is that most user interfaces don\u2019t have a single version.\nDesigns
      are constantly changing as companies add features, fix bugs, and try to find
      new ways to get more of our attention.\nEven if you put aside the technical
      issues, we can only really preserve snapshots of how a service looked at a particular
      point in time.</p>\n\n<p>One way to create these snapshots is with <a href=\"/2022/screenshots/\">screenshots
      or screen recordings</a>.\nI think they represent a good tradeoff of effort
      and preservation value.\nA static screenshot isn\u2019t as complete as a fully
      interactive, working copy of a thing, but it\u2019s much easier to create, to
      preserve, and to access later.\nIt records the look, if not the feel.</p>\n\n<p>I
      was mulling over this for a while, and I had an idea.\nI like having a set of
      screenshots as a visual history of the stuff I\u2019ve worked on (including
      this site), but I\u2019m not very good at remembering to create them.\nI just
      finished a bunch of design tweaking on this site, and I completely forgot to
      take a screenshot of what it looked like before I started making changes.</p>\n\n<p>Computers
      are pretty good at doing things on a repetitive schedule \u2013 wouldn\u2019t
      it be nice if I could automate taking these screenshots?\nWhat if a computer
      took a screenshot of my website every month?\nOr every week?\nOr every day?</p>\n\n<hr>\n\n<p>I
      already had a vague idea of how to take screenshots programatically.\nAt my
      last job we used <a href=\"https://playwright.dev/\">Playwright</a> as a way
      to do end-to-end testing of our websites.\nPlaywright is a library for automating
      web browsers \u2013 for example, you can use it to open a website in Chromium,
      click buttons, check the page loads correctly, and so on.</p>\n\n<p>It can also
      take a screenshot of a web page, like so:</p>\n\n<div class=\"language-console
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>npm <span class=\"nb\">install
      </span>playwright\n<span class=\"gp\">$</span><span class=\"w\"> </span>npx
      playwright <span class=\"nb\">install </span>chromium\n<span class=\"gp\">$</span><span
      class=\"w\"> </span>npx playwright screenshot <span class=\"nt\">--full-page</span>
      <span class=\"s2\">\"alexwlchan.net\"</span> <span class=\"s2\">\"screenshot.png\"</span>\n</code></pre></div></div>\n\n<p>This
      installs Playwright, then opens my website in Chromium and takes a screenshot
      of the page.\nThe <code class=\"language-plaintext highlighter-rouge\">--full-page</code>
      flag ensures the image contains the entire scrollable page, as if you had a
      tall screen and could fit the whole page in view without scrolling.</p>\n\n<p>Once
      I knew how to take a screenshot once, I wanted to do it on a regular schedule,
      and save those images somewhere.\nThere are lots of ways to run code on a schedule;
      I decided to use <a href=\"https://github.com/features/actions\">GitHub Actions</a>
      because it\u2019s what I\u2019m familiar with.</p>\n\n<p>My code for taking
      scheduled screenshots is entirely contained in a single GitHub Actions workflow.\nIt\u2019s
      in a file called <a href=\"https://github.com/alexwlchan/scheduled-screenshots/blob/a5c836cfcc6a3729fe53db97b34d116949fba377/.github/workflows/take_screenshots.yml\"><code
      class=\"language-plaintext highlighter-rouge\">.github/workflows/take_screenshots.yml</code></a>,
      and it\u2019s only 79 lines:</p>\n\n<div class=\"language-yaml highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"na\">name</span><span
      class=\"pi\">:</span> <span class=\"s\">Take screenshots</span>\n\n<span class=\"na\">on</span><span
      class=\"pi\">:</span>\n  <span class=\"na\">push</span><span class=\"pi\">:</span>\n
      \   <span class=\"na\">branches</span><span class=\"pi\">:</span>\n      <span
      class=\"pi\">-</span> <span class=\"s\">main</span>\n\n  <span class=\"na\">schedule</span><span
      class=\"pi\">:</span>\n    <span class=\"pi\">-</span> <span class=\"na\">cron</span><span
      class=\"pi\">:</span> <span class=\"s1\">'</span><span class=\"s\">7</span><span
      class=\"nv\"> </span><span class=\"s\">7</span><span class=\"nv\"> </span><span
      class=\"s\">*</span><span class=\"nv\"> </span><span class=\"s\">*</span><span
      class=\"nv\"> </span><span class=\"s\">1'</span>  <span class=\"c1\"># Every
      Monday at 7:07am UTC</span>\n\n<span class=\"na\">jobs</span><span class=\"pi\">:</span>\n
      \ <span class=\"na\">take-screenshots</span><span class=\"pi\">:</span>\n    <span
      class=\"na\">runs-on</span><span class=\"pi\">:</span> <span class=\"s\">macos-latest</span>\n\n
      \   <span class=\"na\">strategy</span><span class=\"pi\">:</span>\n      <span
      class=\"na\">matrix</span><span class=\"pi\">:</span>\n        <span class=\"na\">include</span><span
      class=\"pi\">:</span>\n          <span class=\"pi\">-</span> <span class=\"na\">url</span><span
      class=\"pi\">:</span> <span class=\"s\">alexwlchan.net</span>\n            <span
      class=\"na\">filename_prefix</span><span class=\"pi\">:</span> <span class=\"s\">alexwlchan.net</span>\n
      \         <span class=\"pi\">-</span> <span class=\"na\">url</span><span class=\"pi\">:</span>
      <span class=\"s\">books.alexwlchan.net</span>\n            <span class=\"na\">filename_prefix</span><span
      class=\"pi\">:</span> <span class=\"s\">books</span>\n\n      <span class=\"c1\">#
      Setting max-parallel ensures that these jobs will run in serial,</span>\n      <span
      class=\"c1\"># not parallel, so we don't have conflicting tasks trying to</span>\n
      \     <span class=\"c1\"># push new commits.</span>\n      <span class=\"na\">max-parallel</span><span
      class=\"pi\">:</span> <span class=\"m\">1</span>\n\n    <span class=\"na\">steps</span><span
      class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span
      class=\"pi\">:</span> <span class=\"s\">Checkout repository</span>\n        <span
      class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/checkout@v4</span>\n\n
      \       <span class=\"na\">with</span><span class=\"pi\">:</span>\n          <span
      class=\"c1\"># Check out the latest version of main, which may not be the</span>\n
      \         <span class=\"c1\"># commit that triggered this event -- jobs in this
      workflow will</span>\n          <span class=\"c1\"># push new commits and update
      main, and we want each job to</span>\n          <span class=\"c1\"># get the
      latest code from main.</span>\n          <span class=\"na\">ref</span><span
      class=\"pi\">:</span> <span class=\"s\">main</span>\n\n          <span class=\"c1\">#
      Make sure we don't download the existing screenshots as part</span>\n          <span
      class=\"c1\"># of this process -- this Action is strictly append-only, so</span>\n
      \         <span class=\"c1\"># don't waste limited LFS bandwidth on it.</span>\n
      \         <span class=\"na\">lfs</span><span class=\"pi\">:</span> <span class=\"kc\">false</span>\n\n
      \     <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span>
      <span class=\"s\">Install Node.js</span>\n        <span class=\"na\">uses</span><span
      class=\"pi\">:</span> <span class=\"s\">actions/setup-node@v4</span>\n        <span
      class=\"na\">with</span><span class=\"pi\">:</span>\n          <span class=\"na\">node-version</span><span
      class=\"pi\">:</span> <span class=\"m\">20</span>\n\n      <span class=\"pi\">-</span>
      <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Install
      Playwright and browser</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span>
      <span class=\"pi\">|</span>\n          <span class=\"s\">npm install playwright</span>\n
      \         <span class=\"s\">npx playwright install chromium</span>\n\n      <span
      class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span>
      <span class=\"s\">Take screenshot</span>\n        <span class=\"na\">run</span><span
      class=\"pi\">:</span> <span class=\"pi\">|</span>\n          <span class=\"s\">today=$(date
      +\"%Y-%m-%d\")</span>\n          <span class=\"s\">screenshot_path=\"screenshots/${{
      matrix.filename_prefix }}.$today.png\"</span>\n\n          <span class=\"s\">#
      Make these variables available to subsequent steps</span>\n          <span class=\"s\">#
      See https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-environment-variable</span>\n
      \         <span class=\"s\">echo \"today=$today\" &gt;&gt; \"$GITHUB_ENV\"</span>\n
      \         <span class=\"s\">echo \"screenshot_path=$screenshot_path\" &gt;&gt;
      \"$GITHUB_ENV\"</span>\n\n          <span class=\"s\">mkdir -p \"$(dirname \"$screenshot_path\")\"</span>\n\n
      \         <span class=\"s\"># If there's already a screenshot for today, don't</span>\n
      \         <span class=\"s\"># bother overwriting it.</span>\n          <span
      class=\"s\">if [[ -f \"$screenshot_path\" ]]; then exit 0; fi</span>\n\n          <span
      class=\"s\">npx playwright screenshot \\</span>\n            <span class=\"s\">--full-page
      \\</span>\n            <span class=\"s\">--wait-for-timeout 10000 \\</span>\n
      \           <span class=\"s\">\"${{ matrix.url }}\" \"$screenshot_path\"</span>\n\n
      \     <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span>
      <span class=\"s\">Push changes to GitHub</span>\n        <span class=\"na\">run</span><span
      class=\"pi\">:</span> <span class=\"pi\">|</span>\n          <span class=\"s\">git
      add \"$screenshot_path\"</span>\n          <span class=\"s\">git commit -m \"Add
      screenshot for ${{ matrix.url }} for $today\" || exit 0</span>\n          <span
      class=\"s\">git push origin main</span>\n</code></pre></div></div>\n\n<p>This
      runs once a week on Monday mornings \u2013 I don\u2019t update my websites that
      often, so I don\u2019t need more frequent screenshots.</p>\n\n<p>It installs
      Playwright, and uses it to take screenshots of two websites: <code class=\"language-plaintext
      highlighter-rouge\">alexwlchan.net</code> (this site) and <code class=\"language-plaintext
      highlighter-rouge\">books.alexwlchan.net</code> (my book tracker).\nThe images
      are saved in a folder called <code class=\"language-plaintext highlighter-rouge\">screenshots</code>,
      and the filenames include both the name of the site and the date taken, e.g.
      <code class=\"language-plaintext highlighter-rouge\">alexwlchan.net.2024-04-22.png</code>
      or <code class=\"language-plaintext highlighter-rouge\">books.2024-03-21.png</code>.</p>\n\n<p>If
      I want to get screenshots of a different website, I can add to the list in the
      <code class=\"language-plaintext highlighter-rouge\">matrix</code> section.</p>\n\n<p>I
      had to add a timeout to Playwright (<code class=\"language-plaintext highlighter-rouge\">--wait-for-timeout
      10000</code>) to ensure it downloads all the images correctly.\nBefore I added
      that option, I\u2019d sometimes get screenshots with holes where the images
      hadn\u2019t loaded in time.</p>\n\n<p>Once the screenshot has been created,
      it gets committed to Git and pushed to GitHub.\nI had to tweak the <a href=\"https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository#configuring-the-default-github_token-permissions\">GITHUB_TOKEN
      permissions</a> to allow GitHub Actions to push commits to my repo.\nThis is
      inspired by Simon Willison\u2019s <a href=\"https://simonwillison.net/2020/Oct/9/git-scraping/\">\u201Cgit
      scraping\u201D technique</a>, but I\u2019m tracking images rather than text.</p>\n\n<p>Because
      PNG files can get quite big and I have a lot of them, I decided to use <a href=\"https://git-lfs.com/\">Git
      Large File Storage (LFS)</a> with this repo \u2013 vanilla Git can struggle
      with large binary files.\nThis is my first time using Git\_LFS, and it was pleasantly
      easy to set up following the <a href=\"https://git-lfs.com/\">Getting Started
      guide</a>:</p>\n\n<div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code><span class=\"gp\">$</span><span class=\"w\"> </span>brew
      <span class=\"nb\">install </span>git-lfs\n<span class=\"gp\">$</span><span
      class=\"w\"> </span>git lfs <span class=\"nb\">install</span>\n<span class=\"go\">\n</span><span
      class=\"gp\">$</span><span class=\"w\"> </span><span class=\"nb\">cd</span>
      ~/repos/scheduled-screenshots\n<span class=\"go\">\n</span><span class=\"gp\">$</span><span
      class=\"w\"> </span>git lfs track <span class=\"s2\">\"*.png\"</span>\n<span
      class=\"gp\">$</span><span class=\"w\"> </span>git add .gitattributes\n<span
      class=\"gp\">$</span><span class=\"w\"> </span>git commit <span class=\"nt\">-m</span>
      <span class=\"s2\">\"Add .gitattributes file to store PNG images in Git\_LFS\"</span>\n</code></pre></div></div>\n\n<p>And
      that\u2019s what it took to set up scheduled screenshots.\nIf you want to see
      the code in a repo, or see the growing collection of screenshots, the GitHub
      repo is <a href=\"https://github.com/alexwlchan/scheduled-screenshots\">alexwlchan/scheduled-screenshots</a>.</p>\n\n<hr>\n\n<p>This
      is great for creating new screenshots, but what about everything that came before?\nThis
      site is nearly 12 years old, and it\u2019d be nice for that to be reflected
      in the visual record.</p>\n\n<p>I dove into the Wayback Machine to backfill
      the old screenshots.\nMy site isn\u2019t indexed that often \u2013 on average
      about once a month \u2013 but I can fill in some of the gaps this way.\nFirst
      I used the Wayback Machine\u2019s <a href=\"/til/2024/get-a-list-of-captures-from-the-wayback-machine/\">CDX
      Server API</a> to get a list of captures, then I <a href=\"/til/2024/take-a-wayback-machine-screenshot/\">used
      Playwright</a> to take screenshots.\nI had to adjust the timeouts to make sure
      everything loaded correctly, but I got them all to work eventually, and I got
      a hundred or so historical screenshots.</p>\n\n<p>I was surprised by was how
      many issues I found.\nThere were 116 captures of <a href=\"https://books.alexwlchan.net/\">my
      book tracker</a>, and of those 13 were clearly broken \u2013 the CSS or images
      hadn\u2019t been saved, and so the page was unstyled or had gaps where the images
      were meant to go.</p>\n\n<p>A further 7 were broken in subtle ways, where the
      HTML and CSS didn\u2019t match.\nFor example, I found one HTML capture <a href=\"https://web.archive.org/web/20210625222812/https://books.alexwlchan.net/\">from
      2021</a> that\u2019s loading CSS from 2024.\nThe Wayback Machine shows you a
      working page, but it\u2019s a hallucination \u2013 that\u2019s not what the
      page looked like in 2021.\n(The rounded corners are a dead giveaway \u2013 I
      didn\u2019t add those until 2022.)</p>\n\n<p>I love the Wayback Machine and
      I think it\u2019s a great service, but you shouldn\u2019t rely on it to preserve
      your website.\nI\u2019m glad these captures exist exist, but they\u2019re a
      bit shaky as a preservation record.\nIf there\u2019s a website you care about,
      make sure you have your own system that saves the stuff you think is important
      \u2013 don\u2019t just rely on the Wayback Machine.</p>\n\n<hr>\n\n<picture>\n
      \ \n  <source srcset=\"/images/2024/scheduled-screenshots_1x.avif 750w, /images/2024/scheduled-screenshots_2x.avif
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/scheduled-screenshots_1x.webp 750w, /images/2024/scheduled-screenshots_2x.webp
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/scheduled-screenshots_1x.png 750w, /images/2024/scheduled-screenshots_2x.png
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/scheduled-screenshots_1x.png\" alt=\"A graphic showing
      multiple screenshots arranged into a stack, as if they were in a timeline \u2013
      older screenshots towards the back, newer screenshots towards the front\" width=\"750\">\n</picture>\n\n<p>My
      scheduled screenshots are now up and running, and every Monday I\u2019ll get
      a new image to record the visual history of this site.</p>\n\n<p>If you want
      to set up something similar for your websites, here are the steps:</p>\n\n<ol>\n
      \ <li>Create a new GitHub repository</li>\n  <li>Create a new file <code class=\"language-plaintext
      highlighter-rouge\">.github/workflows/take_screenshots.yml</code> with the contents
      of the YAML file earlier in this post</li>\n  <li>Give <a href=\"https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository#configuring-the-default-github_token-permissions\">write
      access</a> to the GITHUB_TOKEN used by GitHub Actions, so it can push to your
      repo</li>\n  <li>Change the list of URLs/filename prefixes in the <code class=\"language-plaintext
      highlighter-rouge\">matrix</code> block for the websites you want to screenshot</li>\n</ol>\n\n<p>The
      best time to start taking regular screenshots of my website was when I registered
      the domain name.\nThe second best time is now.</p>\n\n\n    <p>[If the formatting
      of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/scheduled-screenshots/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"screenshots\"/>\n
      \   <category term=\"digital-preservation\"/>\n    <summary type=\"html\">A
      screenshot a day keeps the bit rot at bay.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">Getting faster Jekyll builds with caching in plugins</title>\n
      \   <link href=\"https://alexwlchan.net/2024/jekyll-caching/\" rel=\"alternate\"
      type=\"text/html\" title=\"Getting faster Jekyll builds with caching in plugins\"/>\n
      \   <published>2024-04-17T19:44:35+00:00</published>\n    <updated>2024-04-17T19:44:35+00:00</updated>\n
      \   <id>https://alexwlchan.net/2024/jekyll-caching</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2024/jekyll-caching/\"><![CDATA[\n<p>This
      website is a static site built with <a href=\"https://jekyllrb.com/\">Jekyll</a>,
      and recently I overhauled the process for generating the site.\nThis should
      be invisible if you\u2019re just a reader, but it makes a big difference to
      me \u2013 like any software project, I\u2019d accumulated cruft and complexity,
      and it was time to sweep that all away.\nThe new process is simpler and should
      be easier to debug when stuff breaks.\nYay!</p>\n\n<p>One of my goals was making
      the site faster to build.\nThis site is pretty small, modern computers are silly
      fast, and yet I was still waiting at least a minute for builds with a warm cache.\nI
      was sure it could be faster!\nSo I tried to find ways to speed up the build
      process.</p>\n\n<p>I found two bits of low-hanging fruit that could be useful
      additions to a lot of Jekyll sites.</p>\n\n<h2 id=\"use-the-jekyll-cache-api\">Use
      the Jekyll Cache API</h2>\n\n<p>I\u2019ve written <a href=\"https://github.com/alexwlchan/alexwlchan.net/tree/9e6a7db8ace9066fab09886e6bafa6b86c41ed4f/src/_plugins\">quite
      a few Jekyll plugins</a> which I keep in my <code class=\"language-plaintext
      highlighter-rouge\">_plugins</code> folder.</p>\n\n<p>Most of these are various
      text processing functions that always return the same output for the same input.\nFor
      example, I have one plugin that <a href=\"/2020/adding-non-breaking-spaces-with-jekyll/\">adds
      non-breaking spaces</a> to my rendered HTML, and it always adds the same set
      of spaces.</p>\n\n<p>This makes my plugins a good fit for Jekyll 4\u2019s <a
      href=\"https://jekyllrb.com/tutorials/cache-api/\">caching API</a>, which allows
      me to cache the expensive computation in my plugins.\nThe API is quite nice:
      you create an instance of <code class=\"language-plaintext highlighter-rouge\">Jekyll::Cache</code>,
      then you call <code class=\"language-plaintext highlighter-rouge\">getset(key)</code>.\nIf
      <code class=\"language-plaintext highlighter-rouge\">key</code> is already in
      the cache, it returns the cached value; if not, it runs the expensive computation
      once and stores the value in the cache.</p>\n\n<p>Here\u2019s an example:</p>\n\n<div
      class=\"language-ruby highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">def</span> <span class=\"nf\">cache</span>\n  <span class=\"vc\">@@cache</span>
      <span class=\"o\">||=</span> <span class=\"no\">Jekyll</span><span class=\"o\">::</span><span
      class=\"no\">Cache</span><span class=\"p\">.</span><span class=\"nf\">new</span><span
      class=\"p\">(</span><span class=\"s1\">'AddNonBreakingSpaces'</span><span class=\"p\">)</span>\n<span
      class=\"k\">end</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">add_non_breaking_spaces</span><span
      class=\"p\">(</span><span class=\"n\">markdown</span><span class=\"p\">)</span>\n
      \ <span class=\"n\">cache</span><span class=\"p\">.</span><span class=\"nf\">getset</span><span
      class=\"p\">(</span><span class=\"n\">markdown</span><span class=\"p\">)</span>
      <span class=\"k\">do</span>\n    <span class=\"n\">expensive_add_non_breaking_spaces_method</span><span
      class=\"p\">(</span><span class=\"n\">markdown</span><span class=\"p\">)</span>\n
      \ <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n\n<p>In
      this code, <code class=\"language-plaintext highlighter-rouge\">expensive_add_non_breaking_spaces_method</code>
      will only be called once, and then cached until the Markdown changes or the
      cache is cleared.</p>\n\n<p>The cache is cleared every time you change <code
      class=\"language-plaintext highlighter-rouge\">_config.yml</code> or you run
      Jekyll with a different verb, e.g. <code class=\"language-plaintext highlighter-rouge\">build</code>
      or <code class=\"language-plaintext highlighter-rouge\">serve</code>.\nThis
      makes it easy to see the impact that caching is having \u2013 make a change
      to <code class=\"language-plaintext highlighter-rouge\">_config.yml</code>,
      then run <code class=\"language-plaintext highlighter-rouge\">jekyll build</code>
      twice.\nThe first build will run with a cold cache, the second with a warm cache.\nThe
      difference is the speedup you get from caching.</p>\n\n<p>In this site, adding
      caching to my plugins speeds up the build from ~6s to ~1.5s.\nThat\u2019s 4\xD7
      faster!</p>\n\n<h2 id=\"add-caching-to-the-built-in-jekyll-filters\">Add caching
      to the built-in Jekyll filters</h2>\n\n<p>I did some testing with <code class=\"language-plaintext
      highlighter-rouge\">jekyll build --profile</code> to find which pages were taking
      the most build time, and I discovered that the built-in <a href=\"https://jekyllrb.com/docs/liquid/filters/#smartify\"><code
      class=\"language-plaintext highlighter-rouge\">smartify</code> filter</a> was
      taking a big chunk of the build time.\nThis is a filter which converts \"straight
      quotes\" into \u201Ccurly quotes\u201D.</p>\n\n<p>I use this filter in a lot
      of places (individual posts, index pages, the RSS feed) and it\u2019s another
      good fit for the caching API \u2013 adding curly quotes to a piece of text will
      always return the same result.</p>\n\n<p>There are two ways you could add caching
      to the <code class=\"language-plaintext highlighter-rouge\">smartify</code>
      filter:</p>\n\n<ul>\n  <li>create a new filter <code class=\"language-plaintext
      highlighter-rouge\">cached_smartify</code>, and use that instead of <code class=\"language-plaintext
      highlighter-rouge\">smartify</code>\n</li>\n  <li>override the existing <code
      class=\"language-plaintext highlighter-rouge\">smartify</code> filter to add
      caching</li>\n</ul>\n\n<p>I think both approaches are fine, and it just depends
      on which style you prefer.\nIn this case, I slightly prefer the second approach,
      so I added a \u201Ccached smartify\u201D plugin to my <code class=\"language-plaintext
      highlighter-rouge\">_plugins</code> folder.\nThis overrides the existing <code
      class=\"language-plaintext highlighter-rouge\">smartify</code> filter and replaces
      it with a cached version.\nI can continue to use <code class=\"language-plaintext
      highlighter-rouge\">smartify</code> in my templates as before, and enjoy a nice
      speedup:</p>\n\n<div class=\"language-ruby highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code><span class=\"c1\"># cached_smartify.rb</span>\n<span
      class=\"k\">module</span> <span class=\"nn\">Jekyll</span>\n  <span class=\"k\">module</span>
      <span class=\"nn\">Filters</span>\n    <span class=\"k\">alias</span> <span
      class=\"n\">builtin_smartify</span> <span class=\"n\">smartify</span>\n    \n
      \   <span class=\"k\">def</span> <span class=\"nf\">smartify_cache</span>\n
      \     <span class=\"vc\">@@smartify_cache</span> <span class=\"o\">||=</span>
      <span class=\"no\">Jekyll</span><span class=\"o\">::</span><span class=\"no\">Cache</span><span
      class=\"p\">.</span><span class=\"nf\">new</span><span class=\"p\">(</span><span
      class=\"s1\">'Smartify'</span><span class=\"p\">)</span>\n    <span class=\"k\">end</span>\n\n
      \   <span class=\"c1\"># Like the builtin smartify filter, but faster.</span>\n
      \   <span class=\"k\">def</span> <span class=\"nf\">smartify</span><span class=\"p\">(</span><span
      class=\"n\">input</span><span class=\"p\">)</span>\n      <span class=\"n\">smartify_cache</span><span
      class=\"p\">.</span><span class=\"nf\">getset</span><span class=\"p\">(</span><span
      class=\"n\">input</span><span class=\"p\">)</span> <span class=\"k\">do</span>\n
      \       <span class=\"n\">builtin_smartify</span><span class=\"p\">(</span><span
      class=\"n\">input</span><span class=\"p\">)</span>\n      <span class=\"k\">end</span>\n
      \   <span class=\"k\">end</span>\n  <span class=\"k\">end</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n\n<p>In
      my book tracker, adding caching to the <code class=\"language-plaintext highlighter-rouge\">smartify</code>
      filter speeds up the build from ~1.8s to ~0.8s.\nNice!</p>\n\n<h2 id=\"conclusion\">Conclusion</h2>\n\n<p>The
      last time I refactored the site build, it felt pretty fast.\nOver time, I\u2019ve
      gradually made changes that slowed it down, and it was feeling pretty sluggish.\nI
      didn\u2019t think to record precise timings before I started the refactor, but
      I know I sometimes had to wait tens of seconds for a build to run.</p>\n\n<p>Now
      this site takes ~1.5s to build (with a warm cache).\nIt doesn\u2019t exactly
      feel \u201Cfast\u201D, but it doesn\u2019t feel slow any more.\nI\u2019m sure
      I could wring out more speed if I really tried, but this is already a big improvement
      and fast enough for now.</p>\n\n<p>A lot of the improvements came from simplifying
      the build system, and deleting a bunch of custom code that was causing slowness.\nThe
      Jekyll caching is only part of the speedup, but it\u2019s the improvement most
      likely to be applicable to other Jekyll sites.</p>\n\n<p>When the site is slow,
      I get frustrated, bored, and tend to find excuses not to write anything.\nWhen
      the site is fast, I enjoy working on it and I\u2019m more likely to write new
      stuff.\nOne of my goals for this year is to spend more time on my writing, and
      making it more pleasant to write is a good step in that direction.</p>\n\n\n
      \   <p>[If the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/jekyll-caching/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"jekyll\"/>\n
      \   <category term=\"blogging-about-blogging\"/>\n    <summary type=\"html\">I
      was able to build my Jekyll site much faster by using the built-in caching API.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">The Star-Spangled Ballad</title>\n
      \   <link href=\"https://alexwlchan.net/2024/star-spangled-ballad/\" rel=\"alternate\"
      type=\"text/html\" title=\"The Star-Spangled Ballad\"/>\n    <published>2024-04-14T15:52:57+00:00</published>\n
      \   <updated>2024-04-14T15:52:57+00:00</updated>\n    <id>https://alexwlchan.net/2024/star-spangled-ballad</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/star-spangled-ballad/\"><![CDATA[\n<p>In
      an hour or so, Hannah Waddingham will take the stage at the Royal Albert Hall,
      and present this year\u2019s Olivier Awards.\nI won\u2019t be there, but a number
      of dear friends are in the audience, and we\u2019re keeping our fingers crossed
      for <em>Operation Mincemeat</em> \u2013 a musical with which we all have an
      entirely normal and healthy relationship.\n(Just don\u2019t ask how many times
      we\u2019ve been.)</p>\n\n<p>One of <em>Mincemeat</em>\u2019s six nominations
      is \u201COutstanding musical contribution\u201D, specifically Joe Bunker for
      music directing and Steve Sidwell for orchestrating.\nWhile we wait to find
      out who\u2019s won, I wanted to point out a fun detail in the music \u2013 one
      that I only heard for myself last night.</p>\n\n<p>In the second act, the main
      characters are waiting for news of a fake plane crash \u2013 a dead body they\u2019ve
      dressed to look like the made-up British officer William Martin, who\u2019s
      carrying \u201Csecret plans\u201D about the \u201CAllied invasion of Europe\u201D.\nThe
      idea is that he\u2019ll wash ashore in Spain, the Germans will find the plans
      in his briefcase, and they\u2019ll be misled about the Allies\u2019s true goals.</p>\n\n<p>Unfortunately
      the initial news is quite different \u2013 an Allied pilot has washed ashore,
      but he\u2019s very much alive and very much American.\nWe get to know him in
      the song <em>The Ballad of Willie Watkins</em>, while the main characters fret
      about whether two pilots crashing on the same day, in the same place, with the
      same name, might arouse suspicion.</p>\n\n<p>(This may seem like an implausible
      coincidence, but it\u2019s true.\nWillie Watkins was a real pilot, he really
      did crash in Spain, and he was even present at William Martin\u2019s autopsy
      \u2013 a detail <a href=\"https://twitter.com/spitlip/status/1667667754940235778\">too
      ridiculous to fit into the show</a>.\nTruth is stranger than fiction.)</p>\n\n<p>For
      months now, friends have been telling me that <em>The Ballad of Willie Watkins</em>
      has a few bars from <em>The Star-Spangled Banner</em>, the US national anthem,
      but I\u2019ve always struggled to hear it.\nWith some help from <a href=\"https://twitter.com/HeLiam3\">Liam
      in the Discord</a>, I was able to spot it.</p>\n\n\n\n<p>Here\u2019s a clip
      from the cast recording where the anthem is playing in the background:</p>\n\n<figure>\n
      \ <audio src=\"/files/2024/Star_Spangled_Willie_Watkins_original.mp3\"></audio>\n
      \ <figcaption>\n    <a href=\"/files/2024/Star_Spangled_Willie_Watkins_original.mp3\">Download
      MP3</a>\n  </figcaption>\n</figure>\n\n<p>Liam messed with an EQ to make the
      <em>Star-Spangled Banner</em> a bit more prominent \u2013 the rest of the song
      fades away when the anthem is playing.\nHere\u2019s an MP3 he made:</p>\n\n<figure>\n
      \ <audio src=\"/files/2024/Star_Spangled_Willie_Watkins.mp3\"></audio>\n  <figcaption>\n
      \   <a href=\"/files/2024/Star_Spangled_Willie_Watkins.mp3\">Download MP3</a>\n
      \ </figcaption>\n</figure>\n\n<p>I took that a step further by stripping out
      the bass and the drums, and I think it makes those parts even more prominent.\n(I
      googled something like \u201Cremove lyrics from MP3\u201D and used the first
      website I found.\nIt split the MP3 into different tracks, and I could toggle
      each of them off/on.)\nThis makes it very clear to me:</p>\n\n<figure>\n  <audio
      src=\"/files/2024/Star_Spangled_Willie_Watkins_music.mp3\"></audio>\n  <figcaption>\n
      \   <a href=\"/files/2024/Star_Spangled_Willie_Watkins_music.mp3\">Download
      MP3</a>\n  </figcaption>\n</figure>\n\n<p>These processed versions definitely
      distort the brass which is actually playing the melody, but they were enough
      that I can now reliably hear it in the unprocessed soundtrack.\nAnd last night,
      I was sitting in the audience and I finally heard the <em>Star-Spangled Banner</em>
      as it was played live!</p>\n\n\n    <p>[If the formatting of this post looks
      odd in your feed reader, <a href=\"https://alexwlchan.net/2024/star-spangled-ballad/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"theatre\"/>\n
      \   <category term=\"operation-mincemeat\"/>\n    <category term=\"music\"/>\n
      \   <summary type=\"html\">If you listen carefully to the Ballad of Willie Watkins,
      you might hear another song peeking through.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">flapi.sh: a tiny command-line tool for exploring the
      Flickr API &amp;rarr;</title>\n    <link href=\"https://github.com/Flickr-Foundation/flapi.sh\"
      rel=\"alternate\" type=\"text/html\" title=\"flapi.sh: a tiny command-line tool
      for exploring the Flickr API\"/>\n    <published>2024-04-11T22:09:55+00:00</published>\n
      \   <updated>2024-04-11T22:09:55+00:00</updated>\n    <id>https://alexwlchan.net/2024/flapi</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/flapi/\"><![CDATA[\n<p>I
      use <a href=\"https://www.flickr.com/services/api/\">the Flickr API</a> pretty
      much every day in <a href=\"https://www.flickr.org/\">my day job</a>.\nWithin
      the first week, I bashed together a couple of command-line tools to make a simple
      tool for exploring the API.\nThey\u2019re not meant for building \u201Cproper\u201D
      apps, more for quick experiments and seeing what API responses look like.</p>\n\n<p>The
      main tool is <code class=\"language-plaintext highlighter-rouge\">flapi</code>,
      and you pass it two arguments: the name of the API method, and (optionally)
      any query parameters you want to include.\nThen it calls the Flickr API for
      you!</p>\n\n<p>For example:</p>\n\n<div class=\"language-console highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">$</span><span
      class=\"w\"> </span>flapi flickr.photos.getInfo photo_id=25260341744\n<span
      class=\"go\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span><span class=\"w\">\n</span><span
      class=\"go\">&lt;rsp stat=\"ok\"&gt;</span><span class=\"w\">\n</span><span
      class=\"go\">  &lt;photo id=\"25260341744\" secret=\"3e30df4a20\" server=\"1645\"
      farm=\"2\" dateuploaded=\"1458345230\" isfavorite=\"0\" license=\"7\" safety_level=\"0\"
      rotation=\"0\" originalsecret=\"b473e4a3b0\" originalformat=\"jpg\" views=\"83654\"
      media=\"photo\"&gt;</span><span class=\"w\">\n</span><span class=\"go\">    \u2026\n</span></code></pre></div></div>\n\n<p>There
      are lots of ways to play with APIs \u2013 colleagues at a previous job used
      Postman, and Flickr itself has an API Explorer where you can try requests in
      the browser.\nI like doing it with a command-line tool because I always have
      lots of terminal windows open, and it\u2019s easy to grab one and check something
      with <code class=\"language-plaintext highlighter-rouge\">flapi</code>.</p>\n\n<p>Today
      I finally took the time to tidy up the script <a href=\"https://github.com/Flickr-Foundation/flapi.sh\">and
      post it on GitHub</a>.</p>\n\n<p>The code isn\u2019t complicated \u2013 indeed,
      it was easy to cobble it together from a bunch of other tools.\nEven if you
      have no interest in the Flickr API, some of them might be useful for you.</p>\n\n<ul>\n
      \ <li>\n    <p>I\u2019m using <a href=\"https://github.com/jaraco/keyring\">keyring</a>
      to store and retrieve my Flickr API key in the macOS Keychain.\nThis is a Python
      library that makes it easy to manage passwords and other secrets, and to avoid
      hard-coding secrets in my code.</p>\n  </li>\n  <li>\n    <p>I use <a href=\"https://curl.se/\">curl</a>
      to make the actual HTTP request.\nI recently listened to an <a href=\"https://github.com/readme/podcast/curl-25-years\">interesting
      interview</a> with Daniel Stenberg, curl\u2019s creator and maintainer, where
      he talked about how curl got started and how he keeps it going.</p>\n  </li>\n
      \ <li>\n    <p>I pipe the output to <a href=\"https://opensource.apple.com/source/libxml2/libxml2-7/libxml2/doc/xmllint.html\"><code
      class=\"language-plaintext highlighter-rouge\">xmllint --format</code></a>,
      which pretty-prints the XML.\nI\u2019m not sure how much of a difference it
      makes to Flickr\u2019s API responses, but it\u2019s nice to remember that macOS
      has a built in reformatter for XML.</p>\n  </li>\n  <li>\n    <p>Finally, I
      pipe the reformatted XML to <a href=\"https://pygments.org/\">Pygments</a> to
      add syntax highlighting.\nFor me, this makes the output a bit easier to read.</p>\n
      \ </li>\n</ul>\n\n<p>Put together, the core logic of <code class=\"language-plaintext
      highlighter-rouge\">flapi</code> is just four lines:</p>\n\n<div class=\"language-bash
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"nv\">api_key</span><span class=\"o\">=</span><span class=\"si\">$(</span>keyring
      get flickr_api key<span class=\"si\">)</span>\n\ncurl <span class=\"nt\">--silent</span>
      <span class=\"s2\">\"https://api.flickr.com/services/rest/?api_key=</span><span
      class=\"k\">${</span><span class=\"nv\">api_key</span><span class=\"k\">}</span><span
      class=\"s2\">&amp;method=</span><span class=\"k\">${</span><span class=\"nv\">method</span><span
      class=\"k\">}</span><span class=\"s2\">&amp;</span><span class=\"k\">${</span><span
      class=\"nv\">params</span><span class=\"k\">}</span><span class=\"s2\">\"</span>
      <span class=\"se\">\\</span>\n  | xmllint <span class=\"nt\">--format</span>
      - <span class=\"se\">\\</span>\n  | pygmentize <span class=\"nt\">-l</span>
      xml\n</code></pre></div></div>\n\n<p>These four programs feel like an exemplar
      of the Unix Way: small tools that each do one task well, written so they can
      be combined in complex ways.</p>\n\n\n    <p>[If the formatting of this post
      looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/flapi/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"flickr\"/>\n
      \   <summary type=\"html\">Combining several existing tools to make something
      that allows for quick experiments and exploration.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">The new Flickr Commons Explorer &amp;rarr;</title>\n
      \   <link href=\"https://commons.flickr.org/\" rel=\"alternate\" type=\"text/html\"
      title=\"The new Flickr Commons Explorer\"/>\n    <published>2024-04-02T15:40:35+00:00</published>\n
      \   <updated>2024-04-02T15:40:35+00:00</updated>\n    <id>https://alexwlchan.net/2024/commons-explorer</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/commons-explorer/\"><![CDATA[\n<p>One
      of the things I\u2019ve been working on at the Flickr Foundation is a new \u201CCommons
      Explorer\u201D, a way to browse the photos in the Flickr Commons.</p>\n\n<p>Flickr
      Commons is a collection of historical photography from cultural institutions
      from all around the world, all with no known copyright restrictions.\nIt started
      with the Library of Congress in 2008, and now includes over 100 institutions
      from 24 different countries.</p>\n\n<p>One of the cool things about Flickr Commons
      is the variety of photos, and I enjoy looking \u201Cacross\u201D the Commons.\nI
      used a lot of Commons photos in my <a href=\"/2024/step-step-step/\">Monki\_Gras
      talk</a> last month, and I had fun using the <a href=\"https://commons.flickr.org/search?query=dance\">new
      search</a> to find dance-related photos from all the different members.</p>\n\n<p>The
      <a href=\"https://commons.flickr.org/\">Commons Explorer</a> is a new tool that
      encourages this sort of cross-collection exploration.\nIt tries to treat the
      Flickr Commons as a single collection of photographs, and to provide interesting
      views into the data that are more than just traditional search.\nThere are lots
      of cool photos to find!</p>\n\n<p>You can try the new Commons Explorer at <a
      href=\"https://commons.flickr.org\">commons.flickr.org</a>, or you can learn
      more in <a href=\"https://www.flickr.org/new-flickr-commons-explorer/\">our
      introductory blog post</a>.</p>\n\n\n\n<div id=\"grid\">\n  <picture>\n  \n
      \ \n  \n  <source srcset=\"/images/2024/commons_explorer_screenshot1_1x.png
      444w, /images/2024/commons_explorer_screenshot1_2x.png 888w, /images/2024/commons_explorer_screenshot1_3x.png
      1332w\" sizes=\"(max-width: 444px) 100vw, 444px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/commons_explorer_screenshot1_1x.png\" class=\"screenshot\"
      alt=\"The homepage of the Commons Explorer, showing an introductory message
      and a 2-column grid of recent photos.\" width=\"444\">\n</picture>\n\n  <picture>\n
      \ \n  \n  \n  <source srcset=\"/images/2024/commons_explorer_screenshot2_1x.png
      296w, /images/2024/commons_explorer_screenshot2_2x.png 592w, /images/2024/commons_explorer_screenshot2_3x.png
      888w\" sizes=\"(max-width: 296px) 100vw, 296px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/commons_explorer_screenshot2_1x.png\" class=\"screenshot\"
      alt=\"A list of members in the Flickr Commons, showing cards for each member.
      Each card has a selected photo from the member, their name, and some basic metadata.\"
      width=\"296\">\n</picture>\n\n  <picture>\n  \n  \n  \n  <source srcset=\"/images/2024/commons_explorer_screenshot3_1x.png
      296w, /images/2024/commons_explorer_screenshot3_2x.png 592w, /images/2024/commons_explorer_screenshot3_3x.png
      888w\" sizes=\"(max-width: 296px) 100vw, 296px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/commons_explorer_screenshot3_1x.png\" class=\"screenshot\"
      alt=\"Conversations on Flickr Commons photos -- comments people have left. There\u2019s
      a single conversation on a photo of a woman called \u201CPeggy Barthes\u201D,
      with two comments shown next to the photo.\" width=\"296\">\n</picture>\n</div>\n\n\n
      \   <p>[If the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/commons-explorer/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"flickr\"/>\n
      \   <category term=\"flickr-foundation\"/>\n    <summary type=\"html\">A new
      way to browse the photos in the Flickr Commons programme.</summary>\n  </entry>\n
      \ <entry>\n    <title type=\"html\">Monki Gras 2024: Step\u2026 Step\u2026 Step\u2026</title>\n
      \   <link href=\"https://alexwlchan.net/2024/step-step-step/\" rel=\"alternate\"
      type=\"text/html\" title=\"Monki Gras 2024: Step\u2026 Step\u2026 Step\u2026\"/>\n
      \   <published>2024-03-15T12:56:46+00:00</published>\n    <updated>2024-03-15T12:56:46+00:00</updated>\n
      \   <id>https://alexwlchan.net/2024/step-step-step</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2024/step-step-step/\"><![CDATA[\n<p>Yesterday
      I gave a talk at <a href=\"https://monkigras.com/\">Monki\_Gras 2024</a>.\nThis
      year, the theme is <em>\u201CPrompting Craft: examining and discussing the art
      of the prompt in code and cultural creation\u201D</em>.\nI did a talk about
      my experience of learning these new AI tools, and I draw comparisons to learning
      to dance.</p>\n\n<p>This is my third time at Monki\_Gras, and my second time
      speaking \u2013 I first went in 2018, and I gave <a href=\"/2019/monki-gras-the-curb-cut-effect/\">a
      talk about the curb cut effect</a> in 2019.\nI bought a ticket as soon as they
      went on sale \u2013 I enjoyed myself so much at previous events, going again
      was a no-brainer.\n(My ticket was reimbursed because I was speaking, but I\u2019d
      have happily paid to go anyway.)</p>\n\n<p>Monki\_Gras is a rare event that
      manages to have both good talks <em>and</em> a good hallway track.\nThe first
      day of talks had a lot of interesting ideas and were well-presented, and I had
      some thoughtful and friendly conversations in between.\nI know I\u2019ll be
      thinking about the event for weeks to come, and there\u2019s still another day
      to go!</p>\n\n<p>I\u2019m pleased with the talk I wrote, and people seemed to
      enjoy it.\nThe talk wasn\u2019t recorded, but I\u2019ve put my slides and notes
      below.\n(I wanted to get these up quickly, so there may be silly typos or mistakes.\nPlease
      let me know if you see any!)</p>\n\n<p>This is the key message: <em>being a
      good user of AI is about both technical skills and managing your trust in the
      tool</em>.\nYou need to know the mechanics of prompt engineering, what text
      you type in the box, yes.\nBut you also need to know how much you trust the
      tool, and whether you can rely on its results \u2013 if you don\u2019t, the
      output is useless.</p>\n\n<h2 id=\"what-a-lovely-sense-of-gender\">What a lovely
      sense of ~gender~</h2>\n\n<p>There are some personal reasons why Monki\_Gras
      feels a bit special.</p>\n\n<p>I went to the last Monki\_Gras in 2019.\nIt was
      cancelled in 2020 thanks to COVID, and this is the first year it\u2019s been
      back \u2013 five years later!\nA lot of stuff has changed in that time.</p>\n\n<p>In
      2019, I was starting to explore what being genderfluid might mean for me, how
      that might affect my professional career, and I had several meaningful conversations
      with now-friends at Monki\_Gras.\nIn 2024, I have a better understanding of
      what my gender looks like, I\u2019m much happier, and I\u2019m more comfortable
      presenting as my full self.</p>\n\n<p>At both events, my gender and my appearance
      have been a complete non-issue.\nPeople accept that I am who I say I am; there
      were no awkward stares or questions; I was never misgendered.\nI got to relax,
      and focus on the event rather than worrying if somebody was about to be weird.</p>\n\n<p>It\u2019s
      nice.</p>\n\n<p>This should be the norm at professional events, but it isn\u2019t,
      and it\u2019s a bit sad that I can\u2019t take it for granted.\nBut it\u2019s
      nice when it happens.</p>\n\n<h2 id=\"linksrecommended-reading\">Links/recommended
      reading</h2>\n\n<ul>\n  <li>\n    <p>There are lots of books about the history
      of swing dancing and jazz music.\nI read <a href=\"https://www.swingpatrol.co.uk/swing-dance-book-scott-cupit/\"><em>Swing
      Dance</em> by Scott Cupit</a> as I was writing the talk because it\u2019s what
      I had to hand, but there are plenty of others.\nIt\u2019s a fun subject!</p>\n\n
      \   <p>If you\u2019re getting started, I\u2019d particularly recommend looking
      for information about <a href=\"https://en.wikipedia.org/wiki/Frankie_Manning\">Frankie
      Manning</a> and <a href=\"https://en.wikipedia.org/wiki/Norma_Miller\">Norma
      Miller</a>, two of the early pioneers of this style of dancing.</p>\n  </li>\n
      \ <li>\n    <p>Most of the photos in the talk come from <a href=\"https://commons.flickr.org/\">the
      Flickr Commons</a>, a collection of historical photographs from over 100 international
      cultural heritage organisations.</p>\n\n    <p>You can learn more about the
      Commons, browse the photos, and see who\u2019s involved using the Commons Explorer
      <a href=\"https://commons.flickr.org/\">https://commons.flickr.org/</a>.\n(Which
      I helped to build!)</p>\n  </li>\n</ul>\n\n<h2 id=\"slides-and-notes\">Slides
      and notes</h2>\n\n\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/statelibraryofnsw/53204818679/\"><picture>
      \ <source srcset=\"/images/2024/step-step-step-1_1x.avif 450w, /images/2024/step-step-step-1_2x.avif
      900w, /images/2024/step-step-step-1_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/step-step-step-1_1x.webp
      450w, /images/2024/step-step-step-1_2x.webp 900w, /images/2024/step-step-step-1_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/step-step-step-1_1x.jpg 450w, /images/2024/step-step-step-1_2x.jpg
      900w, /images/2024/step-step-step-1_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/step-step-step-1_1x.jpg\"
      alt=\"Cover slide. On the left hand side is \u201CStep\u2026 Step\u2026 Step\u2026\u201D
      in green text, and on the right hand side is a black-and-white photo of two
      dancers.\" class=\"photo dark_aware\" loading=\"lazy\" width=\"450\"> </picture></a>\n
      \ <figcaption>\n    Photo: two jitterbug dancers in Sydney, 1948.\n    From
      the <a href=\"https://www.flickr.com/photos/statelibraryofnsw/53204818679/\">State
      Library of New South Wales</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>Introductory
      slide.</p>\n\n<p>It\u2019s lovely to be back at Monki\_Gras.</p>\n\n<p>My name
      is Alex Chan; my pronouns are they/she; I\u2019m a software developer.</p>\n\n<p>I
      work at the <a href=\"https://www.flickr.org/\">Flickr Foundation</a>, where
      we\u2019re trying to keep Flickr\u2019s pictures visible for 100 years \u2013
      including many of the photos in the talk.\nI do a bunch of fun stuff around
      digital preservation, cultural heritage, museums and libraries, all that jazz.\nIf
      you want to learn more about my work and all the other stuff I do, you can read
      more at <a href=\"https://alexwlchan.net\">alexwlchan.net</a>.</p>\n\n<p>But
      I\u2019m not talking about my work today.\nInstead, I want to talk about <strong>dancing</strong>.\nA
      few years ago I started learning to dance; last year I started learning to use
      AI, and I\u2019ve spotted a lot of parallels between the two.\nI want to tell
      you what learning to dance taught me about learning to use AI.</p>\n\n<figure>\n
      \ <a href=\"https://www.flickr.com/photos/proni/38895273120/\"><picture>  <source
      srcset=\"/images/2024/38895273120_0e92f40ed8_o_1x.avif 450w, /images/2024/38895273120_0e92f40ed8_o_2x.avif
      900w, /images/2024/38895273120_0e92f40ed8_o_3x.avif 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/38895273120_0e92f40ed8_o_1x.webp
      450w, /images/2024/38895273120_0e92f40ed8_o_2x.webp 900w, /images/2024/38895273120_0e92f40ed8_o_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/38895273120_0e92f40ed8_o_1x.jpg 450w, /images/2024/38895273120_0e92f40ed8_o_2x.jpg
      900w, /images/2024/38895273120_0e92f40ed8_o_3x.jpg 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/38895273120_0e92f40ed8_o_1x.jpg\"
      alt=\"Black-and-white photo of a theatrical stage full of actors in various
      costumes.\" class=\"photo dark_aware\" loading=\"lazy\" width=\"450\"> </picture></a>\n
      \ <figcaption>\n    A theatrical production of <em>The Pirates of Penzance</em>,
      1927.\n    From the <a href=\"https://www.flickr.com/photos/proni/38895273120/\">Public
      Record Office of Northern Ireland</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>This
      all started about five years ago.\nI was in a theatre at Bristol, watching a
      musical, and as musicals are wont to do, they had some big song and dance numbers.</p>\n\n<p>I
      was sitting in the audience, and as I watched the actors dancing, I thought
      <em>\u201Cthat looks fun, I want do to that\u201D</em>.\nSo in the interval
      I got out my phone, I started reading about dancing, and what they were doing
      on stage.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/library_of_congress/3549665322/\"><picture>
      \ <source srcset=\"/images/2024/3549665322_a5bc9827aa_o_1x.avif 450w, /images/2024/3549665322_a5bc9827aa_o_2x.avif
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/avif\"></source>
      \ <source srcset=\"/images/2024/3549665322_a5bc9827aa_o_1x.webp 450w, /images/2024/3549665322_a5bc9827aa_o_2x.webp
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/3549665322_a5bc9827aa_o_1x.jpg 450w, /images/2024/3549665322_a5bc9827aa_o_2x.jpg
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/jpeg\"></source>
      \ <img src=\"/images/2024/3549665322_a5bc9827aa_o_1x.jpg\" loading=\"lazy\"
      alt=\"Black-and-white photo of a couple dancing side-by-side, with other people
      around them dancing or watching from the sidelines.\" class=\"photo dark_aware\"
      width=\"450\"> </picture></a>\n  <figcaption>\n    Jitterbugging in a juke joint
      in Mississippi, 1939.\n    From the <a href=\"https://www.flickr.com/photos/library_of_congress/3549665322/\">Library
      of Congress</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>The
      particular style of dancing they were doing was called <a href=\"https://en.wikipedia.org/wiki/Swing_(dance)\">swing
      dancing</a>.</p>\n\n<p>Swing dancing is an umbrella term for a wide variety
      of energetic and rhythmic dance styles, usually danced to jazz music.\nProbably
      the most well-known is lindy hop, but it also includes <a href=\"https://en.wikipedia.org/wiki/Balboa_(dance)\">balboa</a>,
      <a href=\"https://en.wikipedia.org/wiki/Jitterbug\">jitterbug</a>, <a href=\"https://en.wikipedia.org/wiki/Charleston_(dance)\">charleston</a>,
      <a href=\"https://en.wikipedia.org/wiki/Collegiate_shag\">collegiate shag</a>\u2026</p>\n\n<p>Swing
      dance came out of the African American jazz scene in the early 20th century,
      and a lot of the moves practiced today have their roots in traditional African
      folk dances.</p>\n\n<p>Swing dancing is very popular today, and there\u2019s
      a thriving swing dance scene in London, so I was able to find a beginner class
      just five minutes from where I was working at the time.\nIt was closer than
      the nearest Starbucks!</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/statelibraryqueensland/7946600826/\"><picture>
      \ <source srcset=\"/images/2024/7946600826_688c50aa56_o_1x.avif 450w, /images/2024/7946600826_688c50aa56_o_2x.avif
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/avif\"></source>
      \ <source srcset=\"/images/2024/7946600826_688c50aa56_o_1x.webp 450w, /images/2024/7946600826_688c50aa56_o_2x.webp
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/7946600826_688c50aa56_o_1x.jpg 450w, /images/2024/7946600826_688c50aa56_o_2x.jpg
      900w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/jpeg\"></source>
      \ <img src=\"/images/2024/7946600826_688c50aa56_o_1x.jpg\" alt=\"A black-and-white
      photo of young girls in white tutus, their arms held out in ballet poses, inside
      a dance studio.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">
      </picture></a>\n  <figcaption>\n    Young girls competing at the Royal Academy
      of Dancing, 1938.\n    From the <a href=\"https://www.flickr.com/photos/statelibraryqueensland/7946600826/\">State
      Library of Queensland</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>This
      was a proper beginner class, no experience needed \u2013 which was good, because
      I didn\u2019t have any!\nYou could walk in having never danced before and they\u2019d
      teach you from scratch.</p>\n\n<p>This is great for students, but it poses a
      tricky challenge for the teachers.\nMany people are quite nervous in a dance
      class, unsure if they can do it, especially if it\u2019s their first time.\nThe
      teachers have to get you on board quickly, and I noticed a pattern \u2013 after
      a gentle warmup, they\u2019d always start with a really simple step.</p>\n\n<p>At
      this point I demonstrated with a simple step on stage.\nI don\u2019t have any
      video of this, so you\u2019ll have to make do with crude MS\_Paint drawings.</p>\n\n<p>This
      is a kick, kick, step.</p>\n\n\n\n<div id=\"step_by_step\">\n  <img src=\"/images/2024/basic-1.png\"
      alt=\"Left foot down, right foot raised\" loading=\"lazy\">\n  <p>\n    Stand
      on my left leg, and raise my right leg in the air.\n    Bent at the knee, foot
      pointing back.\n  </p>\n  \n  <img src=\"/images/2024/basic-2.png\" alt=\"Left
      foot down, right foot kicking\" loading=\"lazy\">\n  <p>\n    Swing the right
      leg forward into a kick.\n  </p>\n  \n  <img src=\"/images/2024/basic-3.png\"
      alt=\"Left foot down, right foot raised\" loading=\"lazy\">\n  <p>\n    Swing
      the right leg back up, completing the kick.\n  </p>\n  \n  <img src=\"/images/2024/basic-4.png\"
      alt=\"Left foot down, right foot kicking\" loading=\"lazy\">\n  <p>\n    Swing
      the right leg forward again for a second kick.\n  </p>\n  \n  <img src=\"/images/2024/basic-5.png\"
      alt=\"Right foot down, left foot raised\" loading=\"lazy\">\n  <p>\n    Step
      down onto the right leg, and lift my left leg into the air.\n  </p>\n</div>\n\n<p>Kick,
      kick, step.</p>\n\n<p>This was a smart way to start the class.\nIf you can balance
      on one foot, you can do this move.\nYou get that sense of achievement, and there\u2019s
      something satisfying about a whole room of people stepping in unison.</p>\n\n<p>From
      there, the class would gradually build to more complicated things \u2013 moves,
      turns, routines.\nBut we\u2019d always build something new in small steps, not
      doing too much at once.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/sdasmarchives/40556490133/\"><picture>
      \ <source srcset=\"/images/2024/step-step-step-2_1x.avif 450w, /images/2024/step-step-step-2_2x.avif
      900w, /images/2024/step-step-step-2_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/step-step-step-2_1x.webp
      450w, /images/2024/step-step-step-2_2x.webp 900w, /images/2024/step-step-step-2_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/step-step-step-2_1x.jpg 450w, /images/2024/step-step-step-2_2x.jpg
      900w, /images/2024/step-step-step-2_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/step-step-step-2_1x.jpg\"
      alt=\"A slide with the text \u201CStarting small is a good way to learn a new
      skill\u201D and a black-and-white photo of a man in a cool hat smiling and giving
      a thumbs up.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\"> </picture></a>\n
      \ <figcaption>\n    Photo: Bob Hoover.\n    From the <a href=\"https://www.flickr.com/photos/sdasmarchives/40556490133/\">San
      Diego Air &amp; Space Museum Archives</a>, no known copyright restrictions.\n
      \ </figcaption>\n</figure>\n\n<p>Starting small is a great way to learn a new
      skill, and this approach can apply in a lot of areas.</p>\n\n<p>If you\u2019re
      trying to learn a skill or embed a new habit, make the bar for success extremely
      low.\nThis is a one-two punch:</p>\n\n<ol>\n  <li>You\u2019ll get that sense
      of achievement, the dopamine hit of reaching your goal.</li>\n  <li>You avoid
      the negative emotion of setting the bar too high and falling short.</li>\n</ol>\n\n<p>The
      latter is a common mistake when we learn new skills as adults.\nWe\u2019re used
      to being good at things; we have high standards for ourselves.\nThen we try
      to learn something new, and we set our goal far too high, then we fall short,
      we bounce off.</p>\n\n<p>How many people have done this?\nPicked up a new skill,
      done it once, you weren\u2019t instantly good at it, so you never did it again.\n<em>[A
      lot of guilty faces in the audience for this one.]</em></p>\n\n<p>We don\u2019t
      like to be bad at things \u2013 but we can only learn if we push through the
      period of not being very good.\nWhen we\u2019re a beginner and we don\u2019t
      know very much, we need to set small goals and step forward gradually.</p>\n\n<p>This
      is where we come back to AI, to prompt engineering \u2013 which have been new
      skills for many of us in the last year or two.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/statelibraryofnsw/7627979920/\"><picture>
      \ <source srcset=\"/images/2024/7627979920_12d9c23b80_o_1x.avif 450w, /images/2024/7627979920_12d9c23b80_o_2x.avif
      900w, /images/2024/7627979920_12d9c23b80_o_3x.avif 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/7627979920_12d9c23b80_o_1x.webp
      450w, /images/2024/7627979920_12d9c23b80_o_2x.webp 900w, /images/2024/7627979920_12d9c23b80_o_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/7627979920_12d9c23b80_o_1x.jpg 450w, /images/2024/7627979920_12d9c23b80_o_2x.jpg
      900w, /images/2024/7627979920_12d9c23b80_o_3x.jpg 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/7627979920_12d9c23b80_o_1x.jpg\"
      alt=\"Black-and-white photo of a man passing over a high jump bar, as two officials
      watch from the sideline.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">
      </picture></a>\n  <figcaption>\n    High jump at the men's athletics, 1935.\n
      \   From the <a href=\"https://www.flickr.com/photos/statelibraryofnsw/7627979920/\">State
      Library of New South Wales</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>When
      I first tried these new generative AI tools, I was lured in by the big and flashy
      stuff.\nThat\u2019s what grabbed headlines; that\u2019s what grabbed my attention.\nI
      was reading Twitter, I thought <em>\u201Cthat looks fun, I want do to that\u201D</em>.</p>\n\n<p>I
      set a very high bar for what I wanted to achieve, and I wanted to replicate
      those cool results \u2013 but I didn\u2019t know what I was doing, so I couldn\u2019t
      do any of that cool stuff.\nSo I bounced off for months.\nI ignored these tools,
      because of the bitter taste of those initial failures.</p>\n\n<p>I only started
      doing useful stuff with these tools when I lowered my expectations.\nI wanted
      a small first step.\nWhat\u2019s a small step for AI?\nIt\u2019s a simple prompt;
      a single question; a single sentence.</p>\n\n<p>I went back and found the first
      ChatGPT sessions where I got something useful out of it.\nI was building a URL
      checker, I have a bunch of websites, I want to check they\u2019re up.\nI wanted
      to write a script to help me.\nSo I asked ChatGPT <em>\u201Chow do I fetch a
      single URL\u201D</em>.</p>\n\n<p>This is a simple task, something I could easily
      Google, and many of you probably already know how to do this.\nBut that\u2019s
      not the point \u2013 the point is that it gave me that initial feeling of success.\nIt
      was the first time I had that sense of <em>\u201Cooh, this could be useful\u201D</em>.</p>\n\n<p>I
      was able to build on that, and by asking more small questions I eventually got
      a non-trivial URL checker.\nA more experienced AI user could probably have written
      the entire program in a single prompt, and I couldn\u2019t, but that\u2019s
      okay \u2013 I still got something useful by asking a series of small, simple
      questions.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/sdasmarchives/40556490133/\"><picture>
      \ <source srcset=\"/images/2024/step-step-step-2_1x.avif 450w, /images/2024/step-step-step-2_2x.avif
      900w, /images/2024/step-step-step-2_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/step-step-step-2_1x.webp
      450w, /images/2024/step-step-step-2_2x.webp 900w, /images/2024/step-step-step-2_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/step-step-step-2_1x.jpg 450w, /images/2024/step-step-step-2_2x.jpg
      900w, /images/2024/step-step-step-2_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/step-step-step-2_1x.jpg\"
      alt=\"A slide with the text \u201CStarting small is a good way to learn a new
      skill\u201D and a black-and-white photo of a man in a cool hat smiling and giving
      a thumbs up.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\"> </picture></a>\n
      \ <figcaption>\n    Photo: Bob Hoover.\n    From the <a href=\"https://www.flickr.com/photos/sdasmarchives/40556490133/\">San
      Diego Air &amp; Space Museum Archives</a>, no known copyright restrictions.\n
      \ </figcaption>\n</figure>\n\n<p>So start small!\nThis is a really useful idea,
      and applies to so many things, not just dance or AI.</p>\n\n<p>But I forget
      it so often, because it\u2019s easy to be lured in by the hype, the impressive,
      the shiny.\nI have to keep reminding myself: start small, don\u2019t overreach
      yourself.</p>\n\n<figure>\n  <a href=\"https://en.wikipedia.org/wiki/File:Jitterbug_dancers_SLNSW_FL9435364.jpg\"><picture>
      \ <source srcset=\"/images/2024/Jitterbug_dancers_SLNSW_FL9435364_1x.avif 450w,
      /images/2024/Jitterbug_dancers_SLNSW_FL9435364_2x.avif 900w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/Jitterbug_dancers_SLNSW_FL9435364_1x.webp
      450w, /images/2024/Jitterbug_dancers_SLNSW_FL9435364_2x.webp 900w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/webp\"></source>  <source srcset=\"/images/2024/Jitterbug_dancers_SLNSW_FL9435364_1x.jpg
      450w, /images/2024/Jitterbug_dancers_SLNSW_FL9435364_2x.jpg 900w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/Jitterbug_dancers_SLNSW_FL9435364_1x.jpg\"
      alt=\"A black-and-white photo of two dancers. They're facing apart, with one
      leg on the ground, and the other leg pointing up and out (in the same direction).
      They're connected by a single hand, clearly in the middle of an energetic move.\"
      loading=\"lazy\" class=\"photo dark_aware\" width=\"450\"> </picture></a>\n
      \ <figcaption>\n    Jitterbug dancers in Sydney, 1948.\n    From the <a href=\"https://en.m.wikipedia.org/wiki/File:Jitterbug_dancers_SLNSW_FL9435364.jpg\">State
      Library of New South Wales</a>, public domain.\n  </figcaption>\n</figure>\n\n<p>But
      what happens when you want to move past the basics?</p>\n\n<p>In dancing, the
      next step is finding a partner.\nA lot of swing dances are partnered dances,
      there\u2019s a <a href=\"https://en.wikipedia.org/wiki/Lead_and_follow\">leader
      and a follower</a>.\nThe leader initiates the moves, the follower follows, together
      they make awesome dance magic.</p>\n\n<p>If you go back to the same classes
      and events, you dance with the same people.\nYou get to know them, what they
      can do, what they like and what they don\u2019t.\nYou develop a sense of rapport,
      and this is so important when dancing.\n<em>You have to find the right level
      of trust, what you both feel comfortable doing.</em>\nMaybe you\u2019re happy
      to dance a move with one person, but not with another.</p>\n\n<p>Let\u2019s
      look at a few examples.</p>\n\n<p>In the photo above, the couple are dancing
      some sort of hand-to-hand jitterbug routine.\nThis is the sort of thing that
      you can teach a beginner in a couple of hours; nothing weird is going on here;
      it\u2019s the sort of move most dancers would happily dance with a complete
      stranger.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/quinet/43506977094/in/photolist-29hyCwJ\"><picture>
      \ <source srcset=\"/images/2024/43506977094_d3611d8c1f_o_1x.avif 328w, /images/2024/43506977094_d3611d8c1f_o_2x.avif
      656w, /images/2024/43506977094_d3611d8c1f_o_3x.avif 984w\" sizes=\"(max-width:
      328px) 100vw, 328px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/43506977094_d3611d8c1f_o_1x.webp
      328w, /images/2024/43506977094_d3611d8c1f_o_2x.webp 656w, /images/2024/43506977094_d3611d8c1f_o_3x.webp
      984w\" sizes=\"(max-width: 328px) 100vw, 328px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/43506977094_d3611d8c1f_o_1x.jpg 328w, /images/2024/43506977094_d3611d8c1f_o_2x.jpg
      656w, /images/2024/43506977094_d3611d8c1f_o_3x.jpg 984w\" sizes=\"(max-width:
      328px) 100vw, 328px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/43506977094_d3611d8c1f_o_1x.jpg\"
      alt=\"Two dancers in the tandem Charleston, with a crowd in the background behind
      them. They're one in front of the other, holding hands at their sides, and both
      standing on their left leg as they lift their right in the air. They have big
      smiles on their faces, clearly having fun.\" class=\"photo dark_aware\" loading=\"lazy\"
      width=\"328\"> </picture></a>\n  <figcaption>\n    Tandem Charleston at a competition
      in Vancouver, 2018.\n    Photo by <a href=\"https://www.flickr.com/photos/quinet/43506977094/in/photolist-29hyCwJ\">Thomas
      Quine</a>, CC\_BY\_2.0.\n  </figcaption>\n</figure>\n\n<p>Next up, we have tandem
      Charleston.</p>\n\n<p>In this dance, the follower stands in front of the leader,
      they both face forward, and they\u2019re connected by their hands at their sides.\nIt\u2019s
      hard for them to talk to each other, and the follower can\u2019t see their leader.</p>\n\n<p>This
      is a fun dance that\u2019s easy to teach to beginners, but you can see it\u2019s
      a bit more of an awkward position.\nA lot of followers (especially women) aren\u2019t
      super comfortable dancing this with strangers, and would walk away if you tried
      it on a social dance floor.</p>\n\n<figure>\n  <picture>\n  \n  <source srcset=\"/images/2024/45271899c9e5613c13a6122fe4e7a95d_1x.avif
      328w, /images/2024/45271899c9e5613c13a6122fe4e7a95d_2x.avif 656w\" sizes=\"(max-width:
      328px) 100vw, 328px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/45271899c9e5613c13a6122fe4e7a95d_1x.webp
      328w, /images/2024/45271899c9e5613c13a6122fe4e7a95d_2x.webp 656w\" sizes=\"(max-width:
      328px) 100vw, 328px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/45271899c9e5613c13a6122fe4e7a95d_1x.jpg
      328w, /images/2024/45271899c9e5613c13a6122fe4e7a95d_2x.jpg 656w\" sizes=\"(max-width:
      328px) 100vw, 328px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2024/45271899c9e5613c13a6122fe4e7a95d_1x.jpg\"
      alt=\"Black-and-white photo of two dancers. The leader has lifted their follower
      up in the air, so the follower is upside down, their head facing the floor and
      her feet kicking towards the ceiling. She seems to be crying in delight (I hope!).\"
      loading=\"lazy\" class=\"photo dark_aware\" width=\"328\">\n</picture>\n  <figcaption>\n
      \   Source unknown.\n  </figcaption>\n</figure>\n\n<p>And finally we have aerials.\nThis
      is when your feet leave the ground, you\u2019re lifted up in the air.\nIn this
      case, the leader has lifted their follow and flipped her entirely upside down
      \u2013 and hopefully a few seconds later, she returned to the ground safely!</p>\n\n<p>This
      is obviously a much riskier move, and requires a lot of trust between the two
      partners.\nYou would never do this with a stranger, and I know a lot of experienced
      dancers who don\u2019t go near moves like this.</p>\n\n<picture>\n  \n  <source
      srcset=\"/images/2024/step-step-step-3_1x.avif 450w, /images/2024/step-step-step-3_2x.avif
      900w, /images/2024/step-step-step-3_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/step-step-step-3_1x.webp
      450w, /images/2024/step-step-step-3_2x.webp 900w, /images/2024/step-step-step-3_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/step-step-step-3_1x.png 450w, /images/2024/step-step-step-3_2x.png
      900w, /images/2024/step-step-step-3_3x.png 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2024/step-step-step-3_1x.png\"
      alt=\"Text slide. What do you feel comfortable doing?\" loading=\"lazy\" class=\"photo
      dark_aware\" width=\"450\">\n</picture>\n\n<p>The point is that trust isn\u2019t
      binary.\nYou have to find the right level of trust with your partner.</p>\n\n<p>What
      do you feel comfortable doing?</p>\n\n<p>And that question applies to generative
      AI as much as it does to dancing.\nIf you\u2019re using it for fun stuff, to
      make images or videos, that\u2019s one thing.\nIf you\u2019re using them for
      knowledge work, if you\u2019re relying on their output, that\u2019s quite another.\nIf
      you want to use these tools, you have to know how much you trust them.</p>\n\n<p>The
      right level of trust isn\u2019t absolute faith or complete scepticism; it\u2019s
      somewhere in the middle.\nMaybe you trust it for one thing, but not another.</p>\n\n<p>I\u2019ve
      seen a lot of discussions of prompt engineering that focus on the mechanical
      skills, without thinking about trust.\n<em>\u201CType in this text to get these
      results.\u201D</em>\nThat\u2019s important, but it\u2019s no good having those
      skills if you can\u2019t trust and use the results you get.</p>\n\n<picture>\n
      \ \n  <source srcset=\"/images/2024/step-step-step-4_1x.avif 450w, /images/2024/step-step-step-4_2x.avif
      900w, /images/2024/step-step-step-4_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/step-step-step-4_1x.webp
      450w, /images/2024/step-step-step-4_2x.webp 900w, /images/2024/step-step-step-4_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/step-step-step-4_1x.png 450w, /images/2024/step-step-step-4_2x.png
      900w, /images/2024/step-step-step-4_3x.png 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2024/step-step-step-4_1x.png\"
      alt=\"Text slide. How do we learn to trust?\" loading=\"lazy\" class=\"photo
      dark_aware\" width=\"450\">\n</picture>\n\n<p>How do we learn to trust AI?\nI
      think this will be a key question as we use more and more of these tools.\nHow
      do we build mental models of what we can trust?\nHow do we help everyone find
      the right level of trust for them?\nHow do we work out when we do and don\u2019t
      trust them?\nThe same techniques we\u2019ve already discussed can help \u2013
      start small, and work your way up.</p>\n\n<p>When you dance with a stranger,
      you don\u2019t jump straight to the most complex move in your repetoire \u2013
      you start with simpler moves, and you get a sense of each other\u2019s comfort.\nAre
      you both dancing energetically? Confidentally? Does it feel safe to do something
      more complicated?\nOr is your partner nervous? Wary? Perhaps at the edge of
      their comfort zone?</p>\n\n<p>We can do something similar with AI.\nOne thing
      I\u2019ve found useful when testing new tools is to ask it something simple,
      something I already know how to do.\nIf I see it doing a good job, I can start
      to trust it for similar tasks.\nIf it completely messes up, I know I can\u2019t
      trust it for this.</p>\n\n<picture>\n  \n  <source srcset=\"/images/2024/step-step-step-5_1x.avif
      450w, /images/2024/step-step-step-5_2x.avif 900w, /images/2024/step-step-step-5_3x.avif
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/step-step-step-5_1x.webp 450w, /images/2024/step-step-step-5_2x.webp
      900w, /images/2024/step-step-step-5_3x.webp 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/step-step-step-5_1x.png
      450w, /images/2024/step-step-step-5_2x.png 900w, /images/2024/step-step-step-5_3x.png
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/step-step-step-5_1x.png\" alt=\"Text slide. What do
      I trust AI for?\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">\n</picture>\n\n<p>So
      what do I trust AI for?\nI want to give you a few practical examples.</p>\n\n<p>I
      think it\u2019s important to work in areas where you already have a decent understanding.\nWe
      know these tools can hallucinate.\nWe know they can make stuff up.\nWe know
      they can go off the rails.</p>\n\n<p>The safeguard is us, the human, and we
      need to be able to spot when they\u2019ve gone off the rails and need guiding
      back to the straight and narrow.</p>\n\n<p>We all have different areas of competence
      and expertise \u2013 the areas where we trust AI are going to be different for
      each us.\nSo I might trust an AI to tell me about digital preservation or dance
      styles, but I wouldn\u2019t ask it questions about farming or firefighting or
      frogs.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/nationaalarchief/4026230486/\"><picture>
      \ <source srcset=\"/images/2024/4026230486_7768c56fbb_o_1x.avif 328w, /images/2024/4026230486_7768c56fbb_o_2x.avif
      656w\" sizes=\"(max-width: 328px) 100vw, 328px\" type=\"image/avif\"></source>
      \ <source srcset=\"/images/2024/4026230486_7768c56fbb_o_1x.webp 328w, /images/2024/4026230486_7768c56fbb_o_2x.webp
      656w\" sizes=\"(max-width: 328px) 100vw, 328px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/4026230486_7768c56fbb_o_1x.jpg 328w, /images/2024/4026230486_7768c56fbb_o_2x.jpg
      656w\" sizes=\"(max-width: 328px) 100vw, 328px\" type=\"image/jpeg\"></source>
      \ <img src=\"/images/2024/4026230486_7768c56fbb_o_1x.jpg\" alt=\"Black-and-white
      photo of a signpost with arrows pointing in all different directions, with a
      man looking down at a map and pondering his next move.\" loading=\"lazy\" class=\"photo
      dark_aware\" width=\"328\"> </picture></a>\n  <figcaption>\n    Sign post at
      Schiphol Airport.\n    From the <a href=\"https://www.flickr.com/photos/nationaalarchief/4026230486/\">Nationaal
      Archief of the Netherlands</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>Let\u2019s
      look at a few examples.</p>\n\n<p>One thing I use AI tools for is to generate
      a whole bunch of ideas, a whole bunch of questions, a sort of brainstorming
      tool.\nI give it a discussion topic, and rather than asking it for answers,
      I ask it to tell me what sort of things I should be considering.</p>\n\n<p>I
      used ChatGPT to help me write this talk.\nI described the broad premise of the
      talk, and I asked it to tell me what aspects I should consider.\nWhat should
      I discuss?\nWhat could I say?\nWhat might my audience want to hear?\nI didn\u2019t
      use any of its output directly, but it gave me some stuff to think about.\nSome
      of it was bad, some of it I already had, some of its suggestions were useful
      additions to the talk.</p>\n\n<p>This is an inversion of the prompter/promptee
      relationship: I\u2019m not giving the computer a topic to think about it; it\u2019s
      giving me topics to think about.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/lselibrary/3925727501/\"><picture>
      \ <source srcset=\"/images/2024/3925727501_1846eed489_o_1x.avif 450w, /images/2024/3925727501_1846eed489_o_2x.avif
      900w, /images/2024/3925727501_1846eed489_o_3x.avif 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/3925727501_1846eed489_o_1x.webp
      450w, /images/2024/3925727501_1846eed489_o_2x.webp 900w, /images/2024/3925727501_1846eed489_o_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/3925727501_1846eed489_o_1x.jpg 450w, /images/2024/3925727501_1846eed489_o_2x.jpg
      900w, /images/2024/3925727501_1846eed489_o_3x.jpg 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/3925727501_1846eed489_o_1x.jpg\"
      alt=\"Black-and-white photo of people looking at a shelf of encyclopedias in
      a library. The man closest the camera is already holding a stack of papers,
      and looking upwards owards one of the books.\" loading=\"lazy\" class=\"photo
      dark_aware\" width=\"450\"> </picture></a>\n  <figcaption>\n    Encyclopedias
      in the library, 1964.\n    From the <a href=\"https://www.flickr.com/photos/lselibrary/3925727501/\">London
      School of Economics</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>What
      if I want more than ideas, what if I want some facts?</p>\n\n<p>AI tools are
      unreliable sources of facts, and you always have to be careful.\nThey can make
      up nonsense, and repeat them as if they\u2019re facts with complete confidence
      and authority.\nIt\u2019s mansplaining as a service.</p>\n\n<p>But it\u2019s
      not like they don\u2019t know any facts, and sometimes they do get them right.\nThe
      right level of trust isn\u2019t absolute faith or complete scepticism, it\u2019s
      somewhere in between.\nHow do we know when to trust them?</p>\n\n<p>I\u2019ve
      settled on the idea that AI is like a friend who\u2019s read a Wikipedia article
      \u2013 maybe after having a few beers.\nThere\u2019s definitely something behind
      what they\u2019re remembering, but it may not always be right.\nI wouldn\u2019t
      rely on it for anything important, but if often contains a clue to something
      which is true \u2013 a name, an idea, some terminology that leads me towards
      more trustworthy reference material.</p>\n\n<figure>\n  <a href=\"https://www.flickr.com/photos/lselibrary/3925727501/\"><picture>
      \ <source srcset=\"/images/2024/52783665606_6e97cfdccf_o_1x.avif 450w, /images/2024/52783665606_6e97cfdccf_o_2x.avif
      900w, /images/2024/52783665606_6e97cfdccf_o_3x.avif 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/52783665606_6e97cfdccf_o_1x.webp
      450w, /images/2024/52783665606_6e97cfdccf_o_2x.webp 900w, /images/2024/52783665606_6e97cfdccf_o_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/52783665606_6e97cfdccf_o_1x.jpg 450w, /images/2024/52783665606_6e97cfdccf_o_2x.jpg
      900w, /images/2024/52783665606_6e97cfdccf_o_3x.jpg 1350w\" sizes=\"(max-width:
      450px) 100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/52783665606_6e97cfdccf_o_1x.jpg\"
      alt=\"A person with long, dark hair using a computer terminal. They're facing
      away from the camera, and holding some sort of stylus up to a monitor showing
      monospaced text.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">
      </picture></a>\n  <figcaption>\n    Somebody using a terminal in the OCCS computer
      room.\n    From the <a href=\"https://www.flickr.com/photos/nlmhmd/52783665606/\">United
      States Library of Medicine</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>And
      finally, I use AI for writing code.</p>\n\n<p>But again, I stick to areas where
      I already have some expertise.\nI use these tools to write code in languages
      I use, frameworks I\u2019m familiar with, problems that I can understand.</p>\n\n<p>When
      I\u2019m working with a team of human developers, I sometimes have to pass on
      doing a code review because I don\u2019t know enough to do a proper review.\nThat\u2019s
      my threshold for using AI tools \u2013 if I wouldn\u2019t be comfortable reviewing
      the code, I don\u2019t trust the two of us to write it together.\nThere\u2019s
      too much of a risk that I\u2019ll miss a subtle mistake or major bug.</p>\n\n<p>But
      that still leaves a lot of use cases!</p>\n\n<p>I use it for a lot of boilerplate
      code.\nIt\u2019s a good way to get certain repetitive utility functions.\nAnd
      it\u2019s particularly useful when there are tools that have a complicated interface,
      and I have to get the list of fiddly options correct (ffmpeg springs to mind).\nIt\u2019s
      quite tricky to get the right set of incantations, but once I\u2019ve got them
      it\u2019s easy to see if they\u2019re behaving correctly.</p>\n\n<figure>\n
      \ <a href=\"https://www.flickr.com/photos/library_of_congress/2179849680/\"><picture>
      \ <source srcset=\"/images/2024/step-step-step-6_1x.avif 450w, /images/2024/step-step-step-6_2x.avif
      900w, /images/2024/step-step-step-6_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/step-step-step-6_1x.webp
      450w, /images/2024/step-step-step-6_2x.webp 900w, /images/2024/step-step-step-6_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/step-step-step-6_1x.jpg 450w, /images/2024/step-step-step-6_2x.jpg
      900w, /images/2024/step-step-step-6_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/step-step-step-6_1x.jpg\"
      alt=\"Left: a list with three items. Giving me questions to consider; being
      a \u201Cfriend\u201D who's read the Wikipedia page; writing code. Right: a black-and-white
      photo of somebody welding a large piece of pipe.\" loading=\"lazy\" class=\"photo
      dark_aware\" width=\"450\"> </picture></a>\n  <figcaption>\n    Photo: gas welding
      a joint in a line of spiral pipe at the Douglas Dam, 1942.\n    From the <a
      href=\"https://www.flickr.com/photos/library_of_congress/2179849680/\">Library
      of Congress</a>, no known copyright restrictions.\n  </figcaption>\n</figure>\n\n<p>So
      those are a few of the things I trust generative AI for.\nThese are more evolutionary
      than revolutionary \u2013 these AI tools have become another thing in my toolbox,
      but they haven\u2019t fundamentally changed the way I work.\n(Yet.)</p>\n\n<p>Of
      course, you\u2019ll trust them for different things.\nDon\u2019t take this as
      a prescriptive list; take it as some ideas for how you might use AI.</p>\n\n<picture>\n
      \ \n  <source srcset=\"/images/2024/step-step-step-7_1x.avif 450w, /images/2024/step-step-step-7_2x.avif
      900w, /images/2024/step-step-step-7_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/step-step-step-7_1x.webp
      450w, /images/2024/step-step-step-7_2x.webp 900w, /images/2024/step-step-step-7_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/step-step-step-7_1x.jpg 450w, /images/2024/step-step-step-7_2x.jpg
      900w, /images/2024/step-step-step-7_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2024/step-step-step-7_1x.jpg\"
      alt=\"Text slide. Being a great dancer = having technical skills and knowing
      your level of trust.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">\n</picture>\n\n<p>So
      like a slow jazz number at the end of the evening, let\u2019s wrap things up.</p>\n\n<p>Being
      a great dancer: yes, it requires the technical skills.\nYou need to know the
      footwork, the moves, the rhythm.\nBut it\u2019s also about trust, knowing your
      partner, working out what they\u2019re comfortable with.</p>\n\n<picture>\n
      \ \n  <source srcset=\"/images/2024/step-step-step-8_1x.avif 450w, /images/2024/step-step-step-8_2x.avif
      900w, /images/2024/step-step-step-8_3x.avif 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/step-step-step-8_1x.webp
      450w, /images/2024/step-step-step-8_2x.webp 900w, /images/2024/step-step-step-8_3x.webp
      1350w\" sizes=\"(max-width: 450px) 100vw, 450px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/step-step-step-8_1x.jpg 450w, /images/2024/step-step-step-8_2x.jpg
      900w, /images/2024/step-step-step-8_3x.jpg 1350w\" sizes=\"(max-width: 450px)
      100vw, 450px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2024/step-step-step-8_1x.jpg\"
      alt=\"Text slide. Being a great AI user = having technical skills and knowing
      your level of trust. The word 'dancer' has been crossed out and replaced with
      'AI user'.\" loading=\"lazy\" class=\"photo dark_aware\" width=\"450\">\n</picture>\n\n<p>The
      same thing is true of using AI.\nYou need to know how to write prompts, how
      to get information, how to get the results you want.\nBut you also need to know
      if you trust those results, when you can rely on the output.</p>\n\n<p>We need
      both of those skills to be great users of AI.</p>\n\n\n    <p>[If the formatting
      of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/step-step-step/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"talks\"/>\n
      \   <category term=\"generative-ai\"/>\n    <summary type=\"html\">Swing dancing
      and prompt engineering are pretty different. But could learning one help us
      learn the other?</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">Moving
      my YouTube Likes from one account to another</title>\n    <link href=\"https://alexwlchan.net/2024/moving-youtube-likes/\"
      rel=\"alternate\" type=\"text/html\" title=\"Moving my YouTube Likes from one
      account to another\"/>\n    <published>2024-02-11T23:04:30+00:00</published>\n
      \   <updated>2024-02-11T23:04:30+00:00</updated>\n    <id>https://alexwlchan.net/2024/moving-youtube-likes</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/moving-youtube-likes/\"><![CDATA[\n<p>I
      used to have two YouTube accounts, and I wanted to consolidate them into one.</p>\n\n<p>I
      had two accounts as a way to keep two separate watch histories.\nI was watching
      videos about gender and trans stuff before I came out, and I didn\u2019t want
      them appearing in my main account \u2013 say, when I was listening to music
      at work.\nThat\u2019s less of a concern now than it was five or six years ago,
      and the lines between them have become blurry.\nI don\u2019t need two accounts
      any more.</p>\n\n<p>Because I only use YouTube for watching videos, and not
      posting, there were only three lists I really wanted to keep: my subscriptions,
      my Watch Later queue, and my Likes.\nMy subs and watch later were both small
      enough to copy by hand; the likes were the hard bit \u2013 I had about 1500
      or so.</p>\n\n<p>There\u2019s no built-in way to move Likes between YouTube
      accounts, so it was time to break out the YouTube API.</p>\n\n<h2 id=\"getting-authentication-working\">Getting
      authentication working</h2>\n\n<p>The first step was getting some API credentials.\nThis
      uses the Google Cloud console, which I\u2019m not super familiar with, but YouTube
      has a lot of quickstart guides and code samples which made the process much
      easier.</p>\n\n<p>I used the <a href=\"https://developers.google.com/youtube/v3/quickstart/python\">Python
      quickstart guide</a>, and went through the following steps:</p>\n\n<ol>\n  <li>Create
      a project in the Google Cloud console</li>\n  <li>Enable the YouTube Data API
      for that project</li>\n  <li>Create some OAuth credentials, which came in a
      JSON file I had to download</li>\n</ol>\n\n<p>At some point during this process,
      I had to create an OAuth consent screen.\nIf I was publishing this app for the
      world to use, you\u2019d see this as signing into the app, and it would have
      to be reviewed by Google.\nBecause I was only writing scripts for me, I was
      able to mostly skip this step \u2013 I left the app with a \u201Ctesting\u201D
      status, and just listed my two YouTube accounts as \u201Ctest users\u201D:</p>\n\n<picture>\n
      \ \n  \n  \n  <source srcset=\"/images/2024/google-cloud-oauth-consent_1x.png
      546w, /images/2024/google-cloud-oauth-consent_2x.png 1092w, /images/2024/google-cloud-oauth-consent_3x.png
      1638w\" sizes=\"(max-width: 546px) 100vw, 546px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/google-cloud-oauth-consent_1x.png\" alt=\"Screenshot
      of a settings screen in Google Cloud console. The panel is a titled \u2018OAuth
      consent screen\u2019, and there\u2019s a table labelled \u2018Test users\u2019.
      It has two rows with redacted email addresses, and buttons to add/remove users
      from the table.\" class=\"screenshot\" width=\"546\">\n</picture>\n\n<p>After
      this, I tried to run the <a href=\"https://developers.google.com/youtube/v3/docs/channels/list?apix=true\">sample
      Python script</a> from Google\u2019s documentation.\nIt didn\u2019t work \u2013
      it was written for an older version of the Python libraries.\nIn particular,
      it used <code class=\"language-plaintext highlighter-rouge\">flow.run_console()</code>,
      which uses an authentication method which has been deprecated for over a year.\nA
      <a href=\"https://stackoverflow.com/a/74834470/1558022\">Stack Overflow answer</a>
      suggested I use <code class=\"language-plaintext highlighter-rouge\">flow.run_local_server()</code>,
      and that was more successful.</p>\n\n<p>Here\u2019s the first script I got working,
      which is a modified version of the sample code:</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"kn\">import</span> <span class=\"n\">googleapiclient.discovery</span>
      \ <span class=\"c1\"># pip install google-api-python-client==1.7.2\n</span><span
      class=\"kn\">import</span> <span class=\"n\">google_auth_oauthlib.flow</span>
      \ <span class=\"c1\"># pip install google-auth-oauthlib==0.4.1\n</span>\n\n<span
      class=\"k\">def</span> <span class=\"nf\">create_youtube_client</span><span
      class=\"p\">(</span><span class=\"n\">client_secrets_file</span><span class=\"p\">):</span>\n
      \   <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Given the path to
      a JSON file with OAuth credentials from the\n    Google Cloud console, create
      an authenticated client.\n    </span><span class=\"sh\">\"\"\"</span>\n    <span
      class=\"n\">api_service_name</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span
      class=\"s\">youtube</span><span class=\"sh\">\"</span>\n    <span class=\"n\">api_version</span>
      <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">v3</span><span
      class=\"sh\">\"</span>\n    <span class=\"n\">scopes</span> <span class=\"o\">=</span>
      <span class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">https://www.googleapis.com/auth/youtube.readonly</span><span
      class=\"sh\">\"</span><span class=\"p\">]</span>\n\n    <span class=\"n\">flow</span>
      <span class=\"o\">=</span> <span class=\"n\">google_auth_oauthlib</span><span
      class=\"p\">.</span><span class=\"n\">flow</span><span class=\"p\">.</span><span
      class=\"n\">InstalledAppFlow</span><span class=\"p\">.</span><span class=\"nf\">from_client_secrets_file</span><span
      class=\"p\">(</span>\n        <span class=\"n\">client_secrets_file</span><span
      class=\"p\">,</span> <span class=\"n\">scopes</span>\n    <span class=\"p\">)</span>\n
      \   <span class=\"n\">credentials</span> <span class=\"o\">=</span> <span class=\"n\">flow</span><span
      class=\"p\">.</span><span class=\"nf\">run_local_server</span><span class=\"p\">()</span>\n\n
      \   <span class=\"n\">youtube</span> <span class=\"o\">=</span> <span class=\"n\">googleapiclient</span><span
      class=\"p\">.</span><span class=\"n\">discovery</span><span class=\"p\">.</span><span
      class=\"nf\">build</span><span class=\"p\">(</span>\n        <span class=\"n\">api_service_name</span><span
      class=\"p\">,</span> <span class=\"n\">api_version</span><span class=\"p\">,</span>
      <span class=\"n\">credentials</span><span class=\"o\">=</span><span class=\"n\">credentials</span>\n
      \   <span class=\"p\">)</span>\n\n    <span class=\"k\">return</span> <span
      class=\"n\">youtube</span>\n\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span>
      <span class=\"o\">==</span> <span class=\"sh\">\"</span><span class=\"s\">__main__</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span>\n    <span class=\"n\">youtube</span>
      <span class=\"o\">=</span> <span class=\"nf\">create_youtube_client</span><span
      class=\"p\">(</span>\n        <span class=\"n\">client_secrets_file</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">client_secret_12345.apps.googleusercontent.com.json</span><span
      class=\"sh\">\"</span>\n    <span class=\"p\">)</span>\n\n    <span class=\"n\">request</span>
      <span class=\"o\">=</span> <span class=\"n\">youtube</span><span class=\"p\">.</span><span
      class=\"nf\">channels</span><span class=\"p\">().</span><span class=\"nf\">list</span><span
      class=\"p\">(</span>\n        <span class=\"n\">part</span><span class=\"o\">=</span><span
      class=\"sh\">\"</span><span class=\"s\">snippet,contentDetails,statistics</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"n\">mine</span><span
      class=\"o\">=</span><span class=\"bp\">True</span>\n    <span class=\"p\">)</span>\n
      \   <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span
      class=\"p\">.</span><span class=\"nf\">execute</span><span class=\"p\">()</span>\n\n
      \   <span class=\"kn\">from</span> <span class=\"n\">pprint</span> <span class=\"kn\">import</span>
      <span class=\"n\">pprint</span><span class=\"p\">;</span> <span class=\"nf\">pprint</span><span
      class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>When
      I run this, the script kicks me out into a web browser, where I have to go through
      the usual Google login screen, and confirm I want to use this app.\nAfter I
      clicked through a few confirmation screens, my browser eventually got to a page
      that said:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code>The authentication flow has completed. You may close
      this window.\n</code></pre></div></div>\n\n<p>and back in my terminal window,
      the script was running and printing a list of my playlists.</p>\n\n<p>Already
      this was further than I\u2019d got in the past \u2013 I had an authenticated
      API client, and it was retrieving real data from my YouTube account.\nGood progress!</p>\n\n<h2
      id=\"making-the-authentication-better\">Making the authentication better</h2>\n\n<p>The
      authentication code above works, but it has two major issues:</p>\n\n<ul>\n
      \ <li>\n    <p>It\u2019s reading my OAuth client config from a JSON file on
      disk.\nCredentials should never be stored in plain text, so I want to put that
      somewhere more secure.</p>\n  </li>\n  <li>\n    <p>It doesn\u2019t remember
      the credentials from <code class=\"language-plaintext highlighter-rouge\">flow.run_local_server()</code>
      \u2013 every time I run the script, I have to go through the in-browser authentication
      flow.\nI was running the script many times as I gradually built up the code,
      and this quickly got annoying.</p>\n  </li>\n</ul>\n\n<p>Both of these issues
      can be solved using the <a href=\"https://pypi.org/project/keyring/\">keyring
      module</a>, which provides a platform-agnostic interface to the system password
      store (in my case, the login keychain on macOS).</p>\n\n<p>I changed the function
      to fetch the OAuth client config from the keychain, and to store retrieved credentials
      in the keychain.\nWhen I run it repeatedly, it retrieves the stored credentials
      rather than sending me back through the in-browser flow.</p>\n\n<p>After running
      these scripts for a while, I discovered that Google\u2019s OAuth credentials
      expire after about a week.\nI wrote some rudimentary code to handle credential
      expiry \u2013 it deletes the stored credentials, and sends me back through the
      in-browser flow.\nThere are almost certainly better ways to do this, but my
      simplistic approach worked well enough for my one-off script.</p>\n\n<p>Here\u2019s
      my updated function:</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span>
      <span class=\"n\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"n\">json</span>\n\n<span
      class=\"kn\">import</span> <span class=\"n\">google.oauth2.credentials</span>\n<span
      class=\"kn\">import</span> <span class=\"n\">googleapiclient.discovery</span>
      \ <span class=\"c1\"># pip install google-api-python-client==1.7.2\n</span><span
      class=\"kn\">import</span> <span class=\"n\">google_auth_oauthlib.flow</span>
      \ <span class=\"c1\"># pip install google-auth-oauthlib==0.4.1\n</span><span
      class=\"kn\">import</span> <span class=\"n\">keyring</span>\n\n\n<span class=\"k\">def</span>
      <span class=\"nf\">create_youtube_client</span><span class=\"p\">(</span><span
      class=\"n\">label</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span
      class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">\n
      \   Get an authenticated OAuth client for YouTube.\n\n    It gets the OAuth
      config from the system keychain, and caches\n    per-user credentials in the
      keychain under (</span><span class=\"sh\">\"</span><span class=\"s\">youtube</span><span
      class=\"sh\">\"</span><span class=\"s\">, label).\n    </span><span class=\"sh\">\"\"\"</span>\n
      \   <span class=\"n\">api_service_name</span> <span class=\"o\">=</span> <span
      class=\"sh\">\"</span><span class=\"s\">youtube</span><span class=\"sh\">\"</span>\n
      \   <span class=\"n\">api_version</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span
      class=\"s\">v3</span><span class=\"sh\">\"</span>\n    <span class=\"n\">scopes</span>
      <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"sh\">\"</span><span
      class=\"s\">https://www.googleapis.com/auth/youtube.readonly</span><span class=\"sh\">\"</span><span
      class=\"p\">]</span>\n\n    <span class=\"c1\"># Try to retrieve a stored OAuth
      access token from the keychain.\n</span>    <span class=\"c1\">#\n</span>    <span
      class=\"c1\"># This saves me going through the in-browser authentication flow\n</span>
      \   <span class=\"c1\"># if I've already run the script.\n</span>    <span class=\"n\">stored_credentials</span>
      <span class=\"o\">=</span> <span class=\"n\">keyring</span><span class=\"p\">.</span><span
      class=\"nf\">get_password</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">youtube</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"n\">label</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span>
      <span class=\"n\">stored_credentials</span> <span class=\"ow\">is</span> <span
      class=\"ow\">not</span> <span class=\"bp\">None</span><span class=\"p\">:</span>\n
      \       <span class=\"n\">json_credentials</span> <span class=\"o\">=</span>
      <span class=\"n\">json</span><span class=\"p\">.</span><span class=\"nf\">loads</span><span
      class=\"p\">(</span><span class=\"n\">stored_credentials</span><span class=\"p\">)</span>\n\n
      \       <span class=\"k\">if</span> <span class=\"sh\">\"</span><span class=\"s\">expiry</span><span
      class=\"sh\">\"</span> <span class=\"ow\">in</span> <span class=\"n\">json_credentials</span><span
      class=\"p\">:</span>\n            <span class=\"n\">expiry</span> <span class=\"o\">=</span>
      <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span
      class=\"p\">.</span><span class=\"nf\">fromisoformat</span><span class=\"p\">(</span><span
      class=\"n\">json_credentials</span><span class=\"p\">[</span><span class=\"sh\">\"</span><span
      class=\"s\">expiry</span><span class=\"sh\">\"</span><span class=\"p\">])</span>\n
      \           <span class=\"n\">expiry</span> <span class=\"o\">=</span> <span
      class=\"n\">expiry</span><span class=\"p\">.</span><span class=\"nf\">replace</span><span
      class=\"p\">(</span><span class=\"n\">tzinfo</span><span class=\"o\">=</span><span
      class=\"bp\">None</span><span class=\"p\">)</span>\n            <span class=\"n\">json_credentials</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">expiry</span><span
      class=\"sh\">\"</span><span class=\"p\">]</span> <span class=\"o\">=</span>
      <span class=\"n\">expir</span>\n\n        <span class=\"n\">credentials</span>
      <span class=\"o\">=</span> <span class=\"n\">google</span><span class=\"p\">.</span><span
      class=\"n\">oauth2</span><span class=\"p\">.</span><span class=\"n\">credentials</span><span
      class=\"p\">.</span><span class=\"nc\">Credentials</span><span class=\"p\">(</span><span
      class=\"o\">**</span><span class=\"n\">json_credentials</span><span class=\"p\">)</span>\n\n
      \   <span class=\"c1\"># If there are no stored credentials, fetch new ones.\n</span>
      \   <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"c1\">#
      Retrieve the OAuth client credentials from the keychain.\n</span>        <span
      class=\"c1\">#\n</span>        <span class=\"c1\"># This contains the contents
      of the JSON file that I downloaded\n</span>        <span class=\"c1\"># from
      the Google Cloud console, but now those credentials aren't\n</span>        <span
      class=\"c1\"># just saved as a plaintext file on disk.\n</span>        <span
      class=\"n\">stored_client_secrets</span> <span class=\"o\">=</span> <span class=\"n\">keyring</span><span
      class=\"p\">.</span><span class=\"nf\">get_password</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">youtube</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">client_secrets</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span>
      <span class=\"n\">stored_client_secrets</span> <span class=\"ow\">is</span>
      <span class=\"bp\">None</span><span class=\"p\">:</span>\n            <span
      class=\"k\">raise</span> <span class=\"nc\">ValueError</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">Could not find OAuth client secrets
      in keychain!</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n
      \       <span class=\"n\">flow</span> <span class=\"o\">=</span> <span class=\"n\">google_auth_oauthlib</span><span
      class=\"p\">.</span><span class=\"n\">flow</span><span class=\"p\">.</span><span
      class=\"n\">InstalledAppFlow</span><span class=\"p\">.</span><span class=\"nf\">from_client_config</span><span
      class=\"p\">(</span>\n            <span class=\"n\">client_config</span><span
      class=\"o\">=</span><span class=\"n\">json</span><span class=\"p\">.</span><span
      class=\"nf\">loads</span><span class=\"p\">(</span><span class=\"n\">stored_client_secrets</span><span
      class=\"p\">),</span> <span class=\"n\">scopes</span><span class=\"o\">=</span><span
      class=\"n\">scopes</span>\n        <span class=\"p\">)</span>\n        <span
      class=\"n\">credentials</span> <span class=\"o\">=</span> <span class=\"n\">flow</span><span
      class=\"p\">.</span><span class=\"nf\">run_local_server</span><span class=\"p\">()</span>\n\n
      \       <span class=\"c1\"># Save these credentials in the system keychain,
      so they can be\n</span>        <span class=\"c1\"># retrieved later.\n</span>
      \       <span class=\"n\">keyring</span><span class=\"p\">.</span><span class=\"nf\">set_password</span><span
      class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">youtube</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">label</span><span
      class=\"p\">,</span> <span class=\"n\">credentials</span><span class=\"p\">.</span><span
      class=\"nf\">to_json</span><span class=\"p\">())</span>\n\n    <span class=\"n\">youtube</span>
      <span class=\"o\">=</span> <span class=\"n\">googleapiclient</span><span class=\"p\">.</span><span
      class=\"n\">discovery</span><span class=\"p\">.</span><span class=\"nf\">build</span><span
      class=\"p\">(</span>\n        <span class=\"n\">api_service_name</span><span
      class=\"p\">,</span> <span class=\"n\">api_version</span><span class=\"p\">,</span>
      <span class=\"n\">credentials</span><span class=\"o\">=</span><span class=\"n\">credentials</span>\n
      \   <span class=\"p\">)</span>\n\n    <span class=\"c1\"># The OAuth credentials
      don't last forever -- they seem to expire after\n</span>    <span class=\"c1\">#
      a week.  This is a slightly ropey attempt to work around that.\n</span>    <span
      class=\"c1\">#\n</span>    <span class=\"c1\"># If we call the API and the saved
      token is expired, just delete\n</span>    <span class=\"c1\"># it and get new
      creds -- sending me back through the in-browser flow.\n</span>    <span class=\"c1\">#\n</span>
      \   <span class=\"c1\"># Notes:\n</span>    <span class=\"c1\">#\n</span>    <span
      class=\"c1\">#   - There are ways to refresh OAuth tokens that don't involve\n</span>
      \   <span class=\"c1\">#     sending me back through the in-browser flow, but
      I didn't\n</span>    <span class=\"c1\">#     look at them as part of this project.\n</span>
      \   <span class=\"c1\">#   - Catching all exceptions is a bit broad.  This code
      should really\n</span>    <span class=\"c1\">#     retry only if it gets a \"credentials
      expired\" exception, and\n</span>    <span class=\"c1\">#     throw any other
      exceptions immediately.\n</span>    <span class=\"c1\">#\n</span>    <span class=\"k\">try</span><span
      class=\"p\">:</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span>
      <span class=\"n\">youtube</span><span class=\"p\">.</span><span class=\"nf\">channels</span><span
      class=\"p\">().</span><span class=\"nf\">list</span><span class=\"p\">(</span><span
      class=\"n\">part</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span
      class=\"s\">snippet</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"n\">mine</span><span class=\"o\">=</span><span class=\"bp\">True</span><span
      class=\"p\">)</span>\n        <span class=\"n\">request</span><span class=\"p\">.</span><span
      class=\"nf\">execute</span><span class=\"p\">()</span>\n    <span class=\"k\">except</span>
      <span class=\"nb\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span
      class=\"p\">:</span>\n        <span class=\"n\">keyring</span><span class=\"p\">.</span><span
      class=\"nf\">delete_password</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">youtube</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"n\">label</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span>
      <span class=\"nf\">create_youtube_client</span><span class=\"p\">(</span><span
      class=\"n\">label</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span
      class=\"p\">:</span>\n        <span class=\"k\">return</span> <span class=\"n\">youtube</span>\n</code></pre></div></div>\n\n<p>This
      function is more complicated than Google\u2019s sample code, and there are more
      ways that it could be improved.\nAuthentication is hard!</p>\n\n<h2 id=\"actually-using-the-youtube-api\">Actually
      using the YouTube API</h2>\n\n<p>With an authenticated client, it was relatively
      straightforward to write code that interacts with YouTube\u2019s APIs.\nI\u2019ve
      lost the links, but I found snippets of sample code in Google\u2019s documentation
      that I was able to adapt.</p>\n\n<p>I started by wrapping the <code class=\"language-plaintext
      highlighter-rouge\">create_youtube_client</code> in a class, and writing a function
      to list all the videos I\u2019d liked:</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">class</span>
      <span class=\"nc\">YouTubeClient</span><span class=\"p\">:</span>\n    <span
      class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span
      class=\"n\">self</span><span class=\"p\">,</span> <span class=\"n\">label</span><span
      class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n
      \       <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">youtube</span>
      <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span
      class=\"nf\">create_youtube_client</span><span class=\"p\">(</span><span class=\"n\">label</span><span
      class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">create_youtube_client</span><span
      class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span>
      <span class=\"n\">label</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span
      class=\"p\">):</span>\n        <span class=\"err\">\u2026</span>\n\n    <span
      class=\"k\">def</span> <span class=\"nf\">get_liked_videos</span><span class=\"p\">(</span><span
      class=\"n\">self</span><span class=\"p\">):</span>\n        <span class=\"sh\">\"\"\"</span><span
      class=\"s\">\n        Generate a list of videos that this YouTube account has
      liked.\n        </span><span class=\"sh\">\"\"\"</span>\n        <span class=\"n\">kwargs</span>
      <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"sh\">\"</span><span
      class=\"s\">part</span><span class=\"sh\">\"</span><span class=\"p\">:</span>
      <span class=\"sh\">\"</span><span class=\"s\">snippet</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">playlistId</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span
      class=\"s\">LL</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"sh\">\"</span><span class=\"s\">maxResults</span><span class=\"sh\">\"</span><span
      class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">50</span><span
      class=\"sh\">\"</span><span class=\"p\">}</span>\n\n        <span class=\"k\">while</span>
      <span class=\"bp\">True</span><span class=\"p\">:</span>\n            <span
      class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span
      class=\"p\">.</span><span class=\"n\">youtube</span><span class=\"p\">.</span><span
      class=\"nf\">playlistItems</span><span class=\"p\">().</span><span class=\"nf\">list</span><span
      class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span
      class=\"p\">)</span>\n            <span class=\"n\">response</span> <span class=\"o\">=</span>
      <span class=\"n\">request</span><span class=\"p\">.</span><span class=\"nf\">execute</span><span
      class=\"p\">()</span>\n\n            <span class=\"k\">yield</span> <span class=\"k\">from</span>
      <span class=\"n\">response</span><span class=\"p\">[</span><span class=\"sh\">\"</span><span
      class=\"s\">items</span><span class=\"sh\">\"</span><span class=\"p\">]</span>\n\n
      \           <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span
      class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"sh\">\"</span><span
      class=\"s\">pageToken</span><span class=\"sh\">\"</span><span class=\"p\">]</span>
      <span class=\"o\">=</span> <span class=\"n\">response</span><span class=\"p\">[</span><span
      class=\"sh\">\"</span><span class=\"s\">nextPageToken</span><span class=\"sh\">\"</span><span
      class=\"p\">]</span>\n            <span class=\"k\">except</span> <span class=\"nb\">KeyError</span><span
      class=\"p\">:</span>\n                <span class=\"k\">break</span>\n</code></pre></div></div>\n\n<p>[<strong>Edit,
      15 February 2024:</strong> the original version of this code called the <code
      class=\"language-plaintext highlighter-rouge\">videos()</code> endpoint and
      filtered for my likes, but that was only able to see the first 1000 likes. That
      was fine for this project, where I was gradually deleting the list, but not
      in general. I\u2019ve changed it to use the <code class=\"language-plaintext
      highlighter-rouge\">playlistItems()</code> API, which seems to return the full
      set.]</p>\n\n<p>This generates videos in reverse order of liking them \u2013
      the most recently liked video comes first.\nThe items are large dicts which
      include various metadata fields about each video, of which the most interesting
      one to me is the ID:</p>\n\n<pre><code class=\"language-`python\">{'id': 'J-u2aW7T2bw',
      \u2026}\n{'id': 'XPaKAh2zxgk', \u2026}\n{'id': '-q7ZVXOU3kM', \u2026}\n</code></pre>\n\n<p>Then
      I wrote a couple of methods which like/unlike a video.\nBecause these are modifying
      data in YouTube, I had to change the <code class=\"language-plaintext highlighter-rouge\">scopes</code>
      to <code class=\"language-plaintext highlighter-rouge\">https://www.googleapis.com/auth/youtube</code>,
      replacing the <code class=\"language-plaintext highlighter-rouge\">youtube.readonly</code>
      scope I\u2019d been using previously.</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">class</span>
      <span class=\"nc\">YouTubeClient</span><span class=\"p\">:</span>\n    <span
      class=\"err\">\u2026</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">like_video</span><span
      class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span>
      <span class=\"o\">*</span><span class=\"p\">,</span> <span class=\"n\">video_id</span><span
      class=\"p\">):</span>\n        <span class=\"sh\">\"\"\"</span><span class=\"s\">\n
      \       Mark a video as </span><span class=\"sh\">\"</span><span class=\"s\">liked</span><span
      class=\"sh\">\"</span><span class=\"s\"> on YouTube.\n        </span><span class=\"sh\">\"\"\"</span>\n
      \       <span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span
      class=\"p\">.</span><span class=\"n\">youtube</span><span class=\"p\">.</span><span
      class=\"nf\">videos</span><span class=\"p\">().</span><span class=\"nf\">rate</span><span
      class=\"p\">(</span><span class=\"nb\">id</span><span class=\"o\">=</span><span
      class=\"n\">video_id</span><span class=\"p\">,</span> <span class=\"n\">rating</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">like</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n        <span class=\"n\">response</span>
      <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"p\">.</span><span
      class=\"nf\">execute</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span>
      <span class=\"nf\">unlike_video</span><span class=\"p\">(</span><span class=\"n\">self</span><span
      class=\"p\">,</span> <span class=\"o\">*</span><span class=\"p\">,</span> <span
      class=\"n\">video_id</span><span class=\"p\">):</span>\n        <span class=\"sh\">\"\"\"</span><span
      class=\"s\">\n        Remove the </span><span class=\"sh\">\"</span><span class=\"s\">liked</span><span
      class=\"sh\">\"</span><span class=\"s\"> rating from a video on YouTube.\n        </span><span
      class=\"sh\">\"\"\"</span>\n        <span class=\"n\">request</span> <span class=\"o\">=</span>
      <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">youtube</span><span
      class=\"p\">.</span><span class=\"nf\">videos</span><span class=\"p\">().</span><span
      class=\"nf\">rate</span><span class=\"p\">(</span><span class=\"nb\">id</span><span
      class=\"o\">=</span><span class=\"n\">video_id</span><span class=\"p\">,</span>
      <span class=\"n\">rating</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span
      class=\"s\">none</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n
      \       <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span
      class=\"p\">.</span><span class=\"nf\">execute</span><span class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>Putting
      these functions together, I was then able to write a short script which moved
      my likes from one account to the other:</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"n\">old_youtube</span> <span class=\"o\">=</span> <span class=\"nc\">YouTubeClient</span><span
      class=\"p\">(</span><span class=\"n\">label</span><span class=\"o\">=</span><span
      class=\"sh\">\"</span><span class=\"s\">old_account</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span>\n<span class=\"n\">new_youtube</span> <span class=\"o\">=</span>
      <span class=\"nc\">YouTubeClient</span><span class=\"p\">(</span><span class=\"n\">label</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">new_account</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"k\">for</span>
      <span class=\"n\">video</span> <span class=\"ow\">in</span> <span class=\"n\">old_youtube</span><span
      class=\"p\">.</span><span class=\"nf\">get_liked_videos</span><span class=\"p\">():</span>\n
      \   <span class=\"n\">video_id</span> <span class=\"o\">=</span> <span class=\"n\">video</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">id</span><span
      class=\"sh\">\"</span><span class=\"p\">]</span>\n\n    <span class=\"nf\">print</span><span
      class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">https://www.youtube.com/watch?v={video_id}</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">new_youtube</span><span
      class=\"p\">.</span><span class=\"nf\">like_video</span><span class=\"p\">(</span><span
      class=\"n\">video_id</span><span class=\"o\">=</span><span class=\"n\">video_id</span><span
      class=\"p\">)</span>\n    <span class=\"n\">old_youtube</span><span class=\"p\">.</span><span
      class=\"nf\">unlike_video</span><span class=\"p\">(</span><span class=\"n\">video_id</span><span
      class=\"o\">=</span><span class=\"n\">video_id</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>Removing
      the likes from the old account wasn\u2019t strictly necessary \u2013 I was planning
      to close the account when I was done \u2013 but it was an easy way to track
      the progress, and turned out to be helpful towards the end of the process (more
      on that below).</p>\n\n<p>Incidentally, around the time I wrote this code, David
      published a post about <a href=\"https://notebook.drmaciver.com/posts/2024-01-13-08:28.html\">writing
      good programming abstractions</a>, and I think this is a nice example of one.\nWrapping
      these API calls in a couple of named functions doesn\u2019t do anything to help
      de-duplication, but it does make the intent of the final script much clearer.</p>\n\n<h2
      id=\"running-the-code-in-practice\">Running the code in practice</h2>\n\n<p>By
      and large this code worked extremely well.\nAlmost all of the videos moved across
      seamlessly, and I could watch it in two side-by-side browser windows \u2013
      likes appeared in one account as they disappeared from the other.\nIt was substantially
      quicker and easier than if I\u2019d tried to do it by hand.</p>\n\n<p>I did
      run into a couple of non-obvious issues:</p>\n\n<ul>\n  <li>\n    <p>The YouTube
      API has a quota, and I burnt through it pretty quickly.\nYou get 10,000\_units
      per day, and rating a video (aka like/unlike) <a href=\"https://developers.google.com/youtube/v3/determine_quota_cost\">costs
      50\_units</a>.\nI had to make two calls to move each video (one like, one unlike),
      so I could only move about 100 videos a day.</p>\n\n    <p>The quota resets
      at midnight Pacific Time, or about 8am in London.\nI got into the habit of running
      the script once a day, every day, until I\u2019d moved my entire list of Liked
      videos.\nIt took a while, but still less than doing it by hand!</p>\n\n    <p>You
      can apply for a quota increase, but I didn\u2019t bother \u2013 I knew I\u2019d
      only run into the quota a handful of times, and it was easier to spread my runs
      over multiple days than fill in an application for more quota.\nThe docs say
      it can take a week or so to approve quota increases, by which I\u2019d probably
      be done.</p>\n  </li>\n  <li>\n    <p>Sometimes I\u2019d get a 403 error with
      the message <em>\u201CThe owner of the video that you are trying to rate has
      disabled ratings for that video\u201D</em>.</p>\n\n    <p>I\u2019m not sure
      what this means \u2013 if I opened the video in my web browser, I could still
      use the like/unlike buttons.\nThis only affected a handful of videos in my entire
      list, so I just used my web browser to move them across.</p>\n  </li>\n  <li>\n
      \   <p>The API couldn\u2019t see the last dozen or so videos.\nOn the last day
      of running the script, the <code class=\"language-plaintext highlighter-rouge\">get_liked_videos()</code>
      function returned an empty list, but I could still see some liked videos in
      the old account in my web browser.\nI\u2019m not sure why they were invisible
      to the API.</p>\n\n    <p>Again, because it was only a handful of videos, I
      moved them across by hand.</p>\n\n    <p>[<strong>Edit, 15 February 2024:</strong>
      I think this was caused by my use of the <code class=\"language-plaintext highlighter-rouge\">videos()</code>
      API instead of <code class=\"language-plaintext highlighter-rouge\">playlistItems()</code>;
      see above.]</p>\n  </li>\n</ul>\n\n<p>These were relatively minor issues, and
      easy to work around.\nAnd once I\u2019d finished running this script, I was
      able to close the old account and throw away this code \u2013 but maybe I\u2019ll
      come back to these notes if I have another interesting idea for using the YouTube
      API.</p>\n\n\n    <p>[If the formatting of this post looks odd in your feed
      reader, <a href=\"https://alexwlchan.net/2024/moving-youtube-likes/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"python\"/>\n
      \   <category term=\"youtube\"/>\n    <summary type=\"html\">Some experimenting
      with the YouTube API to merge two accounts into one.</summary>\n  </entry>\n
      \ <entry>\n    <title type=\"html\">Making a PDF that\u2019s larger than Germany</title>\n
      \   <link href=\"https://alexwlchan.net/2024/big-pdf/\" rel=\"alternate\" type=\"text/html\"
      title=\"Making a PDF that\u2019s larger than Germany\"/>\n    <published>2024-01-31T21:32:45+00:00</published>\n
      \   <updated>2024-01-31T21:32:45+00:00</updated>\n    <id>https://alexwlchan.net/2024/big-pdf</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/big-pdf/\"><![CDATA[\n<p>I
      was browsing social media this morning, and I saw a claim I\u2019ve seen go
      past a few times now \u2013 that there\u2019s a maximum size for a PDF document:</p>\n\n\n\n<div
      class=\"tweet\">\n  <blockquote>\n\n  \n  <div class=\"media media-1\">\n    \n
      \     <a href=\"https://twitter.com/TerribleMaps/status/1674813732260655106/photo/1\">\n
      \ <picture>\n  \n  <source srcset=\"/images/twitter/Fz4iNokXwAAv2hD_1x.avif
      496w, /images/twitter/Fz4iNokXwAAv2hD_2x.avif 992w, /images/twitter/Fz4iNokXwAAv2hD_3x.avif
      1488w\" sizes=\"(max-width: 496px) 100vw, 496px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/twitter/Fz4iNokXwAAv2hD_1x.webp 496w, /images/twitter/Fz4iNokXwAAv2hD_2x.webp
      992w, /images/twitter/Fz4iNokXwAAv2hD_3x.webp 1488w\" sizes=\"(max-width: 496px)
      100vw, 496px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/twitter/Fz4iNokXwAAv2hD_1x.jpg
      496w, /images/twitter/Fz4iNokXwAAv2hD_2x.jpg 992w, /images/twitter/Fz4iNokXwAAv2hD_3x.jpg
      1488w\" sizes=\"(max-width: 496px) 100vw, 496px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/twitter/Fz4iNokXwAAv2hD_1x.jpg\" data-proofer-ignore=\"\"
      width=\"496\">\n</picture>\n</a>\n\n    \n  </div>\n  \n\n    <div class=\"header\">\n
      \     \n      <div class=\"author\">\n        <a class=\"link\" href=\"https://twitter.com/TerribleMaps\">\n
      \         \n          <span class=\"name\" title=\"Terrible Maps\">Terrible
      Maps</span>\n          <span class=\"screen_name\" title=\"@TerribleMaps\">@TerribleMaps</span>\n
      \       </a>\n      </div>\n    </div>\n    <div class=\"body\">\n      <p class=\"text\">Maximum
      size of a PDF, version 7: 381 km \xD7 381 km.<br><br><a href=\"https://commons.m.wikimedia.org/wiki/File:Seitengr%C3%B6%C3%9Fe_PDF_7.svg\">https://commons.m.wikimedia.org/wiki/File:Seit\u2026</a></p>\n\n
      \     \n\n      <div class=\"metadata\">\n        <a href=\"https://twitter.com/TerribleMaps/status/1674813732260655106\">\n
      \         <time datetime=\"\">\n            \n          </time>\n        </a>\n
      \     </div>\n    </div>\n  </blockquote>\n</div>\n\n<p>Some version of this
      has been floating around the Internet <a href=\"https://twitter.com/hassmanm/status/303086542\">since
      2007</a>, probably earlier.\nThis tweet is pretty emblematic of posts about
      this claim: it\u2019s stated as pure fact, with no supporting evidence or explanation.\nWe\u2019re
      meant to just accept that a single PDF can only cover about half the area of
      Germany, and we\u2019re not given any reason why 381\_kilometres is the magic
      limit.</p>\n\n<p>I started wondering: has anybody made a PDF this big?\nHow
      hard would it be?\nCan you make a PDF that\u2019s even bigger?</p>\n\n<p>A few
      years ago I did some <a href=\"https://codegolf.stackexchange.com/a/48938/13285\">silly
      noodling into PostScript</a>, the precursor to PDF, and it was a lot of fun.\nI\u2019ve
      never actually dived into the internals of PDF, and this seems like a good opportunity.</p>\n\n<p>Let\u2019s
      dig in.</p>\n\n<h2 id=\"where-does-the-claim-come-from\">Where does the claim
      come from?</h2>\n\n<p>These posts are often accompanied by a \u201Cwell, actually\u201D
      where people in the replies explain this is a limitation of a particular PDF
      reader app, not a limitation of PDF itself.\nThey usually link to something
      like <a href=\"https://en.wikipedia.org/wiki/PDF#:~:text=Page%20dimensions%20are%20not%20limited%20by%20the%20format%20itself\">the
      Wikipedia article for PDF</a>, which explains:</p>\n\n<blockquote>\n  <p>Page
      dimensions are not limited by the format itself. However, Adobe Acrobat imposes
      a limit of 15\_million by 15\_million inches, or 225 trillion in<sup>2</sup>
      (145,161 km<sup>2</sup>).<a href=\"https://en.wikipedia.org/wiki/PDF#cite_note-pdf-ref-1.7-2\"><sup>[2]</sup></a></p>\n</blockquote>\n\n<p>If
      you follow the reference link, you find the <a href=\"https://web.archive.org/web/20081001170454/https://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf\">specification
      for PDF\_1.7</a>, where an appendix item explains in more detail (emphasis mine):</p>\n\n<blockquote>\n
      \ <p>In PDF versions earlier than PDF\_1.6, the size of the default user space
      unit is fixed at 1/72\_inch. In Acrobat viewers earlier than version 4.0, the
      minimum allowed page size is 72 by 72\_units in default user space (1 by 1\_inch);
      the maximum is 3240 by 3240\_units (45 by 45\_inches). In Acrobat versions 5.0
      and later, the minimum allowed page size is 3 by 3\_units (approximately 0.04
      by 0.04\_inch); the maximum is 14,400 by 14,400\_units (200 by 200\_inches).</p>\n\n
      \ <p>Beginning with PDF\_1.6, the size of the default user space unit may be
      set with the UserUnit entry of the page dictionary. <strong>Acrobat 7.0 supports
      a maximum UserUnit value of 75,000, which gives a maximum page dimension of
      15,000,000\_inches (14,400 * 75,000 * 1 \u2044 72).</strong> The minimum UserUnit
      value is 1.0 (the default).</p>\n</blockquote>\n\n<p>15\_million inches is exactly
      381\_kilometres, matching the number in the original tweet.\nAnd although this
      limit first appeared in PDF\_1.6, it\u2019s \u201Cversion 7\u201D of Adobe Acrobat.\nThis
      is probably where the original claim comes from.</p>\n\n<p>What if we make a
      PDF that exceeds these \u201Cmaximum\u201D values?</p>\n\n<h2 id=\"the-inner-structure-of-pdfs\">The
      inner structure of PDFs</h2>\n\n<p>I\u2019ve never dived into the internals
      of a PDF document \u2013 I\u2019ve occasionally glimpsed some bits in a hex
      editor, but I\u2019ve never really understood how they work.\nIf I\u2019m going
      to be futzing around for fun, this is a good opportunity to learn how to edit
      the PDF directly, rather than going through a library.</p>\n\n<p>I found <a
      href=\"https://help.callassoftware.com/a/798383-how-to-create-a-simple-pdf-file\">a
      good article</a> which explains the internal structure of a PDF, and combined
      with asking ChatGPT a few questions, I was able to get enough to write some
      simple files by hand.</p>\n\n<p>I know that PDFs support a huge number of features,
      so this is probably a gross oversimplification, but this is the mental picture
      I created:</p>\n\n\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0
      0 280 560\" role=\"img\" aria-labelledby=\"svg_pdf_layout\" class=\"dark_aware\">\n
      \ <defs>\n    <style>\n      rect.pdf_component {\n        stroke: currentColor;\n
      \       stroke-width: 1;\n      }\n\n      text.monospace {\n        font-size:
      12pt;\n        font-family: monospace;\n\t\t\t\ttext-anchor: middle;\n\t\t\t\tdominant-baseline:
      middle;\n      }\n\n      text {\n        fill: currentColor;\n      }\n\n      path.arrow
      {\n        stroke: currentColor;\n        stroke-width: 1.75;\n        stroke-linecap:
      round;\n        fill: none;\n        marker-end: url(#arrowhead);\n      }\n\n
      \     path.dashed {\n        stroke: currentColor;\n        stroke-width: 1.75;\n
      \       stroke-dasharray: 2 2;\n      }\n\n      #arrowhead polygon {\n        fill:
      currentColor;\n      }\n    </style>\n\n    <marker id=\"arrowhead\" markerwidth=\"7\"
      markerheight=\"4.9\" refx=\"0\" refy=\"2.45\" orient=\"auto\">\n      <polygon
      points=\"0 0, 7 2.45, 0 4.9\"></polygon>\n    </marker>\n  </defs>\n\n  \n  <path
      class=\"arrow\" d=\"M 230 470 L 270 470 L 270 350 L 250 350\" marker-end=\"url(#arrowhead)\"></path>\n\n
      \ <rect x=\"50\" y=\"10\" width=\"180\" height=\"40\" class=\"pdf_component\"></rect>\n
      \ <text x=\"140\" y=\"30\" class=\"monospace\">%PDF-1.6</text>\n\n  <rect x=\"50\"
      y=\"70\" width=\"180\" height=\"240\" class=\"object_wrapper\"></rect>\n  <text
      x=\"140\" y=\"85\" text-anchor=\"middle\" dominant-baseline=\"middle\" font-size=\"10pt\">objects</text>\n\n
      \ <rect x=\"80\" y=\"100\" width=\"120\" height=\"40\" class=\"pdf_component\"></rect>\n
      \ <text x=\"140\" y=\"120\" class=\"monospace\">object 1</text>\n\n  <rect x=\"80\"
      y=\"150\" width=\"120\" height=\"40\" class=\"pdf_component\"></rect>\n  <text
      x=\"140\" y=\"170\" class=\"monospace\">object 2</text>\n\n  <path class=\"dashed\"
      d=\"M 140 195 L 140 245\"></path>\n\n  <rect x=\"80\" y=\"250\" width=\"120\"
      height=\"40\" class=\"pdf_component\"></rect>\n  <text x=\"140\" y=\"270\" class=\"monospace\">object
      N</text>\n\n  \n  <path class=\"arrow\" d=\"M 50 350 L 10 350 L 10 270 L 62
      270\" marker-end=\"url(#arrowhead)\"></path>\n  <path class=\"arrow\" d=\"M
      50 350 L 10 350 L 10 220 L 62 220\" marker-end=\"url(#arrowhead)\"></path>\n
      \ <path class=\"arrow\" d=\"M 50 350 L 10 350 L 10 170 L 62 170\" marker-end=\"url(#arrowhead)\"></path>\n
      \ <path class=\"arrow\" d=\"M 50 350 L 10 350 L 10 120 L 62 120\" marker-end=\"url(#arrowhead)\"></path>\n\n
      \ <rect x=\"50\" y=\"330\" width=\"180\" height=\"40\" class=\"pdf_component\"></rect>\n
      \ <text x=\"140\" y=\"350\" class=\"monospace\">xref</text>\n\n  <rect x=\"50\"
      y=\"390\" width=\"180\" height=\"40\" class=\"pdf_component\"></rect>\n  <text
      x=\"140\" y=\"410\" class=\"monospace\">trailer</text>\n\n  <rect x=\"50\" y=\"450\"
      width=\"180\" height=\"40\" class=\"pdf_component\"></rect>\n  <text x=\"140\"
      y=\"470\" class=\"monospace\">startxref</text>\n\n  <rect x=\"50\" y=\"510\"
      width=\"180\" height=\"40\" class=\"pdf_component\"></rect>\n  <text x=\"140\"
      y=\"530\" class=\"monospace\">%%EOF</text>\n<title id=\"svg_pdf_layout\">tbc</title></svg>\n\n<p>The
      start and end of a PDF file are always the same: a version number (<code class=\"language-plaintext
      highlighter-rouge\">%PDF-1.6</code>) and an end-of-file marker (<code class=\"language-plaintext
      highlighter-rouge\">%%EOF</code>).</p>\n\n<p>After the version number comes
      a long list of objects.\nThere are lots of types of objects, for all the various
      things you can find in a PDF, including the pages, the text, and the graphics.</p>\n\n<p>After
      that list comes the <code class=\"language-plaintext highlighter-rouge\">xref</code>
      or cross-reference table, which is a lookup table for the objects.\nIt points
      to all the objects in the file: it tells you that object 1 is 10\_bytes after
      the start, object 2 is after 20\_bytes, object 3 is after 30\_bytes, and so
      on.\nBy looking at this table, a PDF reading app knows how many objects there
      are in the file, and where to find them.</p>\n\n<p>The <code class=\"language-plaintext
      highlighter-rouge\">trailer</code> contains some metadata about the overall
      document, like the number of pages and whether it\u2019s encrypted.</p>\n\n<p>Finally,
      the <code class=\"language-plaintext highlighter-rouge\">startxref</code> value
      is a pointer to the start of the <code class=\"language-plaintext highlighter-rouge\">xref</code>
      table.\nThis is where a PDF reading app starts: it works from the end of the
      file until it finds the <code class=\"language-plaintext highlighter-rouge\">startxref</code>
      value, then it can go and read the <code class=\"language-plaintext highlighter-rouge\">xref</code>
      table and learn about all the objects.</p>\n\n<p>With this knowledge, I was
      able to write my first PDF by hand.\nIf you save this code into a file named
      <code class=\"language-plaintext highlighter-rouge\">myexample.pdf</code>, it
      should open and show a page with a red square in a PDF reading app:</p>\n\n<pre
      class=\"highlight\"><code><span class=\"c\">%PDF-1.6\n\n% The first object.
      \ The start of every object is marked by:\n%\n%     &lt;object number&gt; &lt;generation
      number&gt; obj\n%\n% (The generation number is used for versioning, and is usually
      0.)\n%\n% This is object 1, so it starts as `1 0 obj`.  The second object will\n%
      start with `2 0 obj`, then `3 0 obj`, and so on.  The end of each object\n%
      is marked by `endobj`.\n%\n% This is a \"stream\" object that draws a shape.
      \ First I specify the\n% length of the stream (54\_bytes).  Then I select a
      colour as an\n% RGB value (`1 0 0 RG` = red), then I set a line width (`5 w`)
      and\n% finally I give it a series of coordinates for drawing the square:\n%\n%
      \    (100, 100) ----&gt; (200, 100)\n%                          |\n%     [s
      = start]          |\n%         ^                |\n%         |                |\n%
      \        |                v\n%     (100, 200) &lt;---- (200, 200)\n%</span>\n1
      0 obj\n&lt;&lt;\n\t/Length 54\n&gt;&gt;\nstream\n1 0 0 RG\n5 w\n100 100 m\n200
      100 l\n200 200 l\n100 200 l\ns\nendstream\nendobj\n\n<span class=\"c\">% The
      second object.\n%\n% This is a \"Page\" object that defines a single page.  It
      contains a\n% single object: object 1, the red square.  This is the line `1
      0 R`.\n%\n% The \"R\" means \"Reference\", and `1 0 R` is saying \"look at object
      number 1\n% with generation number 0\" -- and object 1 is the red square.\n%\n%
      It also points to a \"Pages\" object that contains the information about\n%
      all the pages in the PDF -- this is the reference `3 0 R`.</span>\n2 0 obj\n&lt;&lt;\n\t/Type
      /Page\n\t/Parent 3 0 R\n\t/MediaBox [0 0 300 300]\n\t/Contents 1 0 R\n&gt;&gt;\nendobj\n\n<span
      class=\"c\">% The third object.\n%\n% This is a \"Pages\" object that contains
      information about the different\n% pages.  The `2 0 R` is reference to the \"Page\"
      object, defined above.</span>\n3 0 obj\n&lt;&lt;\n\t/Type /Pages\n\t/Kids [2
      0 R ]\n\t/Count 1\n&gt;&gt;\nendobj\n\n<span class=\"c\">% The fourth object.\n%\n%
      This is a \"Catalog\" object that provides the main structure of the PDF.\n%
      It points to a \"Pages\" object that contains information about the\n% different
      pages -- this is the reference `3 0 R`.</span>\n4 0 obj\n&lt;&lt;\n\t/Type /Catalog\n\t/Pages
      3 0 R\n&gt;&gt;\nendobj\n\n<span class=\"c\">% The xref table.  This is a lookup
      table for all the objects.\n%\n% I'm not entirely sure what the first entry
      is for, but it seems to be\n% important.  The remaining entries correspond to
      the objects I created.</span>\nxref\n0 4\n0000000000 65535 f\n0000000851 00000
      n\n0000001396 00000 n\n0000001655 00000 n\n0000001934 00000 n\n\n<span class=\"c\">%
      The trailer.  This contains some metadata about the PDF.  Here there\n% are
      two entries, which tell us that:\n%\n%   - There are 4 entries in the `xref`
      table.\n%   - The root of the document is object 4 (the \"Catalog\" object)\n%</span>\ntrailer\n&lt;&lt;\n\t/Size
      4\n\t/Root 4 0 R\n&gt;&gt;\n\n<span class=\"c\">% The startxref marker tells
      us that we can find the xref table 2196\_bytes\n% after the start of the file.</span>\nstartxref\n2196\n\n<span
      class=\"c\">% The end-of-file marker.\n%%EOF</span></code></pre>\n\n<p>I played
      with this file for a while, just doing simple things like adding extra shapes,
      changing how the shapes appeared, and putting different shapes on different
      pages.\nI tried for a while to get text working, but that was a bit beyond me.</p>\n\n<p>It
      quickly became apparent why nobody writes PDFs by hand \u2013 it got very fiddly
      to redo all the lookup tables!\nBut I\u2019m glad I did it; manipulating all
      the PDF objects and their references really helped me feel like I understand
      the basic model of PDFs.\nI opened some \u201Creal\u201D PDFs created by other
      apps, and they have many more objects and types of object \u2013 but now I could
      at least follow some of what\u2019s going on.</p>\n\n<p>With this newfound ability
      to edit PDFs by hand, how can I create monstrously big ones?</p>\n\n<h2 id=\"changing-the-page-size-mediabox-and-userunit\">Changing
      the page size: /MediaBox and /UserUnit</h2>\n\n<p>Within a PDF, the size of
      each page is set on the individual \u201CPage\u201D objects \u2013 this allows
      different pages to be different sizes.\nWe\u2019ve already seen this once:</p>\n\n\n\n<pre><code>&lt;&lt;\n\t/Type
      /Page\n\t/Parent 3 0 R\n\t<span class=\"mediaBox\">/MediaBox [0 0 300 300]</span>\n\t/Contents
      1 0 R\n&gt;&gt;</code></pre>\n\n<p>Here, the <code class=\"language-plaintext
      highlighter-rouge\">MediaBox</code> is setting the width and height of the page
      \u2013 in this case, a square of 300 \xD7 300\_units.\nThe default unit size
      is 1/72\_inch, so the page is 300 \xD7 72 = 4.17\_inches.\nAnd indeed, if I
      open this PDF in Adobe Acrobat, that\u2019s what it reports:</p>\n\n<picture>\n
      \ <source srcset=\"/images/2024/adobe-acrobat-pdf-4in.dark_1x.avif 724w, /images/2024/adobe-acrobat-pdf-4in.dark_2x.avif
      1448w\" sizes=\"(max-width: 724px) 100vw, 724px\" type=\"image/avif\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n<source srcset=\"/images/2024/adobe-acrobat-pdf-4in.dark_1x.webp
      724w, /images/2024/adobe-acrobat-pdf-4in.dark_2x.webp 1448w\" sizes=\"(max-width:
      724px) 100vw, 724px\" type=\"image/webp\" media=\"(prefers-color-scheme: dark)\"></source>\n\n<source
      srcset=\"/images/2024/adobe-acrobat-pdf-4in.dark_1x.png 724w, /images/2024/adobe-acrobat-pdf-4in.dark_2x.png
      1448w\" sizes=\"(max-width: 724px) 100vw, 724px\" type=\"image/png\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n\n  <source srcset=\"/images/2024/adobe-acrobat-pdf-4in_1x.avif
      724w, /images/2024/adobe-acrobat-pdf-4in_2x.avif 1448w\" sizes=\"(max-width:
      724px) 100vw, 724px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/adobe-acrobat-pdf-4in_1x.webp
      724w, /images/2024/adobe-acrobat-pdf-4in_2x.webp 1448w\" sizes=\"(max-width:
      724px) 100vw, 724px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/adobe-acrobat-pdf-4in_1x.png
      724w, /images/2024/adobe-acrobat-pdf-4in_2x.png 1448w\" sizes=\"(max-width:
      724px) 100vw, 724px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2024/adobe-acrobat-pdf-4in_1x.png\"
      alt=\"Screenshot of Acrobat\u2019s \u2018Document Properties\u2019 panel, showing
      the page size of 4.17 x 4.17 in.\" loading=\"lazy\" width=\"724\" class=\"dark_aware\">\n</picture>\n\n<p>By
      changing the <code class=\"language-plaintext highlighter-rouge\">MediaBox</code>
      value, we can make the page bigger.\nFor example, if we change the value to
      <code class=\"language-plaintext highlighter-rouge\">600 600</code>, Acrobat
      says it\u2019s now <code class=\"language-plaintext highlighter-rouge\">8.33
      x 8.33 in</code>.\nNice!</p>\n\n<p>We can increase it all the way to <code class=\"language-plaintext
      highlighter-rouge\">14400 14400</code>, the max allowed by Acrobat, and then
      it says the page is now <code class=\"language-plaintext highlighter-rouge\">200.00
      x 200.00in</code>.\n(You <a href=\"/images/2024/acrobat-error.png\">get a warning</a>
      if you try to push past that limit.)</p>\n\n<p>But 200\_inches is far short
      of 381\_kilometres \u2013 and that\u2019s because we\u2019re using the default
      unit of 1/72\_inch.\nWe can increase the unit size by adding a <code class=\"language-plaintext
      highlighter-rouge\">/UserUnit</code> value.\nFor exaple, setting the value to
      2 will double the page in both dimensions:</p>\n\n<pre><code>&lt;&lt;\n\t/Type
      /Page\n\t/Parent 3 0 R\n\t<span class=\"mediaBox\">/MediaBox [0 0 14400 14400]</span>\n\t<span
      class=\"mediaBox\">/UserUnit 2</span>\n\t/Contents 1 0 R\n&gt;&gt;</code></pre>\n\n<p>And
      now Acrobat reports the size of the page as <code class=\"language-plaintext
      highlighter-rouge\">400.00 x 400.00 in</code>.</p>\n\n<p>If we crank it all
      the way up to the maximum of <code class=\"language-plaintext highlighter-rouge\">UserUnit
      75000</code>, Acrobat now reports the size of our page as <code class=\"language-plaintext
      highlighter-rouge\">15,000,000.00 x 15,000,000.00 in</code> \u2013 381 km along
      both sides, matching the original claim.\nIf you\u2019re curious, you can <a
      href=\"/files/2024/biggest.pdf\">download the PDF</a>.</p>\n\n<p>If you try
      to create a page with a larger size, either by increasing the <code class=\"language-plaintext
      highlighter-rouge\">MediaBox</code> or <code class=\"language-plaintext highlighter-rouge\">UserUnit</code>
      values, Acrobat just ignores it.\nIt keeps saying that the size of a page is
      15\_million inches, even if the page metadata says it\u2019s higher.\n(And if
      you increase the <code class=\"language-plaintext highlighter-rouge\">UserUnit</code>
      past <code class=\"language-plaintext highlighter-rouge\">75000</code>, this
      happens silently \u2013 there\u2019s no warning or error to suggest the size
      of the page is being capped.)</p>\n\n<p>[<strong>Edit, 1 February 2024:</strong>
      some extra zeroes slipped into the original version of this post \u2013 it\u2019s
      a million inches, not a billion. Thanks to <a href=\"https://news.ycombinator.com/item?id=39211537\">mrb
      on Hacker News</a> for spotting the mistake!]</p>\n\n<p>This probably isn\u2019t
      an issue \u2013 I don\u2019t think the <code class=\"language-plaintext highlighter-rouge\">UserUnit</code>
      value is widely used in practice.\nI found <a href=\"https://stackoverflow.com/a/59927201/1558022\">one
      Stack Overflow answer</a> saying as such, and I couldn\u2019t find any examples
      of it online.\nThe builtin macOS Preview.app doesn\u2019t even support it \u2013
      it completely ignores the value, and treats all PDFs as if the unit size is
      1/72\_inch.</p>\n\n<p>But unlike Acrobat, the Preview app doesn\u2019t have
      an upper limit on what we can put in <code class=\"language-plaintext highlighter-rouge\">MediaBox</code>.\nIt\u2019s
      perfectly happy for me to write a width which is a 1 followed by twelve 0s:</p>\n\n<picture>\n
      \ <source srcset=\"/images/2024/preview-megawide.dark_1x.avif 366w, /images/2024/preview-megawide.dark_2x.avif
      732w\" sizes=\"(max-width: 366px) 100vw, 366px\" type=\"image/avif\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n<source srcset=\"/images/2024/preview-megawide.dark_1x.webp
      366w, /images/2024/preview-megawide.dark_2x.webp 732w\" sizes=\"(max-width:
      366px) 100vw, 366px\" type=\"image/webp\" media=\"(prefers-color-scheme: dark)\"></source>\n\n<source
      srcset=\"/images/2024/preview-megawide.dark_1x.png 366w, /images/2024/preview-megawide.dark_2x.png
      732w\" sizes=\"(max-width: 366px) 100vw, 366px\" type=\"image/png\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n\n  <source srcset=\"/images/2024/preview-megawide_1x.avif
      366w, /images/2024/preview-megawide_2x.avif 732w\" sizes=\"(max-width: 366px)
      100vw, 366px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/preview-megawide_1x.webp
      366w, /images/2024/preview-megawide_2x.webp 732w\" sizes=\"(max-width: 366px)
      100vw, 366px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/preview-megawide_1x.png
      366w, /images/2024/preview-megawide_2x.png 732w\" sizes=\"(max-width: 366px)
      100vw, 366px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2024/preview-megawide_1x.png\"
      alt=\"Screenshot of Preview\u2019s Document inspector, showing the page size
      of 35277777777.78 x 10.59 cm.\" loading=\"lazy\" width=\"366\" class=\"dark_aware\">\n</picture>\n\n<p>If
      you\u2019re curious, that width is approximately the distance between the Earth
      and the Moon.\nI\u2019d have to get my ruler to check, but I\u2019m pretty sure
      that\u2019s larger than Germany.</p>\n\n<p>I could keep going.\nAnd I did.\nEventually
      I ended up with a PDF that Preview claimed is larger than the entire universe
      \u2013 approximately 37 trillion light years square.\nAdmittedly it\u2019s mostly
      empty space, but so is the universe.\nIf you\u2019d like to play with that PDF,
      you can <a href=\"/files/2024/universe.pdf\">get it here</a>.</p>\n\n<p>Please
      don\u2019t try to print it.</p>\n\n\n    <p>[If the formatting of this post
      looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/big-pdf/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"drawing-things\"/>\n
      \   <category term=\"code-crimes\"/>\n    <summary type=\"html\">We\u2019re
      gonna need a bigger printer.</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">The
      Collected Works of Ian Flemingo</title>\n    <link href=\"https://alexwlchan.net/2024/ian-flemingo/\"
      rel=\"alternate\" type=\"text/html\" title=\"The Collected Works of Ian Flemingo\"/>\n
      \   <published>2024-01-21T11:24:04+00:00</published>\n    <updated>2024-01-21T11:24:04+00:00</updated>\n
      \   <id>https://alexwlchan.net/2024/ian-flemingo</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2024/ian-flemingo/\"><![CDATA[\n<p>On Monday
      evening, about two hundred Mincefluencers descended on the Fortune Theatre for
      \u201COperation Human Thermos\u201D, a fan gathering to celebrate <em>Operation
      Mincemeat</em>, <a href=\"https://www.operationmincemeat.com/\">a musical</a>
      that gives us all the warm and fuzzies.\nA lot of people dressed in cosplay
      to mark the occasion, and I joined in the fun.\n(If you want to see photos,
      Harry has <a href=\"https://twitter.com/HarryBower_/status/1746971616934793273\">a
      great thread</a> on Twitter.)</p>\n\n<picture>\n  \n  <source srcset=\"/images/2024/flemingo_1x.avif
      220w, /images/2024/flemingo_2x.avif 440w, /images/2024/flemingo_3x.avif 660w\"
      sizes=\"(max-width: 220px) 100vw, 220px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/flemingo_1x.webp 220w, /images/2024/flemingo_2x.webp
      440w, /images/2024/flemingo_3x.webp 660w\" sizes=\"(max-width: 220px) 100vw,
      220px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/flemingo_1x.jpg
      220w, /images/2024/flemingo_2x.jpg 440w, /images/2024/flemingo_3x.jpg 660w\"
      sizes=\"(max-width: 220px) 100vw, 220px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2024/flemingo_1x.jpg\" alt=\"A small flamingo hand-puppet
      with a black bow tie on its neck, with a flamingo neck and two fluffy, flappy
      arms.\" width=\"220\">\n</picture>\n\n<p>Accompanying me was Flemingo, a hand-puppet
      flamingo who\u2019s become a constant companion when I go to the show.\n(Why
      a flamingo?\nBecause of <a href=\"https://www.youtube.com/watch?v=70Q5ljDokFA&amp;t=134s\">one
      verse in a single song</a> that has turned the humble flamingo into an icon
      in the fandom.)</p>\n\n<p>Both of us were wearing bow ties to cosplay as Ian
      Fleming, who\u2019s both a character in the musical and the co-author of a memo
      that laid the seeds for the real-life operation.\nAnd Ian Fleming was a part-time
      novelist, part-time spy, so it made sense for us to be carrying a stack of his
      books.</p>\n\n<p>I did look in a couple of charity shops for old Ian Fleming
      novels, but I couldn\u2019t find any.\nLacking real books, I decided that the
      only alternative was to make my own.</p>\n\n<p>This led to a series of props
      that are, if anything, over-arsed: the Collected Works of Ian Flemingo.\nThese
      are a collection of postcards with covers based on the real James Bond books\u2026
      sort of:</p>\n\n<picture>\n  \n  <source srcset=\"/images/2024/ian-flemingo-fronts2_1x.avif
      750w, /images/2024/ian-flemingo-fronts2_2x.avif 1500w, /images/2024/ian-flemingo-fronts2_3x.avif
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/ian-flemingo-fronts2_1x.webp 750w, /images/2024/ian-flemingo-fronts2_2x.webp
      1500w, /images/2024/ian-flemingo-fronts2_3x.webp 2250w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/ian-flemingo-fronts2_1x.png
      750w, /images/2024/ian-flemingo-fronts2_2x.png 1500w, /images/2024/ian-flemingo-fronts2_3x.png
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/ian-flemingo-fronts2_1x.png\" alt=\"A series of eight
      book covers, arranged in a grid. Each cover is in a bright colour and has the
      silhouette of a bird. The titles are: Flamingo Royale, The Man with the Golden
      Gull, Goldfincher, Dodos Ar Forever, On His Majesty's Secret Stork, Loonraker,
      Dr Crow, The Magpie Who Loved Me\" width=\"750\">\n</picture>\n\n<p>I got the
      idea over Christmas, and annoyed my family by coming up with increasingly tenuous
      ideas for James <s>Bond</s> Bird puns.\nThis was lots of fun, and I came up
      with so many ideas \u2013 for every one you see, there are two more I didn\u2019t
      use.</p>\n\n<p>The design of the covers are loosely based on a real set of <a
      href=\"https://www.ianfleming.com/introducing-new-fleming-007-hardback-editions/\">hardback
      editions</a>, without the fancy art.\nFor the images, I turned to <a href=\"https://www.phylopic.org/\">PhyloPic</a>,
      a site I bookmarked years ago and I\u2019ve been waiting for a good reason to
      use.\nIt provides free silhouette images of animals and plants, and I was able
      to pick a set of bird images with CC0 licenses.\n(<a href=\"https://www.phylopic.org/images/a1244226-f2c2-41dc-b113-f1c6545958ce/phoenicopterus-roseus\">Flamingo</a>,
      <a href=\"https://www.phylopic.org/images/1e45eae7-b1eb-4a08-9e1f-4f34f2fb7710/larus-argentatus\">gull</a>,
      <a href=\"https://www.phylopic.org/images/44b8d744-7db7-4533-b3ea-29db99fb276f/haemorhous-purpureus\">goldfinch</a>,
      <a href=\"https://www.phylopic.org/images/01bbffec-312c-493a-bcd3-e9361ed3435d/raphus-cucullatus\">dodo</a>,
      <a href=\"https://www.phylopic.org/images/db5c0243-52bf-4a2b-a27c-0a0c34469522/gavia-immer\">loon</a>,
      <a href=\"https://www.phylopic.org/images/d8b80938-61d0-4b06-ab28-d631fb545131/mycteria-americana\">stork</a>,
      <a href=\"https://www.phylopic.org/images/2db31c7c-b0a9-460f-807e-da9181f21cf6/corvus-brachyrhynchos\">crow</a>,
      <a href=\"https://www.phylopic.org/images/87d6a89a-9044-49cd-b708-086c847735f2/terpsiphone-paradisi\">magpie</a>)</p>\n\n<p>I\u2019d
      like to say the rainbow spread was intentional, but really I just kept picking
      colours I hadn\u2019t used yet \u2013 I didn\u2019t arrange them in this order
      until I had them printed.</p>\n\n<picture>\n  \n  <source srcset=\"/images/2024/ian-flemingo-backs2_1x.avif
      750w, /images/2024/ian-flemingo-backs2_2x.avif 1500w, /images/2024/ian-flemingo-backs2_3x.avif
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/ian-flemingo-backs2_1x.webp 750w, /images/2024/ian-flemingo-backs2_2x.webp
      1500w, /images/2024/ian-flemingo-backs2_3x.webp 2250w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/ian-flemingo-backs2_1x.png
      750w, /images/2024/ian-flemingo-backs2_2x.png 1500w, /images/2024/ian-flemingo-backs2_3x.png
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/ian-flemingo-backs2_1x.png\" alt=\"A series of the
      backs of the books, arranged in a fan-like shape. On the back of each book is
      a blurb filling most of the page, then a barcode and some text at the bottom.\"
      width=\"750\">\n</picture>\n\n<p>On the other side of the cards, I wrote pun-filled
      blurbs that are based loosely on the original books.\nI got the original blurbs
      from Amazon listings, then stuffed them with puns and references to the show.\nAt
      one point I did consider including testimonials from characters, but I didn\u2019t
      have space.</p>\n\n<p>The books are published by \u201CEl Otro Editora\u201D,
      a reference to <a href=\"https://twitter.com/spitlip/status/1747330685986066878\">\u201CEl
      Otro Periodico\u201D</a>, a fan-produced newspaper, which is in turn named after
      the line \u201Cel otro telefono\u201D.\nThe price is \u201C6d\u201D, which is
      the one mistake that really irks me \u2013 I meant the cost to be a ha\u2019penny,
      but instead it\u2019s half a shilling.\nOops.\n(Why a ha\u2019penny?\nBecause
      of a line in the show.)</p>\n\n<p>My favourite touch is the barcodes in the
      corner.\nThis is what makes it feel like a \u201Creal\u201D book to me \u2013
      and every book has a unique barcode, and they can be scanned!</p>\n\n<p>Initially
      I picked random numbers as the ISBNs, but I got worried about where they might
      be pointing \u2013 maybe I\u2019d accidentally pick a real ISBN that pointed
      at an offensive book?</p>\n\n<p>Then I looked for ISBNs that could be used safely.\nFor
      example, I know there are <a href=\"https://www.ofcom.org.uk/phones-telecoms-and-internet/information-for-industry/numbering/numbers-for-drama\">telephone
      numbers</a> that are reserved for fictional purposes, so a phone number that
      appears in a TV show won\u2019t accidentally lead to a deluge of calls for the
      person on the other end.\nBut although lots of ISBNs are used for fiction books,
      there aren\u2019t any ranges reserved for fiction<em>al</em> books.\n(And yes,
      I did look up the <a href=\"https://www.isbn-international.org/range_file_generation\">ISBN
      specifications</a> to see if there were any ranges reserved for this purpose.\nThis
      project is nothing if not ridiculous.)</p>\n\n<p>Finally, I did the obvious
      thing \u2013 I just dropped in the ISBNs for the original Ian Fleming books.\nSo
      if you scan the barcodes, you\u2019ll find a James Bond book.</p>\n\n<p>I printed
      the cards themselves using <a href=\"https://www.instantprint.co.uk/\">InstantPrint</a>,
      who did a great job \u2013 the cards feel nice in the hand, and they were delivered
      quickly on a tight deadline.</p>\n\n<figure>\n  <picture>\n  \n  <source srcset=\"/images/2024/ian-flemingo-stacks_1x.avif
      750w, /images/2024/ian-flemingo-stacks_2x.avif 1500w, /images/2024/ian-flemingo-stacks_3x.avif
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/ian-flemingo-stacks_1x.webp 750w, /images/2024/ian-flemingo-stacks_2x.webp
      1500w, /images/2024/ian-flemingo-stacks_3x.webp 2250w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/ian-flemingo-stacks_1x.jpg
      750w, /images/2024/ian-flemingo-stacks_2x.jpg 1500w, /images/2024/ian-flemingo-stacks_3x.jpg
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2024/ian-flemingo-stacks_1x.jpg\" alt=\"Eight piles of
      postcards laid out on a table, each for a different postcard. The stacks are
      visibly tall, maybe an inch or so tall.\" class=\"photo\" width=\"750\">\n</picture>\n
      \ <figcaption>\n    Most of the cost was in the initial print run; adding extra
      copies was cheap.\n    As in \u201Cdouble the number of copies for \xA31 extra\u201D
      cheap.\n    So I printed a faintly ridiculous amount.\n  </figcaption>\n</figure>\n\n<p>Most
      of my work is purely digital, so I always enjoy when I get to actually hold
      something I\u2019ve made.\nIn the week leading up to the event, I found myself
      taking them out of my bag and just turning them over in my hands as I admired
      the shiny, shiny thing.\nI don\u2019t expect to print more of these particular
      books, but I can see myself doing more custom postcards in future \u2013 it\u2019s
      nice to have physical souvenirs in an increasingly online world.</p>\n\n<p>I
      gave out a bunch of the postcards as OHT souvenirs on Monday, and people liked
      them!\nI also got to gave some sets <a href=\"https://twitter.com/spitlip/status/1748768746854855116\">to
      the cast</a> at stage door today, which got rid of the rest of the prints.\nI
      had fun making them, and I\u2019m so glad that people are enjoying them.</p>\n\n<p>Small
      flashes of joy, indeed.</p>\n\n\n    <p>[If the formatting of this post looks
      odd in your feed reader, <a href=\"https://alexwlchan.net/2024/ian-flemingo/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"books\"/>\n
      \   <category term=\"theatre\"/>\n    <summary type=\"html\">A fledgling author
      uses a theatre trip to leave the nest. (Or: some props I made for a cosplay
      event.)</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">The best
      way to tell a website your age</title>\n    <link href=\"https://alexwlchan.net/2024/best-age-picker/\"
      rel=\"alternate\" type=\"text/html\" title=\"The best way to tell a website
      your age\"/>\n    <published>2024-01-07T21:11:31+00:00</published>\n    <updated>2024-01-07T21:11:31+00:00</updated>\n
      \   <id>https://alexwlchan.net/2024/best-age-picker</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2024/best-age-picker/\"><![CDATA[\n<p>There\u2019s
      a growing number of countries creating laws that require age verification laws
      to access certain content online.\nNow children can be protected from adult
      content like well-organised spreadsheets, YouTube videos about kitchen appliances,
      and websites that sell you socks.\nThese laws are a brilliant idea that will
      definitely fix everything.</p>\n\n<p>However, there is one point of contention:
      how should websites ask for your age?</p>\n\n<p>I\u2019ve done some thinking,
      and I\u2019ve come up with a proposal.\nWe all know the best way to tell somebody\u2019s
      age is to count the candles on their birthday cake, so I\u2019ve built a cake-based
      interface.</p>\n\n\n\n<p id=\"reducedMotionWarning\">\n  (If these animations
      are distracting, you can <a onclick=\"script:toggleAllAnimations()\" data-proofer-ignore=\"\">toggle
      them off/on</a>.)\n</p>\n\n<div id=\"cakeInput\">\n  <h1>&lt;input type=\"age\"&gt;</h1>\n\n
      \ \n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"
      viewbox=\"0 0 54 110\" height=\"220\" role=\"img\" aria-labelledby=\"svg_animated-birthday-cake\"
      id=\"animated-birthday-cake\">\n  <animate attributename=\"viewBox\" values=\"0
      0 54 110; 0 0 2054 110;\" dur=\"50s\"></animate>\n\n  <defs>\n    <mask id=\"upperCurlyLine\">\n
      \     <rect x=\"0\" y=\"0\" width=\"2054\" height=\"100\" fill=\"white\"></rect>\n\n
      \     <svg x=\"2\" y=\"37.5\">\n        <path d=\"           M 5 10           A
      5 5 0 0 1 15 10           A 5 5 0 0 0 25 10           A 5 5 0 0 1 35 10           A
      5 5 0 0 0 45 10           A 5 5 0 0 1 55 10           A 5 5 0 0 0 65 10           A
      5 5 0 0 1 75 10           A 5 5 0 0 0 85 10           A 5 5 0 0 1 95 10           A
      5 5 0 0 0 105 10           A 5 5 0 0 1 115 10           A 5 5 0 0 0 125 10           A
      5 5 0 0 1 135 10           A 5 5 0 0 0 145 10           A 5 5 0 0 1 155 10           A
      5 5 0 0 0 165 10           A 5 5 0 0 1 175 10           A 5 5 0 0 0 185 10           A
      5 5 0 0 1 195 10           A 5 5 0 0 0 205 10           A 5 5 0 0 1 215 10           A
      5 5 0 0 0 225 10           A 5 5 0 0 1 235 10           A 5 5 0 0 0 245 10           A
      5 5 0 0 1 255 10           A 5 5 0 0 0 265 10           A 5 5 0 0 1 275 10           A
      5 5 0 0 0 285 10           A 5 5 0 0 1 295 10           A 5 5 0 0 0 305 10           A
      5 5 0 0 1 315 10           A 5 5 0 0 0 325 10           A 5 5 0 0 1 335 10           A
      5 5 0 0 0 345 10           A 5 5 0 0 1 355 10           A 5 5 0 0 0 365 10           A
      5 5 0 0 1 375 10           A 5 5 0 0 0 385 10           A 5 5 0 0 1 395 10           A
      5 5 0 0 0 405 10           A 5 5 0 0 1 415 10           A 5 5 0 0 0 425 10           A
      5 5 0 0 1 435 10           A 5 5 0 0 0 445 10           A 5 5 0 0 1 455 10           A
      5 5 0 0 0 465 10           A 5 5 0 0 1 475 10           A 5 5 0 0 0 485 10           A
      5 5 0 0 1 495 10           A 5 5 0 0 0 505 10           A 5 5 0 0 1 515 10           A
      5 5 0 0 0 525 10           A 5 5 0 0 1 535 10           A 5 5 0 0 0 545 10           A
      5 5 0 0 1 555 10           A 5 5 0 0 0 565 10           A 5 5 0 0 1 575 10           A
      5 5 0 0 0 585 10           A 5 5 0 0 1 595 10           A 5 5 0 0 0 605 10           A
      5 5 0 0 1 615 10           A 5 5 0 0 0 625 10           A 5 5 0 0 1 635 10           A
      5 5 0 0 0 645 10           A 5 5 0 0 1 655 10           A 5 5 0 0 0 665 10           A
      5 5 0 0 1 675 10           A 5 5 0 0 0 685 10           A 5 5 0 0 1 695 10           A
      5 5 0 0 0 705 10           A 5 5 0 0 1 715 10           A 5 5 0 0 0 725 10           A
      5 5 0 0 1 735 10           A 5 5 0 0 0 745 10           A 5 5 0 0 1 755 10           A
      5 5 0 0 0 765 10           A 5 5 0 0 1 775 10           A 5 5 0 0 0 785 10           A
      5 5 0 0 1 795 10           A 5 5 0 0 0 805 10           A 5 5 0 0 1 815 10           A
      5 5 0 0 0 825 10           A 5 5 0 0 1 835 10           A 5 5 0 0 0 845 10           A
      5 5 0 0 1 855 10           A 5 5 0 0 0 865 10           A 5 5 0 0 1 875 10           A
      5 5 0 0 0 885 10           A 5 5 0 0 1 895 10           A 5 5 0 0 0 905 10           A
      5 5 0 0 1 915 10           A 5 5 0 0 0 925 10           A 5 5 0 0 1 935 10           A
      5 5 0 0 0 945 10           A 5 5 0 0 1 955 10           A 5 5 0 0 0 965 10           A
      5 5 0 0 1 975 10           A 5 5 0 0 0 985 10           A 5 5 0 0 1 995 10           A
      5 5 0 0 0 1005 10           A 5 5 0 0 1 1015 10           A 5 5 0 0 0 1025 10
      \          A 5 5 0 0 1 1035 10           A 5 5 0 0 0 1045 10           A 5 5
      0 0 1 1055 10           A 5 5 0 0 0 1065 10           A 5 5 0 0 1 1075 10           A
      5 5 0 0 0 1085 10           A 5 5 0 0 1 1095 10           A 5 5 0 0 0 1105 10
      \          A 5 5 0 0 1 1115 10           A 5 5 0 0 0 1125 10           A 5 5
      0 0 1 1135 10           A 5 5 0 0 0 1145 10           A 5 5 0 0 1 1155 10           A
      5 5 0 0 0 1165 10           A 5 5 0 0 1 1175 10           A 5 5 0 0 0 1185 10
      \          A 5 5 0 0 1 1195 10           A 5 5 0 0 0 1205 10           A 5 5
      0 0 1 1215 10           A 5 5 0 0 0 1225 10           A 5 5 0 0 1 1235 10           A
      5 5 0 0 0 1245 10           A 5 5 0 0 1 1255 10           A 5 5 0 0 0 1265 10
      \          A 5 5 0 0 1 1275 10           A 5 5 0 0 0 1285 10           A 5 5
      0 0 1 1295 10           A 5 5 0 0 0 1305 10           A 5 5 0 0 1 1315 10           A
      5 5 0 0 0 1325 10           A 5 5 0 0 1 1335 10           A 5 5 0 0 0 1345 10
      \          A 5 5 0 0 1 1355 10           A 5 5 0 0 0 1365 10           A 5 5
      0 0 1 1375 10           A 5 5 0 0 0 1385 10           A 5 5 0 0 1 1395 10           A
      5 5 0 0 0 1405 10           A 5 5 0 0 1 1415 10           A 5 5 0 0 0 1425 10
      \          A 5 5 0 0 1 1435 10           A 5 5 0 0 0 1445 10           A 5 5
      0 0 1 1455 10           A 5 5 0 0 0 1465 10           A 5 5 0 0 1 1475 10           A
      5 5 0 0 0 1485 10           A 5 5 0 0 1 1495 10           A 5 5 0 0 0 1505 10
      \          A 5 5 0 0 1 1515 10           A 5 5 0 0 0 1525 10           A 5 5
      0 0 1 1535 10           A 5 5 0 0 0 1545 10           A 5 5 0 0 1 1555 10           A
      5 5 0 0 0 1565 10           A 5 5 0 0 1 1575 10           A 5 5 0 0 0 1585 10
      \          A 5 5 0 0 1 1595 10           A 5 5 0 0 0 1605 10           A 5 5
      0 0 1 1615 10           A 5 5 0 0 0 1625 10           A 5 5 0 0 1 1635 10           A
      5 5 0 0 0 1645 10           A 5 5 0 0 1 1655 10           A 5 5 0 0 0 1665 10
      \          A 5 5 0 0 1 1675 10           A 5 5 0 0 0 1685 10           A 5 5
      0 0 1 1695 10           A 5 5 0 0 0 1705 10           A 5 5 0 0 1 1715 10           A
      5 5 0 0 0 1725 10           A 5 5 0 0 1 1735 10           A 5 5 0 0 0 1745 10
      \          A 5 5 0 0 1 1755 10           A 5 5 0 0 0 1765 10           A 5 5
      0 0 1 1775 10           A 5 5 0 0 0 1785 10           A 5 5 0 0 1 1795 10           A
      5 5 0 0 0 1805 10           A 5 5 0 0 1 1815 10           A 5 5 0 0 0 1825 10
      \          A 5 5 0 0 1 1835 10           A 5 5 0 0 0 1845 10           A 5 5
      0 0 1 1855 10           A 5 5 0 0 0 1865 10           A 5 5 0 0 1 1875 10           A
      5 5 0 0 0 1885 10           A 5 5 0 0 1 1895 10           A 5 5 0 0 0 1905 10
      \          A 5 5 0 0 1 1915 10           A 5 5 0 0 0 1925 10           A 5 5
      0 0 1 1935 10           A 5 5 0 0 0 1945 10           A 5 5 0 0 1 1955 10           A
      5 5 0 0 0 1965 10           A 5 5 0 0 1 1975 10           A 5 5 0 0 0 1985 10
      \          A 5 5 0 0 1 1995 10           A 5 5 0 0 0 2005 10           A 5 5
      0 0 1 2015 10           A 5 5 0 0 0 2025 10           A 5 5 0 0 1 2035 10           A
      5 5 0 0 0 2045 10           A 5 5 0 0 1 2055 10           A 5 5 0 0 0 2065 10
      \          A 5 5 0 0 1 2075 10           A 5 5 0 0 0 2085 10           A 5 5
      0 0 1 2095 10           \" stroke=\"black\" stroke-width=\"2\" fill=\"none\"></path>\n
      \     </svg>\n    </mask>\n\n    <mask id=\"lowerCurlyLine\">\n      <rect x=\"0\"
      y=\"0\" width=\"2054\" height=\"100\" fill=\"white\"></rect>\n\n      <svg x=\"-3\"
      y=\"73\">\n        <path d=\"           M 0 10           A 5 5 0 0 1 10 10           A
      5 5 0 0 0 20 10           A 5 5 0 0 1 30 10           A 5 5 0 0 0 40 10           A
      5 5 0 0 1 50 10           A 5 5 0 0 0 60 10           A 5 5 0 0 1 70 10           A
      5 5 0 0 0 80 10           A 5 5 0 0 1 90 10           A 5 5 0 0 0 100 10           A
      5 5 0 0 1 110 10           A 5 5 0 0 0 120 10           A 5 5 0 0 1 130 10           A
      5 5 0 0 0 140 10           A 5 5 0 0 1 150 10           A 5 5 0 0 0 160 10           A
      5 5 0 0 1 170 10           A 5 5 0 0 0 180 10           A 5 5 0 0 1 190 10           A
      5 5 0 0 0 200 10           A 5 5 0 0 1 210 10           A 5 5 0 0 0 220 10           A
      5 5 0 0 1 230 10           A 5 5 0 0 0 240 10           A 5 5 0 0 1 250 10           A
      5 5 0 0 0 260 10           A 5 5 0 0 1 270 10           A 5 5 0 0 0 280 10           A
      5 5 0 0 1 290 10           A 5 5 0 0 0 300 10           A 5 5 0 0 1 310 10           A
      5 5 0 0 0 320 10           A 5 5 0 0 1 330 10           A 5 5 0 0 0 340 10           A
      5 5 0 0 1 350 10           A 5 5 0 0 0 360 10           A 5 5 0 0 1 370 10           A
      5 5 0 0 0 380 10           A 5 5 0 0 1 390 10           A 5 5 0 0 0 400 10           A
      5 5 0 0 1 410 10           A 5 5 0 0 0 420 10           A 5 5 0 0 1 430 10           A
      5 5 0 0 0 440 10           A 5 5 0 0 1 450 10           A 5 5 0 0 0 460 10           A
      5 5 0 0 1 470 10           A 5 5 0 0 0 480 10           A 5 5 0 0 1 490 10           A
      5 5 0 0 0 500 10           A 5 5 0 0 1 510 10           A 5 5 0 0 0 520 10           A
      5 5 0 0 1 530 10           A 5 5 0 0 0 540 10           A 5 5 0 0 1 550 10           A
      5 5 0 0 0 560 10           A 5 5 0 0 1 570 10           A 5 5 0 0 0 580 10           A
      5 5 0 0 1 590 10           A 5 5 0 0 0 600 10           A 5 5 0 0 1 610 10           A
      5 5 0 0 0 620 10           A 5 5 0 0 1 630 10           A 5 5 0 0 0 640 10           A
      5 5 0 0 1 650 10           A 5 5 0 0 0 660 10           A 5 5 0 0 1 670 10           A
      5 5 0 0 0 680 10           A 5 5 0 0 1 690 10           A 5 5 0 0 0 700 10           A
      5 5 0 0 1 710 10           A 5 5 0 0 0 720 10           A 5 5 0 0 1 730 10           A
      5 5 0 0 0 740 10           A 5 5 0 0 1 750 10           A 5 5 0 0 0 760 10           A
      5 5 0 0 1 770 10           A 5 5 0 0 0 780 10           A 5 5 0 0 1 790 10           A
      5 5 0 0 0 800 10           A 5 5 0 0 1 810 10           A 5 5 0 0 0 820 10           A
      5 5 0 0 1 830 10           A 5 5 0 0 0 840 10           A 5 5 0 0 1 850 10           A
      5 5 0 0 0 860 10           A 5 5 0 0 1 870 10           A 5 5 0 0 0 880 10           A
      5 5 0 0 1 890 10           A 5 5 0 0 0 900 10           A 5 5 0 0 1 910 10           A
      5 5 0 0 0 920 10           A 5 5 0 0 1 930 10           A 5 5 0 0 0 940 10           A
      5 5 0 0 1 950 10           A 5 5 0 0 0 960 10           A 5 5 0 0 1 970 10           A
      5 5 0 0 0 980 10           A 5 5 0 0 1 990 10           A 5 5 0 0 0 1000 10
      \          A 5 5 0 0 1 1010 10           A 5 5 0 0 0 1020 10           A 5 5
      0 0 1 1030 10           A 5 5 0 0 0 1040 10           A 5 5 0 0 1 1050 10           A
      5 5 0 0 0 1060 10           A 5 5 0 0 1 1070 10           A 5 5 0 0 0 1080 10
      \          A 5 5 0 0 1 1090 10           A 5 5 0 0 0 1100 10           A 5 5
      0 0 1 1110 10           A 5 5 0 0 0 1120 10           A 5 5 0 0 1 1130 10           A
      5 5 0 0 0 1140 10           A 5 5 0 0 1 1150 10           A 5 5 0 0 0 1160 10
      \          A 5 5 0 0 1 1170 10           A 5 5 0 0 0 1180 10           A 5 5
      0 0 1 1190 10           A 5 5 0 0 0 1200 10           A 5 5 0 0 1 1210 10           A
      5 5 0 0 0 1220 10           A 5 5 0 0 1 1230 10           A 5 5 0 0 0 1240 10
      \          A 5 5 0 0 1 1250 10           A 5 5 0 0 0 1260 10           A 5 5
      0 0 1 1270 10           A 5 5 0 0 0 1280 10           A 5 5 0 0 1 1290 10           A
      5 5 0 0 0 1300 10           A 5 5 0 0 1 1310 10           A 5 5 0 0 0 1320 10
      \          A 5 5 0 0 1 1330 10           A 5 5 0 0 0 1340 10           A 5 5
      0 0 1 1350 10           A 5 5 0 0 0 1360 10           A 5 5 0 0 1 1370 10           A
      5 5 0 0 0 1380 10           A 5 5 0 0 1 1390 10           A 5 5 0 0 0 1400 10
      \          A 5 5 0 0 1 1410 10           A 5 5 0 0 0 1420 10           A 5 5
      0 0 1 1430 10           A 5 5 0 0 0 1440 10           A 5 5 0 0 1 1450 10           A
      5 5 0 0 0 1460 10           A 5 5 0 0 1 1470 10           A 5 5 0 0 0 1480 10
      \          A 5 5 0 0 1 1490 10           A 5 5 0 0 0 1500 10           A 5 5
      0 0 1 1510 10           A 5 5 0 0 0 1520 10           A 5 5 0 0 1 1530 10           A
      5 5 0 0 0 1540 10           A 5 5 0 0 1 1550 10           A 5 5 0 0 0 1560 10
      \          A 5 5 0 0 1 1570 10           A 5 5 0 0 0 1580 10           A 5 5
      0 0 1 1590 10           A 5 5 0 0 0 1600 10           A 5 5 0 0 1 1610 10           A
      5 5 0 0 0 1620 10           A 5 5 0 0 1 1630 10           A 5 5 0 0 0 1640 10
      \          A 5 5 0 0 1 1650 10           A 5 5 0 0 0 1660 10           A 5 5
      0 0 1 1670 10           A 5 5 0 0 0 1680 10           A 5 5 0 0 1 1690 10           A
      5 5 0 0 0 1700 10           A 5 5 0 0 1 1710 10           A 5 5 0 0 0 1720 10
      \          A 5 5 0 0 1 1730 10           A 5 5 0 0 0 1740 10           A 5 5
      0 0 1 1750 10           A 5 5 0 0 0 1760 10           A 5 5 0 0 1 1770 10           A
      5 5 0 0 0 1780 10           A 5 5 0 0 1 1790 10           A 5 5 0 0 0 1800 10
      \          A 5 5 0 0 1 1810 10           A 5 5 0 0 0 1820 10           A 5 5
      0 0 1 1830 10           A 5 5 0 0 0 1840 10           A 5 5 0 0 1 1850 10           A
      5 5 0 0 0 1860 10           A 5 5 0 0 1 1870 10           A 5 5 0 0 0 1880 10
      \          A 5 5 0 0 1 1890 10           A 5 5 0 0 0 1900 10           A 5 5
      0 0 1 1910 10           A 5 5 0 0 0 1920 10           A 5 5 0 0 1 1930 10           A
      5 5 0 0 0 1940 10           A 5 5 0 0 1 1950 10           A 5 5 0 0 0 1960 10
      \          A 5 5 0 0 1 1970 10           A 5 5 0 0 0 1980 10           A 5 5
      0 0 1 1990 10           A 5 5 0 0 0 2000 10           A 5 5 0 0 1 2010 10           A
      5 5 0 0 0 2020 10           A 5 5 0 0 1 2030 10           A 5 5 0 0 0 2040 10
      \          A 5 5 0 0 1 2050 10           A 5 5 0 0 0 2060 10           A 5 5
      0 0 1 2070 10           A 5 5 0 0 0 2080 10           A 5 5 0 0 1 2090 10           \"
      stroke=\"black\" stroke-width=\"3\" fill=\"none\"></path>\n      </svg>\n    </mask>\n\n
      \   <mask id=\"candles\">\n      <rect x=\"0\" y=\"0\" width=\"29\" height=\"100\"
      fill=\"white\">\n        <animate attributename=\"width\" values=\"31; 41; 51;
      61; 71; 81; 91; 101; 111; 121; 131; 141; 151; 161; 171; 181; 191; 201; 211;
      221; 231; 241; 251; 261; 271; 281; 291; 301; 311; 321; 331; 341; 351; 361; 371;
      381; 391; 401; 411; 421; 431; 441; 451; 461; 471; 481; 491; 501; 511; 521; 531;
      541; 551; 561; 571; 581; 591; 601; 611; 621; 631; 641; 651; 661; 671; 681; 691;
      701; 711; 721; 731; 741; 751; 761; 771; 781; 791; 801; 811; 821; 831; 841; 851;
      861; 871; 881; 891; 901; 911; 921; 931; 941; 951; 961; 971; 981; 991; 1001;
      1011; 1021; 1031; 1041; 1051; 1061; 1071; 1081; 1091; 1101; 1111; 1121; 1131;
      1141; 1151; 1161; 1171; 1181; 1191; 1201; 1211; 1221; 1231; 1241; 1251; 1261;
      1271; 1281; 1291; 1301; 1311; 1321; 1331; 1341; 1351; 1361; 1371; 1381; 1391;
      1401; 1411; 1421; 1431; 1441; 1451; 1461; 1471; 1481; 1491; 1501; 1511; 1521;
      1531; 1541; 1551; 1561; 1571; 1581; 1591; 1601; 1611; 1621; 1631; 1641; 1651;
      1661; 1671; 1681; 1691; 1701; 1711; 1721; 1731; 1741; 1751; 1761; 1771; 1781;
      1791; 1801; 1811; 1821; 1831; 1841; 1851; 1861; 1871; 1881; 1891; 1901; 1911;
      1921; 1931; 1941; 1951; 1961; 1971; 1981; 1991; 2001\" dur=\"50s\" calcmode=\"discrete\"></animate>\n
      \     </rect>\n    </mask>\n\n    <mask id=\"candleFlame\">\n      <rect x=\"0\"
      y=\"0\" width=\"94\" height=\"100\" fill=\"white\"></rect>\n      <path d=\"M
      27 5 L 28 8 C 29 11, 25 11, 26 8 Z\" mask=\"url(#candleFlame)\" fill=\"black\"></path>\n
      \   </mask>\n\n    <g id=\"singleCandle\" fill=\"currentColor\" stroke-linejoin=\"round\"
      stroke-width=\"1\" stroke=\"currentColor\">\n      <rect x=\"25\" y=\"13\" width=\"4\"
      height=\"18\"></rect>\n      <path d=\"M 27 2 L 29 8 C 30 11, 24 11, 25 8 Z\"
      mask=\"url(#candleFlame)\"></path>\n    </g>\n  </defs>\n\n  <g class=\"plate\">\n
      \   <rect x=\"0\" y=\"105\" width=\"54\" height=\"5\" fill=\"currentColor\"
      rx=\"1\">\n      <animate attributename=\"width\" values=\"54; 2054\" dur=\"50s\"></animate>\n
      \   </rect>\n  </g>\n\n  <g class=\"bottomLayer\">\n    <rect x=\"5\" y=\"63\"
      width=\"44\" height=\"40\" fill=\"currentColor\" rx=\"4\" mask=\"url(#lowerCurlyLine)\">\n
      \     <animate attributename=\"width\" values=\"44; 2034\" dur=\"50s\"></animate>\n
      \   </rect>\n    <rect x=\"5\" y=\"98\" width=\"44\" height=\"5\" fill=\"currentColor\">\n
      \     <animate attributename=\"width\" values=\"44; 2034\" dur=\"50s\"></animate>\n
      \   </rect>\n  </g>\n\n  <g class=\"topLayer\">\n    <rect x=\"15\" y=\"33\"
      width=\"24\" height=\"28\" fill=\"currentColor\" mask=\"url(#upperCurlyLine)\"
      rx=\"4\">\n      <animate attributename=\"width\" values=\"24; 2014\" dur=\"50s\"></animate>\n
      \   </rect>\n    <rect x=\"15\" y=\"56\" width=\"24\" height=\"5\" fill=\"currentColor\">\n
      \     <animate attributename=\"width\" values=\"24; 2014\" dur=\"50s\"></animate>\n
      \   </rect>\n  </g>\n\n  <g mask=\"url(#candles)\" class=\"candles\">\n    <use
      xlink:href=\"#singleCandle\" x=\"0\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"10\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"20\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"30\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"40\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"50\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"60\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"70\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"80\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"90\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"100\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"110\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"120\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"130\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"140\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"150\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"160\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"170\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"180\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"190\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"200\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"210\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"220\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"230\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"240\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"250\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"260\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"270\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"280\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"290\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"300\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"310\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"320\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"330\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"340\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"350\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"360\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"370\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"380\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"390\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"400\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"410\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"420\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"430\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"440\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"450\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"460\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"470\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"480\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"490\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"500\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"510\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"520\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"530\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"540\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"550\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"560\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"570\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"580\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"590\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"600\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"610\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"620\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"630\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"640\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"650\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"660\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"670\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"680\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"690\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"700\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"710\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"720\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"730\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"740\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"750\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"760\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"770\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"780\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"790\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"800\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"810\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"820\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"830\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"840\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"850\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"860\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"870\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"880\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"890\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"900\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"910\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"920\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"930\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"940\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"950\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"960\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"970\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"980\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"990\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1000\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1010\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1020\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1030\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1040\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1050\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1060\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1070\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1080\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1090\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1100\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1110\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1120\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1130\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1140\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1150\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1160\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1170\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1180\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1190\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1200\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1210\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1220\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1230\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1240\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1250\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1260\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1270\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1280\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1290\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1300\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1310\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1320\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1330\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1340\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1350\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1360\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1370\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1380\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1390\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1400\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1410\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1420\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1430\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1440\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1450\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1460\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1470\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1480\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1490\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1500\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1510\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1520\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1530\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1540\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1550\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1560\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1570\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1580\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1590\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1600\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1610\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1620\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1630\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1640\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1650\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1660\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1670\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1680\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1690\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1700\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1710\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1720\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1730\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1740\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1750\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1760\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1770\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1780\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1790\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1800\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1810\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1820\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1830\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1840\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1850\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1860\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1870\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1880\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1890\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1900\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1910\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1920\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1930\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1940\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1950\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1960\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1970\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1980\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1990\"></use>\n  </g>\n<title id=\"svg_animated-birthday-cake\">An animated
      illustration of a pink birthday cake. The cake has two layers and candles on
      top. As you watch, the cake gets wider and the number of candles increases.</title></svg>\n\n\n
      \ <h3 id=\"age\">\n  </h3>\n\n  <button onclick=\"script:document.querySelector('svg').pauseAnimations();\">\n
      \   That\u2019s my age!\n  </button>\n\n  <button onclick=\"script:restartAnimation();\">\n
      \   That\u2019s wrong, try again!\n  </button>\n\n  <noscript>\n    (Please
      enable JavaScript for this to work properly!)\n  </noscript>\n</div>\n\n<script>\n
      \ function restartAnimation() {\n    const currentSvg = document.querySelector('svg#animated-birthday-cake');\n\n
      \   const newSvg = currentSvg.cloneNode(true);  /* deep = true */\n\n    currentSvg.after(newSvg);\n
      \   currentSvg.remove();\n  }\n\n  function getCurrentAge() {\n    const width
      = getComputedStyle(document.querySelector('svg#animated-birthday-cake'))['width'];\n
      \   const pixels = Number(width.replace(/px/, ''));\n\n    const candleCount
      = Math.floor((pixels - 50) / 2 / 10) - 2;\n\n    if (candleCount <= 1) {\n      document.querySelector(\"#age\").innerHTML
      = \"You were only just born!\";\n    } else {\n      document.querySelector(\"#age\").innerHTML
      = `You are ${candleCount} years old!`;\n    }\n  }\n\n  function toggleAllAnimations()
      {\n    document.querySelectorAll(\"svg\").forEach(svg => svg.pauseAnimations());\n
      \ }\n\n  window.onload = function() {\n    const isReduced =\n      window.matchMedia(`(prefers-reduced-motion:
      reduce)`) === true |\n      window.matchMedia(`(prefers-reduced-motion: reduce)`).matches
      === true;\n\n    if (!!isReduced) {\n      toggleAllAnimations();\n      document.querySelector(\"#reducedMotionWarning\").innerHTML
      = \"(You have the \u201Cprefers reduced motion\u201D setting, so I\u2019ve disabled
      the animations. If you want to see them, you can <a onclick=\\\"script:toggleAllAnimations()\\\"
      style=\\\"cursor: pointer; text-decoration: underline;\\\">toggle them on/off</a>.)\"\n
      \   }\n\n    window.setInterval(getCurrentAge, 10);\n  }\n</script>\n\n<p>Let
      me answer some FAQs, and then I\u2019ll explain how it works:</p>\n\n<p><strong>Why
      can\u2019t we just use <code class=\"language-plaintext highlighter-rouge\">&lt;input
      type=\"number\"&gt;</code>?</strong>\nAs many people are fond of saying, age
      is a state of mind, not a number.</p>\n\n<p><strong>Will this input UI work
      on all devices?</strong>\nThis is definitely on the wide side, but I tried it
      on the 52\u2032 DiamondVision Ultra Mega Display where I do all my web development,
      and it fits just fine on there.\nI\u2019m sure that\u2019s all the testing we
      need, and nobody would ever have a smaller display where this design doesn\u2019t
      work.</p>\n\n<p><strong>Can I license this UI to use in my apps?</strong>\nYou
      certainly can!\nJust send your mail-order form to me at the Institute of Good
      Ideas, Potassium Plaza, Rainy England.</p>\n\n<p><strong>What\u2019s on your
      roadmap for V2?</strong>\nAdding a tinny MP3 of \u201CHappy birthday\u201D that
      autoplays at maximum volume whenever this UI is on screen.</p>\n\n<p>I think
      we can all agree that this is a brilliant idea, and I\u2019m sure all the major
      browsers will implement it within weeks.\nI look forward to getting my cheques
      in the post.</p>\n\n<hr>\n\n<h2 id=\"how-it-works\">How it works</h2>\n\n<p>The
      cake is drawn entirely using SVG animations, which I haven\u2019t used before.\nI\u2019m
      quite pleased with how well it works, and how close I was able to get to my
      original idea.\nI know there are quite a few ways to do animation on the web;
      I wanted to experiment with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/animate\">SVG
      <code class=\"language-plaintext highlighter-rouge\">&lt;animate&gt;</code>
      tag</a>.</p>\n\n<p>The basic idea of the <code class=\"language-plaintext highlighter-rouge\">&lt;animate&gt;</code>
      tag is that you can tell it different values that an attribute of an element
      can take over time.\nFor example, here I\u2019m animating a rectangle by increasing
      the <code class=\"language-plaintext highlighter-rouge\">width</code> it from
      0 to 100, and then decreasing it back to 0 again:</p>\n\n<div class=\"language-xml
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"nt\">&lt;rect</span> <span class=\"na\">width=</span><span class=\"s\">\"10\"</span>
      <span class=\"na\">height=</span><span class=\"s\">\"10\"</span> <span class=\"na\">fill=</span><span
      class=\"s\">\"black\"</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;animate</span>\n
      \   <span class=\"na\">attributeName=</span><span class=\"s\">\"width\"</span>\n
      \   <span class=\"na\">values=</span><span class=\"s\">\"0;100;0\"</span>\n
      \   <span class=\"na\">dur=</span><span class=\"s\">\"20s\"</span>\n    <span
      class=\"na\">repeatCount=</span><span class=\"s\">\"5\"</span>\n  <span class=\"nt\">/&gt;</span>\n<span
      class=\"nt\">&lt;/rect&gt;</span>\n</code></pre></div></div>\n\n<p>which looks
      like:</p>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 100 10\"
      width=\"100%\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n  <rect width=\"100\"
      height=\"100\" fill=\"black\">\n    <animate attributename=\"width\" values=\"0;100;0\"
      dur=\"20s\" repeatcount=\"indefinite\"></animate>\n  </rect>\n</svg>\n\n<p>It\u2019s
      pretty flexible \u2013 you can animate multiple properties on the same element;
      you can change non-numeric attributes like <code class=\"language-plaintext
      highlighter-rouge\">fill</code> or <code class=\"language-plaintext highlighter-rouge\">stroke</code>;
      you have a lot of control over how the animation behaves.\nI did some brief
      experiments with simple shapes, enough to get a sense of how I could use it.</p>\n\n<p>Now
      I knew how to animate attributes on SVG, I made a small icon of a static birthday
      cake.\nThere are plenty of existing icons like this on the web, but I made my
      own so I could keep the shapes simple \u2013 most icon sets are just a giant
      <code class=\"language-plaintext highlighter-rouge\">&lt;path&gt;</code> exported
      from a drawing app, which I\u2019d have to unpick.\nAnimating that would be
      harder than just creating my own icon.</p>\n\n<p>I started with a little pencil-drawn
      sketch to work out the rough geometry, then I wrote the SVG by hand.\nI still
      find it vaguely relaxing to create pictures from code.\nThis is what I came
      up with:</p>\n\n\n\n<figure id=\"two_columns\">\n  <picture>\n  \n  <source
      srcset=\"/images/2024/hand-drawn-cake_1x.avif 750w, /images/2024/hand-drawn-cake_2x.avif
      1500w, /images/2024/hand-drawn-cake_3x.avif 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2024/hand-drawn-cake_1x.webp
      750w, /images/2024/hand-drawn-cake_2x.webp 1500w, /images/2024/hand-drawn-cake_3x.webp
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2024/hand-drawn-cake_1x.jpg 750w, /images/2024/hand-drawn-cake_2x.jpg
      1500w, /images/2024/hand-drawn-cake_3x.jpg 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2024/hand-drawn-cake_1x.jpg\"
      alt=\"A sketch of some rectangles that loosely resemble a birthday cake, handwritten
      in a notebook with a few arrows to show various measurements.\" width=\"750\">\n</picture>\n
      \ \n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"
      viewbox=\"0 0 94 110\" height=\"220\" role=\"img\" aria-labelledby=\"svg_birthday-cake\">\n
      \ <defs>\n    <mask id=\"upperCurlyLine\">\n      <rect x=\"0\" y=\"0\" width=\"94\"
      height=\"100\" fill=\"white\"></rect>\n\n      <svg x=\"2\" y=\"37.5\">\n        <path
      d=\"           M 5 10           A 5 5 0 0 1 15 10           A 5 5 0 0 0 25 10
      \          A 5 5 0 0 1 35 10           A 5 5 0 0 0 45 10           A 5 5 0 0
      1 55 10           A 5 5 0 0 0 65 10           A 5 5 0 0 1 75 10           A
      5 5 0 0 0 85 10           \" stroke=\"black\" stroke-width=\"2\" fill=\"none\"></path>\n
      \     </svg>\n    </mask>\n\n    <mask id=\"lowerCurlyLine\">\n      <rect x=\"0\"
      y=\"0\" width=\"94\" height=\"100\" fill=\"white\"></rect>\n\n      <svg x=\"-3\"
      y=\"73\">\n        <path d=\"           M 0 10           A 5 5 0 0 1 10 10           A
      5 5 0 0 0 20 10           A 5 5 0 0 1 30 10           A 5 5 0 0 0 40 10           A
      5 5 0 0 1 50 10           A 5 5 0 0 0 60 10           A 5 5 0 0 1 70 10           A
      5 5 0 0 0 80 10           A 5 5 0 0 1 90 10           A 5 5 0 0 0 100 10           \"
      stroke=\"black\" stroke-width=\"3\" fill=\"none\"></path>\n      </svg>\n    </mask>\n\n
      \   <mask id=\"candleFlame\">\n      <rect x=\"0\" y=\"0\" width=\"94\" height=\"100\"
      fill=\"white\"></rect>\n      <path d=\"M 27 5 L 28 8 C 29 11, 25 11, 26 8 Z\"
      mask=\"url(#candleFlame)\" fill=\"black\"></path>\n    </mask>\n\n    <g id=\"singleCandle\"
      fill=\"black\" stroke-linejoin=\"round\" stroke-width=\"1\" stroke=\"black\">\n
      \     <rect x=\"25\" y=\"13\" width=\"4\" height=\"18\"></rect>\n      <path
      d=\"M 27 2 L 29 8 C 30 11, 24 11, 25 8 Z\" mask=\"url(#candleFlame)\"></path>\n
      \   </g>\n  </defs>\n\n  <g class=\"plate\">\n    <rect x=\"0\" y=\"105\" width=\"94\"
      height=\"5\" fill=\"black\" rx=\"1\"></rect>\n  </g>\n\n  <g class=\"bottomLayer\">\n
      \   <rect x=\"5\" y=\"63\" width=\"84\" height=\"40\" fill=\"black\" rx=\"4\"
      mask=\"url(#lowerCurlyLine)\"></rect>\n    <rect x=\"5\" y=\"98\" width=\"84\"
      height=\"5\" fill=\"black\"></rect>\n  </g>\n\n  <g class=\"topLayer\">\n    <rect
      x=\"15\" y=\"33\" width=\"64\" height=\"28\" fill=\"black\" mask=\"url(#upperCurlyLine)\"
      rx=\"4\"></rect>\n    <rect x=\"15\" y=\"56\" width=\"64\" height=\"5\" fill=\"black\"></rect>\n
      \ </g>\n\n  <g class=\"candles\">\n    <use xlink:href=\"#singleCandle\" x=\"0\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"10\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"20\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"30\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"40\"></use>\n  </g>\n<title id=\"svg_birthday-cake\">A
      black-and-white icon of a birthday cake. The cake has two layers and five candles
      on top.</title></svg>\n\n</figure>\n\n<p>Most of this is fairly vanilla SVG,
      using stuff I\u2019ve written about before.\nThe candle flames and the curving
      line are both using <a href=\"/2021/inner-outer-strokes-svg/\">SVG masks</a>,
      and the curves are drawn as a collection of <a href=\"/2022/circle-party/\">circular
      arcs</a>.</p>\n\n<p>The one interesting bit is the rounded corners on the two
      layers of cake, where only the top two corners are rounded.\nYou can set the
      corner radius of an SVG <code class=\"language-plaintext highlighter-rouge\">&lt;rect&gt;</code>
      with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/rx\"><code
      class=\"language-plaintext highlighter-rouge\">rx</code> attribute</a>, and
      you get the same curve on all four corners \u2013 unlike the CSS <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/border-radius\"><code
      class=\"language-plaintext highlighter-rouge\">border-radius</code> property</a>,
      which allows you to pick different radii for each corner.</p>\n\n<p>To get curves
      on just two corners, I overlapped two rectangles \u2013 one with and without
      rounded corners.</p>\n\n<figure>\n  \n<svg xmlns=\"http://www.w3.org/2000/svg\"
      xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewbox=\"0 0 900 240\" role=\"img\"
      aria-labelledby=\"svg_round-rect\">\n  <defs>\n    <style>\n      .border3 {\n
      \       fill: none;\n        stroke-width: 6;\n      }\n\n      svg text {\n
      \       fill: currentColor;\n        stroke: none;\n        dominant-baseline:
      middle;\n        text-anchor: middle;\n      }\n    </style>\n  </defs>\n\n
      \ <svg x=\"0\">\n    <rect x=\"40\" y=\"50\" width=\"220\" height=\"150\"></rect>\n
      \   <text x=\"150\" y=\"230\">square corners</text>\n  </svg>\n\n  <text class=\"operator\"
      x=\"300\" y=\"230\">+</text>\n\n  <svg x=\"300\">\n    <rect x=\"40\" y=\"0\"
      width=\"220\" height=\"100\" rx=\"50\"></rect>\n    <text x=\"150\" y=\"230\">rounded
      corners</text>\n  </svg>\n\n  <text class=\"operator\" x=\"600\" y=\"230\">\u2192</text>\n\n
      \ <svg x=\"600\">\n    <rect x=\"40\" y=\"50\" width=\"220\" height=\"150\"></rect>\n
      \   <rect x=\"40\" y=\"0\" width=\"220\" height=\"100\" rx=\"50\"></rect>\n
      \   <text x=\"150\" y=\"230\">half-rounded corners</text>\n  </svg>\n<title
      id=\"svg_round-rect\">You can combine a rectangle with square corners and a
      pill shape to get a rectangle with two rounded corners on top.</title></svg>\n\n</figure>\n\n<p>Because
      I\u2019m only doing a solid fill, I\u2019m rendering the two rectangles directly
      in the image \u2013 but if I wanted a more complex fill, I could use this to
      create as a mask that I applied to another shape.</p>\n\n<p>Once I had my basic
      icon, I created an extended version that has several hundred candles on it.\nThis
      is what the cake looks like when it\u2019s fully complete:</p>\n\n<figure class=\"wide_img\">\n
      \ \n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"
      viewbox=\"0 0 2054 110\" role=\"img\" aria-labelledby=\"svg_big-birthday-cake\">\n
      \ <defs>\n    <mask id=\"upperCurlyLine\">\n      <rect x=\"0\" y=\"0\" width=\"2054\"
      height=\"100\" fill=\"white\"></rect>\n\n      <svg x=\"2\" y=\"37.5\">\n        <path
      d=\"           M 5 10           A 5 5 0 0 1 15 10           A 5 5 0 0 0 25 10
      \          A 5 5 0 0 1 35 10           A 5 5 0 0 0 45 10           A 5 5 0 0
      1 55 10           A 5 5 0 0 0 65 10           A 5 5 0 0 1 75 10           A
      5 5 0 0 0 85 10           A 5 5 0 0 1 95 10           A 5 5 0 0 0 105 10           A
      5 5 0 0 1 115 10           A 5 5 0 0 0 125 10           A 5 5 0 0 1 135 10           A
      5 5 0 0 0 145 10           A 5 5 0 0 1 155 10           A 5 5 0 0 0 165 10           A
      5 5 0 0 1 175 10           A 5 5 0 0 0 185 10           A 5 5 0 0 1 195 10           A
      5 5 0 0 0 205 10           A 5 5 0 0 1 215 10           A 5 5 0 0 0 225 10           A
      5 5 0 0 1 235 10           A 5 5 0 0 0 245 10           A 5 5 0 0 1 255 10           A
      5 5 0 0 0 265 10           A 5 5 0 0 1 275 10           A 5 5 0 0 0 285 10           A
      5 5 0 0 1 295 10           A 5 5 0 0 0 305 10           A 5 5 0 0 1 315 10           A
      5 5 0 0 0 325 10           A 5 5 0 0 1 335 10           A 5 5 0 0 0 345 10           A
      5 5 0 0 1 355 10           A 5 5 0 0 0 365 10           A 5 5 0 0 1 375 10           A
      5 5 0 0 0 385 10           A 5 5 0 0 1 395 10           A 5 5 0 0 0 405 10           A
      5 5 0 0 1 415 10           A 5 5 0 0 0 425 10           A 5 5 0 0 1 435 10           A
      5 5 0 0 0 445 10           A 5 5 0 0 1 455 10           A 5 5 0 0 0 465 10           A
      5 5 0 0 1 475 10           A 5 5 0 0 0 485 10           A 5 5 0 0 1 495 10           A
      5 5 0 0 0 505 10           A 5 5 0 0 1 515 10           A 5 5 0 0 0 525 10           A
      5 5 0 0 1 535 10           A 5 5 0 0 0 545 10           A 5 5 0 0 1 555 10           A
      5 5 0 0 0 565 10           A 5 5 0 0 1 575 10           A 5 5 0 0 0 585 10           A
      5 5 0 0 1 595 10           A 5 5 0 0 0 605 10           A 5 5 0 0 1 615 10           A
      5 5 0 0 0 625 10           A 5 5 0 0 1 635 10           A 5 5 0 0 0 645 10           A
      5 5 0 0 1 655 10           A 5 5 0 0 0 665 10           A 5 5 0 0 1 675 10           A
      5 5 0 0 0 685 10           A 5 5 0 0 1 695 10           A 5 5 0 0 0 705 10           A
      5 5 0 0 1 715 10           A 5 5 0 0 0 725 10           A 5 5 0 0 1 735 10           A
      5 5 0 0 0 745 10           A 5 5 0 0 1 755 10           A 5 5 0 0 0 765 10           A
      5 5 0 0 1 775 10           A 5 5 0 0 0 785 10           A 5 5 0 0 1 795 10           A
      5 5 0 0 0 805 10           A 5 5 0 0 1 815 10           A 5 5 0 0 0 825 10           A
      5 5 0 0 1 835 10           A 5 5 0 0 0 845 10           A 5 5 0 0 1 855 10           A
      5 5 0 0 0 865 10           A 5 5 0 0 1 875 10           A 5 5 0 0 0 885 10           A
      5 5 0 0 1 895 10           A 5 5 0 0 0 905 10           A 5 5 0 0 1 915 10           A
      5 5 0 0 0 925 10           A 5 5 0 0 1 935 10           A 5 5 0 0 0 945 10           A
      5 5 0 0 1 955 10           A 5 5 0 0 0 965 10           A 5 5 0 0 1 975 10           A
      5 5 0 0 0 985 10           A 5 5 0 0 1 995 10           A 5 5 0 0 0 1005 10
      \          A 5 5 0 0 1 1015 10           A 5 5 0 0 0 1025 10           A 5 5
      0 0 1 1035 10           A 5 5 0 0 0 1045 10           A 5 5 0 0 1 1055 10           A
      5 5 0 0 0 1065 10           A 5 5 0 0 1 1075 10           A 5 5 0 0 0 1085 10
      \          A 5 5 0 0 1 1095 10           A 5 5 0 0 0 1105 10           A 5 5
      0 0 1 1115 10           A 5 5 0 0 0 1125 10           A 5 5 0 0 1 1135 10           A
      5 5 0 0 0 1145 10           A 5 5 0 0 1 1155 10           A 5 5 0 0 0 1165 10
      \          A 5 5 0 0 1 1175 10           A 5 5 0 0 0 1185 10           A 5 5
      0 0 1 1195 10           A 5 5 0 0 0 1205 10           A 5 5 0 0 1 1215 10           A
      5 5 0 0 0 1225 10           A 5 5 0 0 1 1235 10           A 5 5 0 0 0 1245 10
      \          A 5 5 0 0 1 1255 10           A 5 5 0 0 0 1265 10           A 5 5
      0 0 1 1275 10           A 5 5 0 0 0 1285 10           A 5 5 0 0 1 1295 10           A
      5 5 0 0 0 1305 10           A 5 5 0 0 1 1315 10           A 5 5 0 0 0 1325 10
      \          A 5 5 0 0 1 1335 10           A 5 5 0 0 0 1345 10           A 5 5
      0 0 1 1355 10           A 5 5 0 0 0 1365 10           A 5 5 0 0 1 1375 10           A
      5 5 0 0 0 1385 10           A 5 5 0 0 1 1395 10           A 5 5 0 0 0 1405 10
      \          A 5 5 0 0 1 1415 10           A 5 5 0 0 0 1425 10           A 5 5
      0 0 1 1435 10           A 5 5 0 0 0 1445 10           A 5 5 0 0 1 1455 10           A
      5 5 0 0 0 1465 10           A 5 5 0 0 1 1475 10           A 5 5 0 0 0 1485 10
      \          A 5 5 0 0 1 1495 10           A 5 5 0 0 0 1505 10           A 5 5
      0 0 1 1515 10           A 5 5 0 0 0 1525 10           A 5 5 0 0 1 1535 10           A
      5 5 0 0 0 1545 10           A 5 5 0 0 1 1555 10           A 5 5 0 0 0 1565 10
      \          A 5 5 0 0 1 1575 10           A 5 5 0 0 0 1585 10           A 5 5
      0 0 1 1595 10           A 5 5 0 0 0 1605 10           A 5 5 0 0 1 1615 10           A
      5 5 0 0 0 1625 10           A 5 5 0 0 1 1635 10           A 5 5 0 0 0 1645 10
      \          A 5 5 0 0 1 1655 10           A 5 5 0 0 0 1665 10           A 5 5
      0 0 1 1675 10           A 5 5 0 0 0 1685 10           A 5 5 0 0 1 1695 10           A
      5 5 0 0 0 1705 10           A 5 5 0 0 1 1715 10           A 5 5 0 0 0 1725 10
      \          A 5 5 0 0 1 1735 10           A 5 5 0 0 0 1745 10           A 5 5
      0 0 1 1755 10           A 5 5 0 0 0 1765 10           A 5 5 0 0 1 1775 10           A
      5 5 0 0 0 1785 10           A 5 5 0 0 1 1795 10           A 5 5 0 0 0 1805 10
      \          A 5 5 0 0 1 1815 10           A 5 5 0 0 0 1825 10           A 5 5
      0 0 1 1835 10           A 5 5 0 0 0 1845 10           A 5 5 0 0 1 1855 10           A
      5 5 0 0 0 1865 10           A 5 5 0 0 1 1875 10           A 5 5 0 0 0 1885 10
      \          A 5 5 0 0 1 1895 10           A 5 5 0 0 0 1905 10           A 5 5
      0 0 1 1915 10           A 5 5 0 0 0 1925 10           A 5 5 0 0 1 1935 10           A
      5 5 0 0 0 1945 10           A 5 5 0 0 1 1955 10           A 5 5 0 0 0 1965 10
      \          A 5 5 0 0 1 1975 10           A 5 5 0 0 0 1985 10           A 5 5
      0 0 1 1995 10           A 5 5 0 0 0 2005 10           A 5 5 0 0 1 2015 10           A
      5 5 0 0 0 2025 10           A 5 5 0 0 1 2035 10           A 5 5 0 0 0 2045 10
      \          A 5 5 0 0 1 2055 10           A 5 5 0 0 0 2065 10           A 5 5
      0 0 1 2075 10           A 5 5 0 0 0 2085 10           A 5 5 0 0 1 2095 10           \"
      stroke=\"black\" stroke-width=\"2\" fill=\"none\"></path>\n      </svg>\n    </mask>\n\n
      \   <mask id=\"lowerCurlyLine\">\n      <rect x=\"0\" y=\"0\" width=\"2054\"
      height=\"100\" fill=\"white\"></rect>\n\n      <svg x=\"-3\" y=\"73\">\n        <path
      d=\"           M 0 10           A 5 5 0 0 1 10 10           A 5 5 0 0 0 20 10
      \          A 5 5 0 0 1 30 10           A 5 5 0 0 0 40 10           A 5 5 0 0
      1 50 10           A 5 5 0 0 0 60 10           A 5 5 0 0 1 70 10           A
      5 5 0 0 0 80 10           A 5 5 0 0 1 90 10           A 5 5 0 0 0 100 10           A
      5 5 0 0 1 110 10           A 5 5 0 0 0 120 10           A 5 5 0 0 1 130 10           A
      5 5 0 0 0 140 10           A 5 5 0 0 1 150 10           A 5 5 0 0 0 160 10           A
      5 5 0 0 1 170 10           A 5 5 0 0 0 180 10           A 5 5 0 0 1 190 10           A
      5 5 0 0 0 200 10           A 5 5 0 0 1 210 10           A 5 5 0 0 0 220 10           A
      5 5 0 0 1 230 10           A 5 5 0 0 0 240 10           A 5 5 0 0 1 250 10           A
      5 5 0 0 0 260 10           A 5 5 0 0 1 270 10           A 5 5 0 0 0 280 10           A
      5 5 0 0 1 290 10           A 5 5 0 0 0 300 10           A 5 5 0 0 1 310 10           A
      5 5 0 0 0 320 10           A 5 5 0 0 1 330 10           A 5 5 0 0 0 340 10           A
      5 5 0 0 1 350 10           A 5 5 0 0 0 360 10           A 5 5 0 0 1 370 10           A
      5 5 0 0 0 380 10           A 5 5 0 0 1 390 10           A 5 5 0 0 0 400 10           A
      5 5 0 0 1 410 10           A 5 5 0 0 0 420 10           A 5 5 0 0 1 430 10           A
      5 5 0 0 0 440 10           A 5 5 0 0 1 450 10           A 5 5 0 0 0 460 10           A
      5 5 0 0 1 470 10           A 5 5 0 0 0 480 10           A 5 5 0 0 1 490 10           A
      5 5 0 0 0 500 10           A 5 5 0 0 1 510 10           A 5 5 0 0 0 520 10           A
      5 5 0 0 1 530 10           A 5 5 0 0 0 540 10           A 5 5 0 0 1 550 10           A
      5 5 0 0 0 560 10           A 5 5 0 0 1 570 10           A 5 5 0 0 0 580 10           A
      5 5 0 0 1 590 10           A 5 5 0 0 0 600 10           A 5 5 0 0 1 610 10           A
      5 5 0 0 0 620 10           A 5 5 0 0 1 630 10           A 5 5 0 0 0 640 10           A
      5 5 0 0 1 650 10           A 5 5 0 0 0 660 10           A 5 5 0 0 1 670 10           A
      5 5 0 0 0 680 10           A 5 5 0 0 1 690 10           A 5 5 0 0 0 700 10           A
      5 5 0 0 1 710 10           A 5 5 0 0 0 720 10           A 5 5 0 0 1 730 10           A
      5 5 0 0 0 740 10           A 5 5 0 0 1 750 10           A 5 5 0 0 0 760 10           A
      5 5 0 0 1 770 10           A 5 5 0 0 0 780 10           A 5 5 0 0 1 790 10           A
      5 5 0 0 0 800 10           A 5 5 0 0 1 810 10           A 5 5 0 0 0 820 10           A
      5 5 0 0 1 830 10           A 5 5 0 0 0 840 10           A 5 5 0 0 1 850 10           A
      5 5 0 0 0 860 10           A 5 5 0 0 1 870 10           A 5 5 0 0 0 880 10           A
      5 5 0 0 1 890 10           A 5 5 0 0 0 900 10           A 5 5 0 0 1 910 10           A
      5 5 0 0 0 920 10           A 5 5 0 0 1 930 10           A 5 5 0 0 0 940 10           A
      5 5 0 0 1 950 10           A 5 5 0 0 0 960 10           A 5 5 0 0 1 970 10           A
      5 5 0 0 0 980 10           A 5 5 0 0 1 990 10           A 5 5 0 0 0 1000 10
      \          A 5 5 0 0 1 1010 10           A 5 5 0 0 0 1020 10           A 5 5
      0 0 1 1030 10           A 5 5 0 0 0 1040 10           A 5 5 0 0 1 1050 10           A
      5 5 0 0 0 1060 10           A 5 5 0 0 1 1070 10           A 5 5 0 0 0 1080 10
      \          A 5 5 0 0 1 1090 10           A 5 5 0 0 0 1100 10           A 5 5
      0 0 1 1110 10           A 5 5 0 0 0 1120 10           A 5 5 0 0 1 1130 10           A
      5 5 0 0 0 1140 10           A 5 5 0 0 1 1150 10           A 5 5 0 0 0 1160 10
      \          A 5 5 0 0 1 1170 10           A 5 5 0 0 0 1180 10           A 5 5
      0 0 1 1190 10           A 5 5 0 0 0 1200 10           A 5 5 0 0 1 1210 10           A
      5 5 0 0 0 1220 10           A 5 5 0 0 1 1230 10           A 5 5 0 0 0 1240 10
      \          A 5 5 0 0 1 1250 10           A 5 5 0 0 0 1260 10           A 5 5
      0 0 1 1270 10           A 5 5 0 0 0 1280 10           A 5 5 0 0 1 1290 10           A
      5 5 0 0 0 1300 10           A 5 5 0 0 1 1310 10           A 5 5 0 0 0 1320 10
      \          A 5 5 0 0 1 1330 10           A 5 5 0 0 0 1340 10           A 5 5
      0 0 1 1350 10           A 5 5 0 0 0 1360 10           A 5 5 0 0 1 1370 10           A
      5 5 0 0 0 1380 10           A 5 5 0 0 1 1390 10           A 5 5 0 0 0 1400 10
      \          A 5 5 0 0 1 1410 10           A 5 5 0 0 0 1420 10           A 5 5
      0 0 1 1430 10           A 5 5 0 0 0 1440 10           A 5 5 0 0 1 1450 10           A
      5 5 0 0 0 1460 10           A 5 5 0 0 1 1470 10           A 5 5 0 0 0 1480 10
      \          A 5 5 0 0 1 1490 10           A 5 5 0 0 0 1500 10           A 5 5
      0 0 1 1510 10           A 5 5 0 0 0 1520 10           A 5 5 0 0 1 1530 10           A
      5 5 0 0 0 1540 10           A 5 5 0 0 1 1550 10           A 5 5 0 0 0 1560 10
      \          A 5 5 0 0 1 1570 10           A 5 5 0 0 0 1580 10           A 5 5
      0 0 1 1590 10           A 5 5 0 0 0 1600 10           A 5 5 0 0 1 1610 10           A
      5 5 0 0 0 1620 10           A 5 5 0 0 1 1630 10           A 5 5 0 0 0 1640 10
      \          A 5 5 0 0 1 1650 10           A 5 5 0 0 0 1660 10           A 5 5
      0 0 1 1670 10           A 5 5 0 0 0 1680 10           A 5 5 0 0 1 1690 10           A
      5 5 0 0 0 1700 10           A 5 5 0 0 1 1710 10           A 5 5 0 0 0 1720 10
      \          A 5 5 0 0 1 1730 10           A 5 5 0 0 0 1740 10           A 5 5
      0 0 1 1750 10           A 5 5 0 0 0 1760 10           A 5 5 0 0 1 1770 10           A
      5 5 0 0 0 1780 10           A 5 5 0 0 1 1790 10           A 5 5 0 0 0 1800 10
      \          A 5 5 0 0 1 1810 10           A 5 5 0 0 0 1820 10           A 5 5
      0 0 1 1830 10           A 5 5 0 0 0 1840 10           A 5 5 0 0 1 1850 10           A
      5 5 0 0 0 1860 10           A 5 5 0 0 1 1870 10           A 5 5 0 0 0 1880 10
      \          A 5 5 0 0 1 1890 10           A 5 5 0 0 0 1900 10           A 5 5
      0 0 1 1910 10           A 5 5 0 0 0 1920 10           A 5 5 0 0 1 1930 10           A
      5 5 0 0 0 1940 10           A 5 5 0 0 1 1950 10           A 5 5 0 0 0 1960 10
      \          A 5 5 0 0 1 1970 10           A 5 5 0 0 0 1980 10           A 5 5
      0 0 1 1990 10           A 5 5 0 0 0 2000 10           A 5 5 0 0 1 2010 10           A
      5 5 0 0 0 2020 10           A 5 5 0 0 1 2030 10           A 5 5 0 0 0 2040 10
      \          A 5 5 0 0 1 2050 10           A 5 5 0 0 0 2060 10           A 5 5
      0 0 1 2070 10           A 5 5 0 0 0 2080 10           A 5 5 0 0 1 2090 10           \"
      stroke=\"black\" stroke-width=\"3\" fill=\"none\"></path>\n      </svg>\n    </mask>\n\n
      \   <mask id=\"candleFlame\">\n      <rect x=\"0\" y=\"0\" width=\"94\" height=\"100\"
      fill=\"white\"></rect>\n      <path d=\"M 27 5 L 28 8 C 29 11, 25 11, 26 8 Z\"
      mask=\"url(#candleFlame)\" fill=\"black\"></path>\n    </mask>\n\n    <g id=\"singleCandle\"
      fill=\"currentColor\" stroke-linejoin=\"round\" stroke-width=\"1\" stroke=\"currentColor\">\n
      \     <rect x=\"25\" y=\"13\" width=\"4\" height=\"18\"></rect>\n      <path
      d=\"M 27 2 L 29 8 C 30 11, 24 11, 25 8 Z\" mask=\"url(#candleFlame)\"></path>\n
      \   </g>\n  </defs>\n\n  <svg class=\"plate\">\n    <rect x=\"0\" y=\"105\"
      width=\"2054\" height=\"5\" fill=\"currentColor\" rx=\"1\"></rect>\n  </svg>\n\n
      \ <svg class=\"bottomLayer\">\n    <rect x=\"5\" y=\"63\" width=\"2034\" height=\"40\"
      fill=\"currentColor\" rx=\"4\" mask=\"url(#lowerCurlyLine)\"></rect>\n    <rect
      x=\"5\" y=\"98\" width=\"2034\" height=\"5\" fill=\"currentColor\"></rect>\n
      \ </svg>\n\n  <svg class=\"topLayer\">\n    <rect x=\"15\" y=\"33\" width=\"2014\"
      height=\"28\" fill=\"currentColor\" mask=\"url(#upperCurlyLine)\" rx=\"4\"></rect>\n
      \   <rect x=\"15\" y=\"56\" width=\"2014\" height=\"5\" fill=\"currentColor\"></rect>\n
      \ </svg>\n\n  <svg class=\"candles\">\n    <use xlink:href=\"#singleCandle\"
      x=\"0\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"10\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"20\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"30\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"40\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"50\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"60\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"70\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"80\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"90\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"100\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"110\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"120\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"130\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"140\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"150\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"160\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"170\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"180\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"190\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"200\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"210\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"220\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"230\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"240\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"250\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"260\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"270\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"280\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"290\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"300\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"310\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"320\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"330\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"340\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"350\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"360\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"370\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"380\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"390\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"400\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"410\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"420\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"430\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"440\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"450\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"460\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"470\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"480\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"490\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"500\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"510\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"520\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"530\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"540\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"550\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"560\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"570\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"580\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"590\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"600\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"610\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"620\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"630\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"640\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"650\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"660\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"670\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"680\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"690\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"700\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"710\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"720\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"730\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"740\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"750\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"760\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"770\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"780\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"790\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"800\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"810\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"820\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"830\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"840\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"850\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"860\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"870\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"880\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"890\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"900\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"910\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"920\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"930\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"940\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"950\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"960\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"970\"></use>\n    <use
      xlink:href=\"#singleCandle\" x=\"980\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"990\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1000\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1010\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1020\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1030\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1040\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1050\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1060\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1070\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1080\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1090\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1100\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1110\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1120\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1130\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1140\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1150\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1160\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1170\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1180\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1190\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1200\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1210\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1220\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1230\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1240\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1250\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1260\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1270\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1280\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1290\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1300\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1310\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1320\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1330\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1340\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1350\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1360\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1370\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1380\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1390\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1400\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1410\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1420\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1430\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1440\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1450\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1460\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1470\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1480\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1490\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1500\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1510\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1520\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1530\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1540\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1550\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1560\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1570\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1580\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1590\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1600\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1610\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1620\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1630\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1640\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1650\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1660\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1670\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1680\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1690\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1700\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1710\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1720\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1730\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1740\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1750\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1760\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1770\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1780\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1790\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1800\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1810\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1820\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1830\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1840\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1850\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1860\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1870\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1880\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1890\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1900\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1910\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1920\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1930\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1940\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1950\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1960\"></use>\n
      \   <use xlink:href=\"#singleCandle\" x=\"1970\"></use>\n    <use xlink:href=\"#singleCandle\"
      x=\"1980\"></use>\n    <use xlink:href=\"#singleCandle\" x=\"1990\"></use>\n
      \ </svg>\n<title id=\"svg_big-birthday-cake\">A black-and-white illustration
      of an extremely wide birthday cake.</title></svg>\n\n</figure>\n\n<p>This has
      something like 200 candles on it; in hindsight I was way off my estimate of
      how old the oldest humans are.\nAccording to Wikipedia, the <a href=\"https://en.wikipedia.org/wiki/Oldest_people\">oldest
      humans</a> are closer to 120 years old.</p>\n\n<p>I then sprinkled <code class=\"language-plaintext
      highlighter-rouge\">&lt;animate&gt;</code> elements everywhere to make different
      parts of the cake appear at different times.\nFor the plate and the two cake
      layers, I\u2019m animating the <code class=\"language-plaintext highlighter-rouge\">width</code>
      attributes, so they gradually get bigger.</p>\n\n<p>For the candles, I\u2019m
      applying a mask which has an animated <code class=\"language-plaintext highlighter-rouge\">width</code>
      attribute, so it gradually allows more and more of the candles to be seen.\nThat
      animation uses <a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/calcMode\"><code
      class=\"language-plaintext highlighter-rouge\">calcMode=\"discrete\"</code></a>,
      which causes it to do a distinct step at each tick, rather than a smooth animation
      between the two.\nThis means that you only ever see whole candles, rather than
      half-candles in the middle of the animation.</p>\n\n<p>Finally, I added an animation
      to the <code class=\"language-plaintext highlighter-rouge\">viewBox</code> attribute
      of the overall SVG \u2013 this means the width of the SVG increases as more
      candles become visible.\nThis allows me to get the current state of the animation
      in JavaScript:</p>\n\n<div class=\"language-javascript highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nf\">getComputedStyle</span><span
      class=\"p\">(</span><span class=\"nb\">document</span><span class=\"p\">.</span><span
      class=\"nf\">querySelector</span><span class=\"p\">(</span><span class=\"dl\">'</span><span
      class=\"s1\">svg</span><span class=\"dl\">'</span><span class=\"p\">))[</span><span
      class=\"dl\">'</span><span class=\"s1\">width</span><span class=\"dl\">'</span><span
      class=\"p\">]</span>\n<span class=\"c1\">// 158px</span>\n</code></pre></div></div>\n\n<p>I
      know how far apart the candles are spaced, so I can use this to work out how
      many are visible at any given time.\nThere are other ways to inspect the state
      of an in-progress SVG animation; tying it to the geometry was the easiest in
      this case.</p>\n\n<p>If you\u2019d like to learn more, I encourage you to read
      <a href=\"https://github.com/alexwlchan/alexwlchan.net/blob/main/src/_images/2024/animated-birthday-cake.svg\">the
      SVG file</a>.\nIt\u2019s a bit repetitive in parts, but overall I think it\u2019s
      fairly readable.</p>\n\n<hr>\n\n<p>I learn a lot from doing mini-projects like
      this, and more than I would by just reading the documentation.\nI didn\u2019t
      plan to work on this, but this particular idea \u2013 \u201Canimate a birthday
      cake\u201D \u2013 sunk its teeth into my <a href=\"/2023/hyperfocus-and-hobbies/\">hyperfocus</a>
      a few days ago, and I\u2019ve been thinking about it ever since.\nPosting this
      article will let me call the project \u201Cdone\u201D and move on to other things.</p>\n\n<p>Animation
      is one of those topics that\u2019s always been just beyond what I can do \u2013
      I knew that SVG animation is a thing, but I\u2019d never actually tried it.\nNow
      I have!</p>\n\n\n    <p>[If the formatting of this post looks odd in your feed
      reader, <a href=\"https://alexwlchan.net/2024/best-age-picker/\">visit the original
      article</a>]</p>\n    ]]></content>\n    <category term=\"code-crimes\"/>\n
      \   <category term=\"drawing-things\"/>\n    <category term=\"svg\"/>\n    <summary
      type=\"html\">Using SVG animations to create a fun and exciting new input UI.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">What mammal is that?</title>\n
      \   <link href=\"https://alexwlchan.net/2024/dog-or-bat/\" rel=\"alternate\"
      type=\"text/html\" title=\"What mammal is that?\"/>\n    <published>2024-01-02T19:10:50+00:00</published>\n
      \   <updated>2024-01-02T19:10:50+00:00</updated>\n    <id>https://alexwlchan.net/2024/dog-or-bat</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2024/dog-or-bat/\"><![CDATA[\n<p>I
      was visiting my parents over Christmas, and they have a large dog called Ziva.\nI
      like to take silly photos of the family pets, and this is one from last week
      that shows off a super-sized snoot:</p>\n\n<figure>\n  <picture>\n  \n  <source
      srcset=\"/images/2024/ziva_1x.avif 600w, /images/2024/ziva_2x.avif 1200w, /images/2024/ziva_3x.avif
      1800w\" sizes=\"(max-width: 600px) 100vw, 600px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2024/ziva_1x.webp 600w, /images/2024/ziva_2x.webp
      1200w, /images/2024/ziva_3x.webp 1800w\" sizes=\"(max-width: 600px) 100vw, 600px\"
      type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2024/ziva_1x.jpg
      600w, /images/2024/ziva_2x.jpg 1200w, /images/2024/ziva_3x.jpg 1800w\" sizes=\"(max-width:
      600px) 100vw, 600px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2024/ziva_1x.jpg\"
      class=\"photo\" alt=\"A blurry photo of a dog with grey fur. The photo is a
      close-up on her nose, which is filling a large portion of the frame, and the
      rest of the photo is her face, with mostly closed eyes and ears folded back.
      She's resting on the arm of a comfy chair, half-asleep.\" width=\"600\">\n</picture>\n
      \ <figcaption>\n    No Photoshop here, just my iPhone\u2019s Ultra Wide camera
      held close to her nose.\n  </figcaption>\n</figure>\n\n<p>For giggles, I decided
      to use the <a href=\"https://support.apple.com/en-gb/104962\">animal detection
      feature</a> to tell me what sort of dog Ziva is.\nWe\u2019re not actually sure
      of her breed because she\u2019s a rescue dog of unknown parentage, so it\u2019s
      always fun to try the animal detection and see what it suggests.</p>\n\n<p>When
      I tried, I was shown a button I hadn\u2019t seen before: <em>Look up Mammal</em>.</p>\n\n<picture>\n
      \ \n\n<source srcset=\"/images/2024/look-up-mammal.dark_1x.png 375w, /images/2024/look-up-mammal.dark_2x.png
      750w, /images/2024/look-up-mammal.dark_3x.png 1125w\" sizes=\"(max-width: 375px)
      100vw, 375px\" type=\"image/png\" media=\"(prefers-color-scheme: dark)\"></source>\n\n\n
      \ \n  \n  <source srcset=\"/images/2024/look-up-mammal_1x.png 375w, /images/2024/look-up-mammal_2x.png
      750w, /images/2024/look-up-mammal_3x.png 1125w\" sizes=\"(max-width: 375px)
      100vw, 375px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2024/look-up-mammal_1x.png\"
      class=\"screenshot dark_aware\" alt=\"The same photo in the iOS Photos app,
      with an overlay sheet showing a 'Look Up Mammal' button.\" width=\"375\">\n</picture>\n\n<p>And
      with the best will in the world, I couldn\u2019t have guessed what it would
      suggest:</p>\n\n<picture>\n  \n\n<source srcset=\"/images/2024/hammer-headed-bat.dark_1x.png
      375w, /images/2024/hammer-headed-bat.dark_2x.png 750w, /images/2024/hammer-headed-bat.dark_3x.png
      1125w\" sizes=\"(max-width: 375px) 100vw, 375px\" type=\"image/png\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n\n  \n  \n  <source srcset=\"/images/2024/hammer-headed-bat_1x.png
      375w, /images/2024/hammer-headed-bat_2x.png 750w, /images/2024/hammer-headed-bat_3x.png
      1125w\" sizes=\"(max-width: 375px) 100vw, 375px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2024/hammer-headed-bat_1x.png\" class=\"screenshot dark_aware\"
      alt=\"A list of results for 'Look up Mammal', showing two suggestions: a Hammer-headed
      bat, and a Wolf.\" width=\"375\">\n</picture>\n\n<p>After we\u2019d all had
      a good laugh at this suggestion, I opened <a href=\"https://en.wikipedia.org/wiki/Hammer-headed_bat\">the
      Wikipedia page</a> and went down a rabbit hole.\nWhen you see some photos, it
      starts to make more sense \u2013 several of the photos featured really do show
      a sizable snout.\nGiven the distortion in my photo, you can see why the algorithm
      thought there could be a match (and where the \u201Chammer-headed\u201D name
      comes from):</p>\n\n\n\n<figure class=\"photo\">\n  <div id=\"two_up_bats\">\n
      \   <a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0223139#sec002\"><picture>
      \ <source srcset=\"/images/2024/hammer-headed-bat-1_1x.avif 750w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/hammer-headed-bat-1_1x.webp
      750w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/hammer-headed-bat-1_1x.jpg 750w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/hammer-headed-bat-1_1x.jpg\"
      alt=\"A front-facing view of a bat with an elongated nose. The bar is a dark,
      reddish brown, looking directly at the camera, and its wings are folded along
      its sides. Its being held in the hand of somebody with a yellow glove.\" width=\"750\">
      </picture></a>\n\n    <a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0223139#sec002\"><picture>
      \ <source srcset=\"/images/2024/hammer-headed-bat-2_1x.avif 750w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/avif\"></source>  <source srcset=\"/images/2024/hammer-headed-bat-2_1x.webp
      750w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/hammer-headed-bat-2_1x.jpg 750w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/jpeg\"></source>  <img src=\"/images/2024/hammer-headed-bat-2_1x.jpg\"
      alt=\"The same bat, now in profile. Its elongated nose is more visible, which
      is large and rounded.\" width=\"750\"> </picture></a>\n  </div>\n  <figcaption>\n
      \   Photo by Sarah Olson et al, from an <a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0223139#sec002\">article
      in PLOS ONE</a>.\n    Used under CC0.\n  </figcaption>\n</figure>\n\n<p>And
      it turns out it\u2019s a pretty cool creature \u2013 it\u2019s a \u201Cmegabat\u201D
      (great name) and its wingspan can be close to a metre wide.\nI think of bats
      as small and cuddly, but if something flew past that was that size, I\u2019d
      be pretty nervous.\nImagine if something that looked like this flew towards
      you with outstretched wings on a dark night:</p>\n\n<figure>\n  <a href=\"https://www.inaturalist.org/photos/247839218\"><picture>
      \ <source srcset=\"/images/2024/fully-loaded-bat_1x.avif 600w, /images/2024/fully-loaded-bat_2x.avif
      1200w\" sizes=\"(max-width: 600px) 100vw, 600px\" type=\"image/avif\"></source>
      \ <source srcset=\"/images/2024/fully-loaded-bat_1x.webp 600w, /images/2024/fully-loaded-bat_2x.webp
      1200w\" sizes=\"(max-width: 600px) 100vw, 600px\" type=\"image/webp\"></source>
      \ <source srcset=\"/images/2024/fully-loaded-bat_1x.jpg 600w, /images/2024/fully-loaded-bat_2x.jpg
      1200w\" sizes=\"(max-width: 600px) 100vw, 600px\" type=\"image/jpeg\"></source>
      \ <img src=\"/images/2024/fully-loaded-bat_1x.jpg\" class=\"photo\" alt=\"Another
      photo of a bat with partially extended wings, being held in somebody's hands.
      The wings are probably about a foot wide, and not fully extended. Several sharp
      looking claws are visible on the inner side of the wing.\" width=\"600\"> </picture></a>\n
      \ <figcaption>\n    Photo by Bart Wursten, published on <a href=\"https://www.inaturalist.org/photos/247839218\">iNaturalist</a>,
      used under CC\_BY\u2011NC\_4.0.\n  </figcaption>\n</figure>\n\n<p>And for extra
      scary points, it makes a <a href=\"https://www.youtube.com/watch?v=BLm6YVFvNG8\">pretty
      loud honking sound</a>, so loud that it\u2019s often considered a pest.\nThis
      noise is how males attract females, and it\u2019s so important that their internal
      organs are actually shaped around their ability to honk:</p>\n\n<blockquote>\n
      \ <p>The most noticeable anatomical features of the male involve sound production.
      The larynx is one-half the length of the vertebral column and fills most of
      the thoracic cavity, pushing the heart, lungs and alimentary canal backward
      and sideways.</p>\n\n  <p><cite>\u2014 <a href=\"https://academic.oup.com/mspecies/article/doi/10.2307/3504110/2600338\"><em>Hypsignathus
      monstrosus</em></a>, by Paul Langevin and Robert M. R. Barclay, Mammalian Species
      Issue\_357, 26 April 1990.</cite></p>\n</blockquote>\n\n<p>That <a href=\"https://academic.oup.com/mspecies/article/doi/10.2307/3504110/2600338\">same
      paper</a> also features a delightful description of the male nose, which sounds
      like somebody getting revenge for the way male authors describe women in novels:</p>\n\n<blockquote>\n
      \ <p>Males have a large, square, truncated head (Tate, 1942) with enormous pendulous
      lips, ruffles around a warty snout and a hairless, split chin (Lang and Chapin,
      1917).</p>\n</blockquote>\n\n<p>I find myself down this sort of rabbit hole
      surprisingly often, and I\u2019ve begun to think of it as \u201Cserendipitous
      search results\u201D.\nWhatever Ziva is, she\u2019s definitely not an African
      species of large bat, but it appeared in my search results anyway, and that
      was the start of some fun reading.\nAt other times, I\u2019ll look for a specific
      book at my local library, and they don\u2019t have it, but I\u2019ll end up
      reading half a dozen books with similar titles because that\u2019s what the
      search could find.</p>\n\n<p>If you want more pictures of cool bats, there are
      a bunch of them <a href=\"https://www.inaturalist.org/observations/144407784\">on
      iNaturalist</a>.\nIf not, I\u2019ll see you next time I stumble upon something
      fun and unexpected while searching.</p>\n\n\n    <p>[If the formatting of this
      post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2024/dog-or-bat/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"fun-stuff\"/>\n
      \   <summary type=\"html\">In which Apple Photos accidentally tells me about
      a cool new animal.</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">My
      favourite books from 2023</title>\n    <link href=\"https://alexwlchan.net/2023/2023-in-reading/\"
      rel=\"alternate\" type=\"text/html\" title=\"My favourite books from 2023\"/>\n
      \   <published>2023-12-30T17:10:51+00:00</published>\n    <updated>2023-12-30T17:10:51+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/2023-in-reading</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2023/2023-in-reading/\"><![CDATA[\n<p>I read
      75 books this year, which is slightly up on previous years (<a href=\"/2022/2022-in-reading/\">2022</a>,
      <a href=\"/2021/2021-in-reading/\">2021</a>).\nI\u2019m pleased with that number,
      although overall I found it a slightly disappointing year for reading.\nAlthough
      I read more books, there were less that I really loved \u2013 less of the sort
      of book that changes my view on the world, that I\u2019m still thinking about
      weeks later.</p>\n\n<p>I did return to a couple of favourite authors, who all
      released new books that I enjoyed \u2013 Alexandria Bellefleur, Toshikazu Kawaguchi,
      Maureen Johnson \u2013 but that was more familiar feelings than new.\nI got
      more of my novelty from theatre than books this year.</p>\n\n<p>About half of
      what I read came from my local library, including four of the books on the list
      below.\nThe library was particularly helpful for the \u201Cgood, but not great\u201D
      books that I know I won\u2019t read again.\nI was glad to return the books,
      and not have them taking up space in my house.\nI expect to continue leaning
      on my library next year.</p>\n\n<p>I continue to write short reviews of books
      I\u2019ve read at <a href=\"https://books.alexwlchan.net\">https://books.alexwlchan.net</a>,
      and keep notes in Obsidian.\nThe latter have been useful for jogging my memory,
      including as I write this post.</p>\n\n<p>Below are the best books I read in
      2023, in the order I read them.\nNote that it\u2019s quite a heavy selection,
      several dealing with death and oppression and other unpleasant things.\nI do
      recommend them all, but you should have a cheery book to read afterwards.</p>\n\n<hr>\n\n<div
      class=\"book_review\" id=\"the_origins_of_iris\">\n  <picture>\n  \n  <source
      srcset=\"/images/2023/the-origins-of-iris_1x.avif 91w, /images/2023/the-origins-of-iris_2x.avif
      182w, /images/2023/the-origins-of-iris_3x.avif 273w\" sizes=\"(max-width: 91px)
      100vw, 91px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2023/the-origins-of-iris_1x.webp
      91w, /images/2023/the-origins-of-iris_2x.webp 182w, /images/2023/the-origins-of-iris_3x.webp
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/the-origins-of-iris_1x.jpg 91w, /images/2023/the-origins-of-iris_2x.jpg
      182w, /images/2023/the-origins-of-iris_3x.jpg 273w\" sizes=\"(max-width: 91px)
      100vw, 91px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2023/the-origins-of-iris_1x.jpg\"
      alt=\"The cover of \u201CThe Origins of Iris\u201D. A dark blue cover with yellow
      silhouettes of faces in profile, one face on either side of the cover. In the
      left-hand face is the faint outline of a city; in the right-hand face is the
      faint outline of a forest.\" class=\"book_cover\" width=\"91\">\n</picture>\n
      \ <div class=\"book_info\">\n  <h2 class=\"book_title\">The Origins of Iris</h2>\n
      \ <p class=\"book_attribution\">\n    by Beth Lewis\n    \n    (2021)\n  </p>\n
      \ <p class=\"book_meta\">\n    read <a href=\"https://books.alexwlchan.net/2022/the-origins-of-iris/\">27
      December 2022</a>\n  </p>\n</div>\n</div>\n\n<p>This is a fascinating take on
      the \u201Cwhat if\u201D concept.</p>\n\n<p>Iris has run away to the forest to
      escape her abusive wife, and there she meets an alternate version of herself
      who made different choices \u2013 an Iris who married someone different, and
      now carries an unwanted pregnancy.\nThey both have regrets about how their life
      turned out, and envy some aspects of the other\u2019s life \u2013 but they also
      learn that the grass isn\u2019t always greener.</p>\n\n<p>The book switches
      back and forth between \u201CBefore\u201D (the events leading up to her running
      away) and \u201CAfter\u201D (what she does in the woods).\nYou know that something
      bad has happened to Iris, but you only find out the details slowly.\nI enjoy
      this sort of non-linear story.</p>\n\n<p>It gave me a lot of thoughts and feelings,
      and I felt sympathy for Iris.\nBoth Irises have flawed and imperfect lives,
      and there\u2019s no implication that one is obviously better or more correct.\nI
      haven\u2019t read it again, but I want to, because I suspect there\u2019s a
      lot I\u2019d pick up on a second time round.</p>\n\n<p>Content warnings for
      abuse, sexual assault, rape, and suicide.</p>\n\n<p>(Yes, I technically read
      this in 2022, but it missed the cutoff for last year\u2019s post.)</p>\n\n<div
      class=\"book_review\" id=\"seven_fallen_feathers\">\n  <picture>\n  \n  <source
      srcset=\"/images/2023/seven-fallen-feathers_1x.avif 90w, /images/2023/seven-fallen-feathers_2x.avif
      180w, /images/2023/seven-fallen-feathers_3x.avif 270w\" sizes=\"(max-width:
      90px) 100vw, 90px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2023/seven-fallen-feathers_1x.webp
      90w, /images/2023/seven-fallen-feathers_2x.webp 180w, /images/2023/seven-fallen-feathers_3x.webp
      270w\" sizes=\"(max-width: 90px) 100vw, 90px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/seven-fallen-feathers_1x.jpg 90w, /images/2023/seven-fallen-feathers_2x.jpg
      180w, /images/2023/seven-fallen-feathers_3x.jpg 270w\" sizes=\"(max-width: 90px)
      100vw, 90px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2023/seven-fallen-feathers_1x.jpg\"
      alt=\"The cover of \u201CSeven Fallen Feathers\u201D. The cover is split vertically
      by the title. Below the title is an artwork of seven human-like figures in reddish
      brown, looking upwards towards the sky. Above the title is a yellow circle with
      a gravestone, and branching off the circle are seven more graves and seven bird-like
      figures.\" class=\"book_cover\" width=\"90\">\n</picture>\n  <div class=\"book_info\">\n
      \ <h2 class=\"book_title\">Seven Fallen Feathers</h2>\n  <p class=\"book_attribution\">\n
      \   by Tanya Talaga\n    \n    (2017)\n  </p>\n  <p class=\"book_meta\">\n    read
      <a href=\"https://books.alexwlchan.net/2023/seven-fallen-feathers/\">16 March
      2023</a>\n  </p>\n</div>\n</div>\n\n<p>This is an account of abuse, neglect,
      and deaths of Indigenous students in Canada\u2019s school system.\nIt\u2019s
      not an easy book to read, but it\u2019s well-written and worth the time.</p>\n\n<p>It
      focuses on seven deaths in Thunder Bay, and includes the history of the residential
      schools which form the backdrop for those events.\nAs I don\u2019t know much
      about Canadian history or education, I found the context useful.</p>\n\n<p>The
      titular \u201CSeven Fallen Feathers\u201D are seven children who died in unexplained
      circumstances.\nThe book devotes a chapter to each of them, describing their
      history, the days leading up to their death, and the hole it left in the lives
      of their friends and family.\nIt\u2019s difficult to read but important, and
      the author has obviously done a lot of research and interviews.</p>\n\n<p>There
      are certain themes that keep coming up \u2013 racism towards Indigenous people,
      disinterest from the Thunder Bay police, the effect of moving kids to big cities
      \u2013 but the author is subtle about them.\nShe doesn\u2019t need to tell you
      what patterns you should be looking for, because it\u2019s so obvious from the
      stories.\nIt\u2019s the embodiment of \u201Cshow, don\u2019t tell\u201D.</p>\n\n<p>Content
      warnings for death, suicide, racism and colonialism.</p>\n\n<div class=\"book_review\"
      id=\"elatsoe\">\n  <picture>\n  \n  <source srcset=\"/images/2023/elatsoe_1x.avif
      94w, /images/2023/elatsoe_2x.avif 188w, /images/2023/elatsoe_3x.avif 282w\"
      sizes=\"(max-width: 94px) 100vw, 94px\" type=\"image/avif\"></source>\n\n  <source
      srcset=\"/images/2023/elatsoe_1x.webp 94w, /images/2023/elatsoe_2x.webp 188w,
      /images/2023/elatsoe_3x.webp 282w\" sizes=\"(max-width: 94px) 100vw, 94px\"
      type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/elatsoe_1x.jpg
      94w, /images/2023/elatsoe_2x.jpg 188w, /images/2023/elatsoe_3x.jpg 282w\" sizes=\"(max-width:
      94px) 100vw, 94px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2023/elatsoe_1x.jpg\"
      alt=\"The cover of \u201CElatsoe\u201D. A young girl in a brown coat stands
      amidst a group of ghost wolves, in white and light greys, who are running across
      the cover.\" class=\"book_cover\" width=\"94\">\n</picture>\n  <div class=\"book_info\">\n
      \ <h2 class=\"book_title\">Elatsoe</h2>\n  <p class=\"book_attribution\">\n
      \   by Darcie Little Badger\n    \n    (2020)\n  </p>\n  <p class=\"book_meta\">\n
      \   read <a href=\"https://books.alexwlchan.net/2023/elatsoe/\">24 April 2023</a>\n
      \ </p>\n</div>\n</div>\n\n<p>A fun story in an America where fantasy and magic
      are real and commonplace, including vampires, ghosts, and evil scarecrows.</p>\n\n<p>Elatsoe
      (\u201CEllie\u201D) is a member of the Lipan Apache Tribe, and women in her
      family have the ability to speak to ghosts \u2013 usually animal ghosts, because
      human ghosts are more violent and angry.\nShe\u2019s investigating the death
      of her cousin Trevor, which she believes to be a murder.</p>\n\n<p>The plot
      is a little slow, but the worldbuilding is gorgeous \u2013 it feels rich and
      real, without being heavy-handed.\nWe get little glimpses of the magic, but
      it\u2019s never treated as spectacular or obsessed over.\nI didn\u2019t need
      to have every detail to enjoy it.\nI\u2019d happily read more stories in this
      setting, but it also works nicely as a standalone.</p>\n\n<p>This was Darcie
      Little Badger\u2019s debut novel, and I read her second novel, <em>A Snake Falls
      to Earth</em>, in August.\nIt was another good fantasy, and I\u2019ll definitely
      be reading more of her work in future.</p>\n\n<div class=\"book_review\" id=\"phone_box\">\n
      \ <picture>\n  \n  <source srcset=\"/images/2023/the-phone-box-at-the-edge-of-the-world_1x.avif
      91w, /images/2023/the-phone-box-at-the-edge-of-the-world_2x.avif 182w, /images/2023/the-phone-box-at-the-edge-of-the-world_3x.avif
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/the-phone-box-at-the-edge-of-the-world_1x.webp
      91w, /images/2023/the-phone-box-at-the-edge-of-the-world_2x.webp 182w, /images/2023/the-phone-box-at-the-edge-of-the-world_3x.webp
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/the-phone-box-at-the-edge-of-the-world_1x.jpg
      91w, /images/2023/the-phone-box-at-the-edge-of-the-world_2x.jpg 182w, /images/2023/the-phone-box-at-the-edge-of-the-world_3x.jpg
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/the-phone-box-at-the-edge-of-the-world_1x.jpg\" alt=\"The
      cover of \u201CThe Phone Box at the Edge of the World\u201D. Most of the cover
      is a few strokes of turquoise watercolour paint, and the phone box is shown
      as a simple black-and-white drawing. It\u2019s tall, square, and there are window
      panels along the front of the door.\" class=\"book_cover\" width=\"91\">\n</picture>\n
      \ <div class=\"book_info\">\n  <h2 class=\"book_title\">The Phone Box at the
      Edge of the World</h2>\n  <p class=\"book_attribution\">\n    by Laura Imai
      Messina\n    \n    (2020)\n  </p>\n  <p class=\"book_meta\">\n    read <a href=\"https://books.alexwlchan.net/2023/the-phone-box-at-the-edge-of-the-world/\">14
      September 2023</a>\n  </p>\n</div>\n</div>\n\n<p>This is a gorgeous story about
      grief and heartbreak, and two people learning to find love again after great
      tragedy.</p>\n\n<p>The phone box itself is mundane, with no special magic or
      power.\nWhen I first saw the title, I wondered if this was a fantasy or sci-fi
      book \u2013 I was getting TARDIS vibes \u2013 but it\u2019s not, and that\u2019s
      a good thing.\nIt\u2019s just an ordinary phone box in a garden in Bell Gardia,
      a few hours from Tokyo.</p>\n\n<p>People go to the phone box to have conversations
      with their loved ones \u2013 often they\u2019re talking to people who have died,
      but not always.\nSome talk to estranged family, others talk to friends who are
      alive but mentally incapacitated or traumatised.\nThese conversations are largely
      private, and we don\u2019t get to hear many of them.</p>\n\n<p>Instead, the
      book focuses on a handful of characters \u2013 Sui, Takeshi, and Hana \u2013
      and how they interact with the phone box, and its other visitors.\nThey\u2019ve
      all suffered losses, and their visits to the phone box are what help them to
      start reconnecting with people.</p>\n\n<p>It reminded me a lot of Toshikazu
      Kawaguchi\u2019s books, which I adore \u2013 grief and sadness but with an ultimately
      positive message.</p>\n\n<div class=\"book_review\" id=\"strong_female_character\">\n
      \ <picture>\n  \n  <source srcset=\"/images/2023/strong-female-character_1x.avif
      88w, /images/2023/strong-female-character_2x.avif 176w, /images/2023/strong-female-character_3x.avif
      264w\" sizes=\"(max-width: 88px) 100vw, 88px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/strong-female-character_1x.webp 88w, /images/2023/strong-female-character_2x.webp
      176w, /images/2023/strong-female-character_3x.webp 264w\" sizes=\"(max-width:
      88px) 100vw, 88px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/strong-female-character_1x.jpg
      88w, /images/2023/strong-female-character_2x.jpg 176w, /images/2023/strong-female-character_3x.jpg
      264w\" sizes=\"(max-width: 88px) 100vw, 88px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/strong-female-character_1x.jpg\" alt=\"The cover of
      \u201CStrong Female Character\u201D. It\u2019s a red page, with a cutout in
      the middle, as if somebody has sliced through many pages of the book. A page
      pokes out through the middle, showing part of a photo of Fern and some text.\"
      class=\"book_cover\" width=\"88\">\n</picture>\n  <div class=\"book_info\">\n
      \ <h2 class=\"book_title\">Strong Female Character</h2>\n  <p class=\"book_attribution\">\n
      \   by Fern Brady\n    \n    (2023)\n  </p>\n  <p class=\"book_meta\">\n    read
      <a href=\"https://books.alexwlchan.net/2023/strong-female-character/\">30 October
      2023</a>\n  </p>\n</div>\n</div>\n\n<p>This is a great memoir about autism and
      sexuality.</p>\n\n<p>I first saw Fern Brady when she appeared on <em>Taskmaster</em>,
      where she quickly became one of my favourite contestants.\nI loved how unapologetic
      she was about being herself, and how much fun she seemed to be having.\nWhen
      I learnt she was writing a memoir, I knew I had to read it.</p>\n\n<p>It\u2019s
      the story of her growing up, being autistic, and the ways her behaviours have
      affected her life.\nThere\u2019s also a lot of discussion of how being a woman
      meant her autism was overlooked or ignored for a long time.\nIt felt genuine
      and raw, and it wasn\u2019t unrealistically hopeful or optimistic \u2013 it
      was a statement about what being an autistic woman is like.</p>\n\n<p>I definitely
      saw parallels with my own life, and it\u2019s given me plenty to think about.</p>\n\n<p>I
      was engrossed and read it in a single day; I was enjoying it so much I actually
      missed my train stop on the way home.</p>\n\n<div class=\"book_review\" id=\"the_hard_road_out\">\n
      \ <picture>\n  \n  <source srcset=\"/images/2023/the-hard-road-out_1x.avif 91w,
      /images/2023/the-hard-road-out_2x.avif 182w, /images/2023/the-hard-road-out_3x.avif
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/the-hard-road-out_1x.webp 91w, /images/2023/the-hard-road-out_2x.webp
      182w, /images/2023/the-hard-road-out_3x.webp 273w\" sizes=\"(max-width: 91px)
      100vw, 91px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/the-hard-road-out_1x.jpg
      91w, /images/2023/the-hard-road-out_2x.jpg 182w, /images/2023/the-hard-road-out_3x.jpg
      273w\" sizes=\"(max-width: 91px) 100vw, 91px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/the-hard-road-out_1x.jpg\" alt=\"The cover of \u201CThe
      Hard Road Out\u201D. Most of the cover is text, and then there\u2019s a photo.
      A woman stands in a crowd of officials in brown uniform (presumably North Korean
      military attire). She has her back to the camera, and she\u2019s wearing a baby
      pink dress that makes her stand out from the men milling around her.\" class=\"book_cover\"
      width=\"91\">\n</picture>\n  <div class=\"book_info\">\n  <h2 class=\"book_title\">The
      Hard Road Out</h2>\n  <p class=\"book_attribution\">\n    by Jihyun Park and
      Seh-Lynn Chai\n    \n    (2022)\n  </p>\n  <p class=\"book_meta\">\n    read
      <a href=\"https://books.alexwlchan.net/2023/the-hard-road-out/\">20 November
      2023</a>\n  </p>\n</div>\n</div>\n\n<p>This is a gripping and horrifying story
      of growing up in North Korea, then escaping as an adult.</p>\n\n<p>North Korea
      is a country I was only vaguely aware of, and most of my knowledge comes from
      pop culture stereotypes, so I learnt a lot from this book.\nIt\u2019s primarily
      a story about Jihyun\u2019s experience rather than North Korean politics, but
      even so it covers a lot of Korean history that was new to me.</p>\n\n<p>It starts
      when Jihyun was a child, in the early 1970s, and North Korea was less uncomfortable,
      if not exactly prosperous.\nShe grows up to be a school teacher as the economy
      declines, and then escapes through China when things get much worse \u2013 saving
      herself, but leaving her entire family behind.\nOne of the most moving chapters
      is a farewell letter to her father.</p>\n\n<p>The writing is clear and simple,
      with plenty of small details and individual stories.\nAs with <em>Seven Fallen
      Feathers</em>, this is a good example of \u201Cshow, don\u2019t tell\u201D.</p>\n\n<!--
      The overall narrative is strong, but it's also full of small details and individual
      stories, which is the sort of thing I enjoy in memoirs. -->\n\n\n    <p>[If
      the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/2023-in-reading/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"books\"/>\n
      \   <summary type=\"html\">Storms and schools, escapes and exorcisms, murders
      and magic \u2013 what I enjoyed reading this year.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">Getting the path to the note I have open in Obsidian</title>\n
      \   <link href=\"https://alexwlchan.net/2023/obsidian-open-note/\" rel=\"alternate\"
      type=\"text/html\" title=\"Getting the path to the note I have open in Obsidian\"/>\n
      \   <published>2023-12-29T07:46:33+00:00</published>\n    <updated>2023-12-29T07:46:33+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/obsidian-open-note</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2023/obsidian-open-note/\"><![CDATA[\n<p>I
      have a bunch of Python scripts I use to clean up text files, and I call them
      by passing the path to the text file as an argument, for example:</p>\n\n<div
      class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>python clean_up_text.py /path/to/text/file.md\n</code></pre></div></div>\n\n<p>This
      is mostly fine, but finding that path is a bit annoying when I want to run them
      on a note I have open in Obsidian.\nIt\u2019s not hard, it just takes a few
      steps \u2013 open the \u201CMore options\u201D menu, click \u201CReveal in Finder\u201D,
      drag the file from Finder into terminal.\nI wanted a way to make it a bit quicker.</p>\n\n<p>I\u2019ve
      written a little script which gives me a path to the note I currently have open
      in Obsidian, so now I can run something more like:</p>\n\n<div class=\"language-console
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>python clean_up_text.py <span
      class=\"si\">$(</span>path_to_frontmost_obsidian_note<span class=\"si\">)</span>\n</code></pre></div></div>\n\n<p>I\u2019ve
      managed to do this with a bit of AppleScript and Python, even though Obsidian
      doesn\u2019t have any AppleScript support.</p>\n\n<hr>\n\n<p>The inspiration
      for this script was another script I have for getting the frontmost URL from
      my web browser.\nThe crux of that script is a single line of AppleScript that
      controls Safari:</p>\n\n<div class=\"language-applescript highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">tell</span><span
      class=\"w\"> </span><span class=\"nb\">application</span><span class=\"w\">
      </span><span class=\"s2\">\"Safari\"</span><span class=\"w\"> </span><span class=\"k\">to</span><span
      class=\"w\"> </span><span class=\"k\">get</span><span class=\"w\"> </span><span
      class=\"nv\">URL</span><span class=\"w\"> </span><span class=\"k\">of</span><span
      class=\"w\"> </span><span class=\"na\">document</span><span class=\"w\"> </span><span
      class=\"mi\">1</span><span class=\"w\">\n</span></code></pre></div></div>\n\n<p>Unfortunately
      this isn\u2019t quite as simple in Obsidian \u2013 it doesn\u2019t have any
      AppleScript support, so you can\u2019t do anything with <code class=\"language-plaintext
      highlighter-rouge\">tell application \"Obsidian\"</code>.</p>\n\n<p>(The lack
      of AppleScript is annoying, but understandable.\nIt\u2019s a niche technology
      on a marginal platform, and Apple seems to have completely forgotten it exists.\nMuch
      as I find AppleScript useful, it\u2019s hard to justify the time/effort to add
      support for it in a new app today.)</p>\n\n<p>But even if Obsidian doesn\u2019t
      have its own AppleScript dictionary, it is still visible from the AppleScript
      universe \u2013 as a process in System Events.\nWe can\u2019t see much, but
      we can see its windows, for example:</p>\n\n<div class=\"language-applescript
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">tell</span><span class=\"w\"> </span><span class=\"nb\">application</span><span
      class=\"w\"> </span><span class=\"s2\">\"System Events\"</span><span class=\"w\">\n
      \   </span><span class=\"k\">tell</span><span class=\"w\"> </span><span class=\"nv\">process</span><span
      class=\"w\"> </span><span class=\"s2\">\"Obsidian\"</span><span class=\"w\">
      </span><span class=\"k\">to</span><span class=\"w\"> </span><span class=\"k\">get</span><span
      class=\"w\"> </span><span class=\"na\">title</span><span class=\"w\"> </span><span
      class=\"k\">of</span><span class=\"w\"> </span><span class=\"nb\">front</span><span
      class=\"w\"> </span><span class=\"na\">window</span><span class=\"w\">\n</span><span
      class=\"k\">end</span><span class=\"w\"> </span><span class=\"k\">tell</span><span
      class=\"w\">\n</span></code></pre></div></div>\n\n<p>The window title has three
      parts, separated by hyphens: the name of the note, the name of the vault, and
      the Obsidian version:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code>Short story ideas - textfiles
      - Obsidian v1.4.16\n</code></pre></div></div>\n\n<p>This is the same title that
      shows up in the \u201CWindow\u201D menu \u2013 it\u2019s a bit of Obsidian poking
      into macOS where AppleScript can see it.\nBecause Obsidian always uses the title
      as the filename (e.g. this file is called <code class=\"language-plaintext highlighter-rouge\">Short
      story ideas.md</code>), we can use this to find the path to the Markdown file.</p>\n\n<hr>\n\n<p>To
      find the Markdown file, you match the vault name to a folder on disk, then you
      search for files that match the note title.\nThere are a bunch of ways you could
      do this; I picked Python because that\u2019s what I\u2019m familiar with, but
      you could use another language just as easily.</p>\n\n<p>This is the script
      I wrote, which I named <a href=\"https://github.com/alexwlchan/scripts/blob/main/macos/obnote\"><code
      class=\"language-plaintext highlighter-rouge\">obnote</code></a>.\nHopefully
      the comments are enough to explain what\u2019s going on:</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"c1\">#!/usr/bin/env python3\n</span><span class=\"sh\">\"\"\"</span><span
      class=\"s\">\nPrint the path to the Markdown file which is currently open\nin
      Obsidian (if any).\n\nThis relies on knowing the on-disk locations of my Obsidian
      vaults,\nso you won</span><span class=\"sh\">'</span><span class=\"s\">t be
      able to use this without changing it for your own setup.\n\nNote: this will
      print the *first* file with the same name as your\nopen note, which may cause
      issues if you have multiple notes with\nthe same title.\n</span><span class=\"sh\">\"\"\"</span>\n\n<span
      class=\"kn\">import</span> <span class=\"n\">os</span>\n<span class=\"kn\">import</span>
      <span class=\"n\">subprocess</span>\n\n\n<span class=\"k\">def</span> <span
      class=\"nf\">get_file_paths_under</span><span class=\"p\">(</span><span class=\"n\">root</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">.</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"o\">*</span><span
      class=\"p\">,</span> <span class=\"n\">suffix</span><span class=\"o\">=</span><span
      class=\"sh\">\"\"</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span
      class=\"s\">\n    Generates the absolute paths to every matching file under
      ``root``.\n\n    See https://alexwlchan.net/2023/snake-walker/\n    </span><span
      class=\"sh\">\"\"\"</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span>
      <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span
      class=\"p\">.</span><span class=\"nf\">isdir</span><span class=\"p\">(</span><span
      class=\"n\">root</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span>
      <span class=\"nc\">ValueError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span
      class=\"sh\">\"</span><span class=\"s\">Cannot find files under non-existent
      directory: </span><span class=\"si\">{</span><span class=\"n\">root</span><span
      class=\"si\">!r}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n
      \   <span class=\"k\">for</span> <span class=\"n\">dirpath</span><span class=\"p\">,</span>
      <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span>
      <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"p\">.</span><span
      class=\"nf\">walk</span><span class=\"p\">(</span><span class=\"n\">root</span><span
      class=\"p\">):</span>\n        <span class=\"k\">for</span> <span class=\"n\">f</span>
      <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n
      \           <span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span
      class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span
      class=\"nf\">join</span><span class=\"p\">(</span><span class=\"n\">dirpath</span><span
      class=\"p\">,</span> <span class=\"n\">f</span><span class=\"p\">)</span>\n\n
      \           <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"p\">.</span><span
      class=\"n\">path</span><span class=\"p\">.</span><span class=\"nf\">isfile</span><span
      class=\"p\">(</span><span class=\"n\">p</span><span class=\"p\">)</span> <span
      class=\"ow\">and</span> <span class=\"n\">f</span><span class=\"p\">.</span><span
      class=\"nf\">lower</span><span class=\"p\">().</span><span class=\"nf\">endswith</span><span
      class=\"p\">(</span><span class=\"n\">suffix</span><span class=\"p\">):</span>\n
      \               <span class=\"k\">yield</span> <span class=\"n\">p</span>\n\n\n<span
      class=\"k\">def</span> <span class=\"nf\">get_applescript_output</span><span
      class=\"p\">(</span><span class=\"n\">script</span><span class=\"p\">):</span>\n
      \   <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Run an AppleScript
      command and return the output.\n    </span><span class=\"sh\">\"\"\"</span>\n
      \   <span class=\"n\">cmd</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span
      class=\"sh\">\"</span><span class=\"s\">osascript</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">-e</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">script</span><span
      class=\"p\">]</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">subprocess</span><span
      class=\"p\">.</span><span class=\"nf\">check_output</span><span class=\"p\">(</span><span
      class=\"n\">cmd</span><span class=\"p\">).</span><span class=\"nf\">strip</span><span
      class=\"p\">().</span><span class=\"nf\">decode</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">utf8</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span>\n\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span>
      <span class=\"o\">==</span> <span class=\"sh\">\"</span><span class=\"s\">__main__</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span>\n    <span class=\"n\">window_title</span>
      <span class=\"o\">=</span> <span class=\"nf\">get_applescript_output</span><span
      class=\"p\">(</span><span class=\"sh\">\"\"\"</span><span class=\"s\">\n        tell
      application </span><span class=\"sh\">\"</span><span class=\"s\">System Events</span><span
      class=\"sh\">\"</span><span class=\"s\">\n            tell process </span><span
      class=\"sh\">\"</span><span class=\"s\">Obsidian</span><span class=\"sh\">\"</span><span
      class=\"s\"> to get title of front window\n        end tell\n    </span><span
      class=\"sh\">\"\"\"</span><span class=\"p\">)</span>\n\n    <span class=\"c1\">#
      The window title will be something of the form:\n</span>    <span class=\"c1\">#\n</span>
      \   <span class=\"c1\">#     Short story ideas - textfiles - Obsidian v1.4.16\n</span>
      \   <span class=\"c1\">#\n</span>    <span class=\"n\">note_title</span><span
      class=\"p\">,</span> <span class=\"n\">vault_name</span><span class=\"p\">,</span>
      <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">window_title</span><span
      class=\"p\">.</span><span class=\"nf\">rsplit</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\"> - </span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n\n
      \   <span class=\"c1\"># Match the vault name to a path on disk.\n</span>    <span
      class=\"c1\">#\n</span>    <span class=\"c1\"># This is very specific to my
      setup, so if you want to use it on\n</span>    <span class=\"c1\"># your computer,
      you'll need to customise this bit.\n</span>    <span class=\"k\">if</span> <span
      class=\"n\">vault_name</span> <span class=\"o\">==</span> <span class=\"sh\">\"</span><span
      class=\"s\">textfiles</span><span class=\"sh\">\"</span><span class=\"p\">:</span>\n
      \       <span class=\"n\">vault_root</span> <span class=\"o\">=</span> <span
      class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span
      class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">(</span><span
      class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">environ</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">HOME</span><span
      class=\"sh\">\"</span><span class=\"p\">],</span> <span class=\"sh\">\"</span><span
      class=\"s\">textfiles</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n
      \   <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span>
      <span class=\"nc\">ValueError</span><span class=\"p\">(</span><span class=\"sa\">f</span><span
      class=\"sh\">\"</span><span class=\"s\">Unrecognised vault name: </span><span
      class=\"si\">{</span><span class=\"n\">vault_name</span><span class=\"si\">}</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n\n    <span class=\"c1\">#
      Find Markdown files that match the name of this note.\n</span>    <span class=\"k\">for</span>
      <span class=\"n\">path</span> <span class=\"ow\">in</span> <span class=\"nf\">get_file_paths_under</span><span
      class=\"p\">(</span><span class=\"n\">vault_root</span><span class=\"p\">,</span>
      <span class=\"n\">suffix</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span
      class=\"s\">.md</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n
      \       <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"p\">.</span><span
      class=\"n\">path</span><span class=\"p\">.</span><span class=\"nf\">basename</span><span
      class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>
      <span class=\"o\">==</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span
      class=\"si\">{</span><span class=\"n\">note_title</span><span class=\"si\">}</span><span
      class=\"s\">.md</span><span class=\"sh\">\"</span><span class=\"p\">:</span>\n
      \           <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">path</span><span
      class=\"p\">,</span> <span class=\"n\">end</span><span class=\"o\">=</span><span
      class=\"sh\">\"\"</span><span class=\"p\">)</span>\n            <span class=\"k\">break</span>\n
      \   <span class=\"k\">else</span><span class=\"p\">:</span>  <span class=\"c1\">#
      no break\n</span>        <span class=\"k\">raise</span> <span class=\"nc\">RuntimeError</span><span
      class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span
      class=\"s\">Could not find note with title </span><span class=\"si\">{</span><span
      class=\"n\">note_title</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>This does assume that
      notes have unique titles \u2013 that I won\u2019t, for example, have two notes
      in different folders both called <code class=\"language-plaintext highlighter-rouge\">Short
      story ideas.md</code>.\nThat\u2019s true in my vault, but you might want to
      be careful using it if you reuse note titles.</p>\n\n<p>Now I can invoke my
      text cleanup scripts like so:</p>\n\n<div class=\"language-console highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">$</span><span
      class=\"w\"> </span>python clean_up_text.py <span class=\"si\">$(</span>obnote<span
      class=\"si\">)</span>\n</code></pre></div></div>\n\n<p>This is especially useful
      when I want to run the same cleanup script on multiple notes in quick succession.\nI
      can run this command once, switch to Obsidian and select a new note, then return
      to my terminal and press <code class=\"language-plaintext highlighter-rouge\">up-arrow</code>
      and <code class=\"language-plaintext highlighter-rouge\">enter</code> to run
      the cleanup on my new note.</p>\n\n<p>There are lots of other ways you could
      solve this problem \u2013 for example, I realised as I wrote this post that
      you could look at the <code class=\"language-plaintext highlighter-rouge\">.obsidian/workspace.json</code>
      file \u2013 but this works for me, and I had a bit of fun while writing it.</p>\n\n\n
      \   <p>[If the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/obsidian-open-note/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"obsidian\"/>\n
      \   <category term=\"applescript\"/>\n    <summary type=\"html\">Although Obsidian
      doesn\u2019t support AppleScript, I can use System Events to find out which
      note I have open.</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">Setting
      up Fish to make virtualenv easier</title>\n    <link href=\"https://alexwlchan.net/2023/fish-venv/\"
      rel=\"alternate\" type=\"text/html\" title=\"Setting up Fish to make virtualenv
      easier\"/>\n    <published>2023-12-19T10:33:36+00:00</published>\n    <updated>2023-12-19T10:33:36+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/fish-venv</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2023/fish-venv/\"><![CDATA[\n<p>Since I started
      my new job, I\u2019ve been doing a lot more work in Python.\nAs I was starting
      with a completely clean slate, I wanted to try setting up Python the \u201Cright\u201D
      way \u2013 or if not <a href=\"https://xkcd.com/1987/\">\u201Cright\u201D</a>,
      at least better way than my previous pile of hacks and kludges.</p>\n\n<p>(I
      don\u2019t remember much of my old approach, but I know it was messy.\nAt one
      point I used Homebrew and virtual environments, but I got burnt by Homebrew
      unexpectedly breaking Python, so I scrapped it and started installing everything
      in my global Python installation.\nDon\u2019t do that.)</p>\n\n<p>In August
      I read Glyph\u2019s post <a href=\"https://blog.glyph.im/2023/08/get-your-mac-python-from-python-dot-org.html\">Get
      Your Mac Python From Python.org</a> and it all seemed like sensible advice,
      so I decided to use that as my starting point.\nI downloaded Python on my new
      work laptop from Python.org, and I started using virtual environments for everything.</p>\n\n<p>This
      worked well enough, but there were some rough edges in my new workflow.\nI\u2019ve
      been tweaking <a href=\"https://github.com/alexwlchan/scripts\">my Fish shell
      config</a> to make it a bit smoother.</p>\n\n<hr>\n\n<h2 id=\"setting-the-pip_require_virtualenv-variable\">Setting
      the PIP_REQUIRE_VIRTUALENV variable</h2>\n\n<p>One recommendation in Glyph\u2019s
      post is that you <a href=\"https://blog.glyph.im/2023/08/get-your-mac-python-from-python-dot-org.html#and-always-use-virtual-environments\">always
      use virtual environments</a>, and they suggest a way to enforce that:</p>\n\n\n\n<blockquote>\n
      \ <p>Once you have installed Python from python.org, never <code class=\"language-plaintext
      highlighter-rouge\">pip install</code> anything globally into that Python, even
      using the <code class=\"language-plaintext highlighter-rouge\">--user</code>
      flag. Always, always use a virtual environment of some kind. In fact, I recommend
      configuring it so that it is not even possible to do so, by putting this in
      your <code class=\"language-plaintext highlighter-rouge\">~/.pip/pip.conf</code>:</p>\n\n
      \ <div class=\"language-plaintext highlighter-rouge\">\n<div class=\"highlight\"><pre
      class=\"highlight\"><code>[global]\nrequire-virtualenv = true\n</code></pre></div>
      \ </div>\n</blockquote>\n\n<p>I like the idea of always using virtualenvs, but
      I\u2019m not a fan of putting config files in my home directory.\nI struggle
      to keep them up-to-date, and after a while I lose track of what\u2019s what
      \u2013 is this config still in use, or is it cruft from a tool I no longer use?\nPlus,
      each config file becomes one more thing to remember when I set up a new computer.</p>\n\n<p>Fortunately,
      this config file isn\u2019t the only way to ensure you always use a virtual
      environment.\nYou can also <a href=\"https://docs.python-guide.org/dev/pip-virtualenv/#requiring-an-active-virtual-environment-for-pip\">set
      <code class=\"language-plaintext highlighter-rouge\">PIP_REQUIRE_VIRTUALENV</code></a>,
      so I have the following lines in my <a href=\"https://github.com/alexwlchan/scripts/blob/767df24a19000ae4db09d387dda76a8812acc985/config.fish#L10-L18\">fish
      shell config</a>:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># This
      prevents me from installing packages with pip without being</span>\n<span class=\"c\">#
      in a virtualenv first.</span>\n<span class=\"c\">#</span>\n<span class=\"c\">#
      This allows me to keep my system Python clean, and install all my</span>\n<span
      class=\"c\"># packages inside virtualenvs.</span>\n<span class=\"c\">#</span>\n<span
      class=\"c\"># See https://docs.python-guide.org/dev/pip-virtualenv/#requiring-an-active-virtual-environment-for-pip</span>\n<span
      class=\"c\"># See https://blog.glyph.im/2023/08/get-your-mac-python-from-python-dot-org.html#and-always-use-virtual-environments</span>\n<span
      class=\"c\">#</span>\n<span class=\"nb\">set</span> <span class=\"nt\">-g</span>
      <span class=\"nt\">-x</span> PIP_REQUIRE_VIRTUALENV <span class=\"nb\">true</span>\n</code></pre></div></div>\n\n<p>Because
      I keep my shell config in Git, it\u2019s easier to see when I added this variable,
      and when I get a new computer I\u2019ll get this right behaviour \u201Cfor free\u201D.</p>\n\n<h2
      id=\"a-function-to-create-and-auto-enable-new-virtual-environments\">A function
      to create and auto-enable new virtual environments</h2>\n\n<p>The process of
      creating new virtual environments is ostensibly simple \u2013 just two commands.</p>\n\n<div
      class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>python3 <span class=\"nt\">-m</span>
      venv .venv\n<span class=\"gp\">$</span><span class=\"w\"> </span><span class=\"nb\">source</span>
      .venv/bin/activate.fish\n</code></pre></div></div>\n\n<p>In practice I only
      ever remembered to run the first \u2013 I\u2019d create my new virtual environment,
      go to <code class=\"language-plaintext highlighter-rouge\">pip install</code>
      something, and then it would complain I hadn\u2019t enabled a virtual environment.\nI\u2019d
      mutter and grumble, activate the virtualenv, and try again.</p>\n\n<p>If I\u2019m
      creating a virtual environment, I want to use it immediately, so I wrapped this
      process in a Fish function called <code class=\"language-plaintext highlighter-rouge\">venv</code>:</p>\n\n<div
      class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">function </span>venv <span class=\"nt\">--description</span> <span
      class=\"s2\">\"Create and activate a new virtual environment\"</span>\n    <span
      class=\"nb\">echo</span> <span class=\"s2\">\"Creating virtual environment in
      \"</span><span class=\"o\">(</span><span class=\"nb\">pwd</span><span class=\"o\">)</span><span
      class=\"s2\">\"/.venv\"</span>\n    python3 <span class=\"nt\">-m</span> venv
      .venv <span class=\"nt\">--upgrade-deps</span>\n    <span class=\"nb\">source</span>
      .venv/bin/activate.fish\n\n    <span class=\"c\"># Append .venv to the Git exclude
      file, but only if it's not</span>\n    <span class=\"c\"># already there.</span>\n
      \   <span class=\"k\">if </span><span class=\"nb\">test</span> <span class=\"nt\">-e</span>
      .git\n        <span class=\"nb\">set </span>line_to_append <span class=\"s2\">\".venv\"</span>\n
      \       <span class=\"nb\">set </span>target_file <span class=\"s2\">\".git/info/exclude\"</span>\n\n
      \       <span class=\"k\">if </span>not <span class=\"nb\">grep</span> <span
      class=\"nt\">--quiet</span> <span class=\"nt\">--fixed-strings</span> <span
      class=\"nt\">--line-regexp</span> <span class=\"s2\">\"</span><span class=\"nv\">$line_to_append</span><span
      class=\"s2\">\"</span> <span class=\"s2\">\"</span><span class=\"nv\">$target_file</span><span
      class=\"s2\">\"</span> 2&gt;/dev/null\n            <span class=\"nb\">echo</span>
      <span class=\"s2\">\"</span><span class=\"nv\">$line_to_append</span><span class=\"s2\">\"</span>
      <span class=\"o\">&gt;&gt;</span> <span class=\"s2\">\"</span><span class=\"nv\">$target_file</span><span
      class=\"s2\">\"</span>\n        end\n    end\n\n    <span class=\"c\"># Tell
      Time Machine that it doesn't need to both backing up the</span>\n    <span class=\"c\">#
      virtualenv directory. (macOS-only)</span>\n    <span class=\"c\"># See https://ss64.com/mac/tmutil.html</span>\n
      \   tmutil addexclusion .venv\nend\n</code></pre></div></div>\n\n<p>I typically
      run this in the root of a project directory, usually a Git repo.</p>\n\n<p>When
      I run it, it creates a new virtual environment with an up-to-date version of
      <code class=\"language-plaintext highlighter-rouge\">pip</code> (thanks to <code
      class=\"language-plaintext highlighter-rouge\">--upgrade-deps</code>), then
      it activates it immediately.\nThis means my next command can be a <code class=\"language-plaintext
      highlighter-rouge\">pip install</code>, and it\u2019ll run inside the new virtualenv.</p>\n\n<p>It
      also adds the <code class=\"language-plaintext highlighter-rouge\">.venv</code>
      directory to <code class=\"language-plaintext highlighter-rouge\">.git/info/exclude</code>,
      which is a local-only gitignore file.\nThis means that Git will ignore my virtual
      environment, and not try to save it.\nThe <code class=\"language-plaintext highlighter-rouge\">grep</code>
      command is checking that I haven\u2019t already gitignore-d <code class=\"language-plaintext
      highlighter-rouge\">.venv</code>, so I don\u2019t add repeated ignore rules.</p>\n\n<p>It
      also tells Time Machine not to bother backing up the virtual environment directory.\nI\u2019d
      never restore a virtualenv from a backup; I\u2019d just create a new one fresh,
      so backing it up is a waste of space and CPU cycles.</p>\n\n<p>I often combine
      this with another function I have for creating temporary directories:</p>\n\n<div
      class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">function </span>tmpdir <span class=\"nt\">--description</span> <span
      class=\"s2\">\"Create and switch into a temporary directory\"</span>\n    <span
      class=\"nb\">cd</span> <span class=\"o\">(</span><span class=\"nb\">mktemp</span>
      <span class=\"nt\">-d</span><span class=\"o\">)</span>\nend\n</code></pre></div></div>\n\n<p>like
      so:</p>\n\n<div class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code><span class=\"gp\">$</span><span class=\"w\"> </span>tmpdir<span
      class=\"p\">;</span> venv\n</code></pre></div></div>\n\n<p>And with two short
      commands, I\u2019m in an empty directory with a fresh virtual environment.\nThis
      is great for quick prototyping, experiments, and one-off projects.</p>\n\n<h2
      id=\"auto-activating-virtual-environments-when-i-switch-directories\">Auto-activating
      virtual environments when I switch directories</h2>\n\n<p>Once I\u2019ve created
      my virtual environments, I need to remember to activate them.</p>\n\n<p>I could
      do this manually, or I could have the computer look for virtualenvs and (de)activate
      them automatically for me.\nThere are various plugins for doing this (I used
      <a href=\"https://virtualfish.readthedocs.io/en/latest/plugins.html#auto-activation-auto-activation\">virtualfish</a>
      a few years ago), but this time round I realised my needs were simple enough
      that I could just write my own function.</p>\n\n<p>My <code class=\"language-plaintext
      highlighter-rouge\">venv</code> function ensures a standard approach to virtualenv
      naming: I always call them <code class=\"language-plaintext highlighter-rouge\">.venv</code>,
      and I put them in the root of my project directories, which are always Git repos.\nThis
      means I can find if there\u2019s a virtualenv I want to auto-activate by looking
      to see if I\u2019m in a Git repo, then looking for a folder called <code class=\"language-plaintext
      highlighter-rouge\">.venv</code>.</p>\n\n<p>This is the function:</p>\n\n<div
      class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">function </span>auto_activate_venv <span class=\"nt\">--on-variable</span>
      PWD <span class=\"nt\">--description</span> <span class=\"s2\">\"Auto activate/deactivate
      virtualenv when I change directories\"</span>\n\n    <span class=\"c\"># Get
      the top-level directory of the current Git repo (if any)</span>\n    <span class=\"nb\">set
      </span>REPO_ROOT <span class=\"o\">(</span>git rev-parse <span class=\"nt\">--show-toplevel</span>
      2&gt;/dev/null<span class=\"o\">)</span>\n\n    <span class=\"c\"># Case #1:
      cd'd from a Git repo to a non-Git folder</span>\n    <span class=\"c\">#</span>\n
      \   <span class=\"c\"># There's no virtualenv to activate, and we want to deactivate
      any</span>\n    <span class=\"c\"># virtualenv which is already active.</span>\n
      \   <span class=\"k\">if </span><span class=\"nb\">test</span> <span class=\"nt\">-z</span>
      <span class=\"s2\">\"</span><span class=\"nv\">$REPO_ROOT</span><span class=\"s2\">\"</span><span
      class=\"p\">;</span> and <span class=\"nb\">test</span> <span class=\"nt\">-n</span>
      <span class=\"s2\">\"</span><span class=\"nv\">$VIRTUAL_ENV</span><span class=\"s2\">\"</span>\n
      \       deactivate\n    end\n\n    <span class=\"c\"># Case #2: cd'd folders
      within the same Git repo</span>\n    <span class=\"c\">#</span>\n    <span class=\"c\">#
      The virtualenv for this Git repo is already activated, so there's</span>\n    <span
      class=\"c\"># nothing more to do.</span>\n    <span class=\"k\">if</span> <span
      class=\"o\">[</span> <span class=\"s2\">\"</span><span class=\"nv\">$VIRTUAL_ENV</span><span
      class=\"s2\">\"</span> <span class=\"o\">=</span> <span class=\"s2\">\"</span><span
      class=\"nv\">$REPO_ROOT</span><span class=\"s2\">/.venv\"</span> <span class=\"o\">]</span>\n
      \       <span class=\"k\">return\n    </span>end\n\n    <span class=\"c\">#
      Case #3: cd'd from a non-Git folder into a Git repo</span>\n    <span class=\"c\">#</span>\n
      \   <span class=\"c\"># If there's a virtualenv in the root of this repo, we
      should</span>\n    <span class=\"c\"># activate it now.</span>\n    <span class=\"k\">if</span>
      <span class=\"o\">[</span> <span class=\"nt\">-d</span> <span class=\"s2\">\"</span><span
      class=\"nv\">$REPO_ROOT</span><span class=\"s2\">/.venv\"</span> <span class=\"o\">]</span>\n
      \       <span class=\"nb\">source</span> <span class=\"s2\">\"</span><span class=\"nv\">$REPO_ROOT</span><span
      class=\"s2\">/.venv/bin/activate.fish\"</span> &amp;&gt;/dev/null\n    end\nend\n</code></pre></div></div>\n\n<p>This
      function runs as an <a href=\"https://fishshell.com/docs/current/language.html#event\">event
      handler</a> in Fish \u2013 it runs whenever the <code class=\"language-plaintext
      highlighter-rouge\">PWD</code> variable changes.\nThat variable is the current
      working directory, so in practice this runs whenever I change directories.</p>\n\n<p>I
      find the top-level directory of the current Git repo by running <a href=\"https://git-scm.com/docs/git-rev-parse\"><code
      class=\"language-plaintext highlighter-rouge\">git rev-parse --show-toplevel</code></a>,
      which is a super handy command I use in lots of scripts.\nIf I\u2019m not in
      a Git repo, it returns an empty string.\nThen I compare that to the path of
      the currently-enabled virtualenv in <code class=\"language-plaintext highlighter-rouge\">VIRTUAL_ENV</code>,
      and decide whether I need to activate or deactivate a virtualenv.</p>\n\n<hr>\n\n<p>If
      you want the complete code, my Fish shell config is <a href=\"https://github.com/alexwlchan/scripts\">in
      a public repo</a>, although the virtualenv stuff is a bit spread out.</p>\n\n<p>This
      was the first project where I used ChatGPT to help write the code.\nI was initially
      quite sceptical of LLMs, but watching <a href=\"https://simonwillison.net/2023/Mar/27/ai-enhanced-development/\">what
      Simon Willison has been doing</a> persuaded me to try it.\nThis felt like a
      safe project to try it \u2013 it\u2019s a minimal project with clearly defined
      \u201Cis the code working\u201D criteria, and limited impact if I do something
      daft.</p>\n\n<p>Overall I was quite impressed.\nAll the code seemed to work,
      and it was helpful for the bits of shell syntax I only half-remember \u2013
      things like <code class=\"language-plaintext highlighter-rouge\">test -z</code>
      and combining multiple conditions in a boolean.\nI didn\u2019t use any of its
      output directly, but it was a good starting point that I could adapt into my
      actual code.\nI\u2019m sure this won\u2019t be my last project where ChatGPT
      lends a helping hand.</p>\n\n\n    <p>[If the formatting of this post looks
      odd in your feed reader, <a href=\"https://alexwlchan.net/2023/fish-venv/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"python\"/>\n
      \   <category term=\"python:virtualenv\"/>\n    <category term=\"fish-shell\"/>\n
      \   <summary type=\"html\">I wrote some shell config to smooth out the experience
      of using virtual environments in Python.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">Telling mechanize how to find local issuer certificates</title>\n
      \   <link href=\"https://alexwlchan.net/2023/mechanize-ssl/\" rel=\"alternate\"
      type=\"text/html\" title=\"Telling mechanize how to find local issuer certificates\"/>\n
      \   <published>2023-12-07T20:53:08+00:00</published>\n    <updated>2023-12-07T20:53:08+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/mechanize-ssl</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2023/mechanize-ssl/\"><![CDATA[\n<p>I was
      doing some work on <a href=\"/2022/library-lookup/\">my library lookup tool</a>
      recently, and I ran into an issue with <a href=\"https://pypi.org/project/mechanize/\">mechanize</a>,
      the Python library I use to simulate a web browser.\nI\u2019d upgraded my version
      of Python and mechanize, and now I wasn\u2019t able to connect to HTTPS sites.</p>\n\n<p>If
      I tried a simple example:</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span>
      <span class=\"n\">mechanize</span>\n\n<span class=\"n\">browser</span> <span
      class=\"o\">=</span> <span class=\"n\">mechanize</span><span class=\"p\">.</span><span
      class=\"nc\">Browser</span><span class=\"p\">()</span>\n<span class=\"n\">browser</span><span
      class=\"p\">.</span><span class=\"nf\">set_handle_robots</span><span class=\"p\">(</span><span
      class=\"bp\">False</span><span class=\"p\">)</span>\n<span class=\"n\">browser</span><span
      class=\"p\">.</span><span class=\"nf\">open</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">https://www.example.net/</span><span
      class=\"sh\">\"</span><span class=\"p\">).</span><span class=\"nf\">read</span><span
      class=\"p\">()</span>\n</code></pre></div></div>\n\n<p>it would fail with an
      error:</p>\n\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code>ssl.SSLCertVerificationError: [SSL: CERTIFICATE_VERIFY_FAILED]
      certificate\nverify failed: unable to get local issuer certificate (_ssl.c:1000)\n</code></pre></div></div>\n\n<p>My
      first instinct was to check Google and GitHub; I couldn\u2019t find any other
      instances of people finding and fixing this issue.\nThe most I could find was
      <a href=\"https://mechanize.readthedocs.io/en/latest/index.html\">a quickstart
      example</a> that starts with an HTTP example, then suggests disabling SSL verification
      to access HTTPS sites.\nI found a few instances of people following this suggestion
      on GitHub \u2013 but I wasn\u2019t keen on that.\nSSL verification exists for
      a reason; I don\u2019t want to get rid of it!</p>\n\n<p>A bit later I found
      a page <a href=\"https://mechanize.readthedocs.io/en/latest/advanced.html#using-custom-ca-certificates\">about
      changing the certificates</a> used by your mechanize browser with <code class=\"language-plaintext
      highlighter-rouge\">browser.set_ca_data()</code>.\nI knew from my work on HTTP
      libraries that <a href=\"https://github.com/certifi/python-certifi\">certifi</a>
      is a bundle of SSL certificates often used in Python libraries, so I decided
      to try pointing mechanize at certifi:</p>\n\n<div class=\"language-diff highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code> import mechanize\n import
      certifi\n<span class=\"err\">\n</span> browser = mechanize.Browser()\n browser.set_handle_robots(False)\n<span
      class=\"gi\">+browser.set_ca_data(cafile=certifi.where())\n</span> browser.open(\"https://www.example.net/\").read()\n</code></pre></div></div>\n\n<p>That
      seemed to work, and my mechanize browser was once again able to browse the HTTPS
      web.</p>\n\n<p>If you use popular HTTP libraries like <a href=\"https://www.python-httpx.org/advanced/#ssl-certificates\">httpx</a>
      or <a href=\"https://requests.readthedocs.io/en/latest/user/advanced/?highlight=certifi#ca-certificates\">requests</a>,
      they install and load SSL certificates from certifi automatically.\nI don\u2019t
      know why mechanize doesn\u2019t do the same, but it was just a one-line change
      to get it working correctly.</p>\n\n<!--\n\nTraceback (most recent call last):\n
      \ File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_urllib2_fork.py\",
      line 1242, in do_open\n    h.request(str(req.get_method()), str(req.get_selector()),
      req.data,\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1319, in request\n    self._send_request(method, url, body, headers, encode_chunked)\n
      \ File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1365, in _send_request\n    self.endheaders(body, encode_chunked=encode_chunked)\n
      \ File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1314, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n
      \ File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1074, in _send_output\n    self.send(msg)\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1018, in send\n    self.connect()\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py\",
      line 1460, in connect\n    self.sock = self._context.wrap_socket(self.sock,\n
      \               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/ssl.py\",
      line 455, in wrap_socket\n    return self.sslsocket_class._create(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n
      \ File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/ssl.py\",
      line 1046, in _create\n    self.do_handshake()\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/ssl.py\",
      line 1317, in do_handshake\n    self._sslobj.do_handshake()\nssl.SSLCertVerificationError:
      [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local
      issuer certificate (_ssl.c:1000)\n\nDuring handling of the above exception,
      another exception occurred:\n\nTraceback (most recent call last):\n  File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/s.py\",
      line 5, in <module>\n    browser.open(\"https://www.example.net/\").read()\n
      \   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_mechanize.py\",
      line 257, in open\n    return self._mech_open(url_or_request, data, timeout=timeout)\n
      \          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_mechanize.py\",
      line 287, in _mech_open\n    response = UserAgentBase.open(self, request, data)\n
      \              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_opener.py\",
      line 193, in open\n    response = urlopen(self, req, data)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n
      \ File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_urllib2_fork.py\",
      line 431, in _open\n    result = self._call_chain(self.handle_open, protocol,
      protocol +\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n
      \ File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_urllib2_fork.py\",
      line 420, in _call_chain\n    result = func(*args)\n             ^^^^^^^^^^^\n
      \ File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_urllib2_fork.py\",
      line 1296, in https_open\n    return self.do_open(conn_factory, req)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n
      \ File \"/private/var/folders/3s/tb0f2zjd6gq7f9x0k2_r0ndw0000gn/T/tmp.i2QQ1FRh/.venv/lib/python3.12/site-packages/mechanize/_urllib2_fork.py\",
      line 1246, in do_open\n    raise URLError(err)\nurllib.error.URLError: <urlopen
      error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to
      get local issuer certificate (_ssl.c:1000)>\n\n-->\n\n\n    <p>[If the formatting
      of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/mechanize-ssl/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"python\"/>\n
      \   <category term=\"python:mechanize\"/>\n    <category term=\"python:certifi\"/>\n
      \   <summary type=\"html\">Fixing the \u201Cunable to get local issuer certificate\u201D
      error when using mechanize.Browser.</summary>\n  </entry>\n  <entry>\n    <title
      type=\"html\">Making the fish shell more forgetful</title>\n    <link href=\"https://alexwlchan.net/2023/forgetful-fish/\"
      rel=\"alternate\" type=\"text/html\" title=\"Making the fish shell more forgetful\"/>\n
      \   <published>2023-10-20T23:08:51+00:00</published>\n    <updated>2023-10-20T23:08:51+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/forgetful-fish</id>\n    <content type=\"html\"
      xml:base=\"https://alexwlchan.net/2023/forgetful-fish/\"><![CDATA[\n<p>For quite
      a few years, I\u2019ve been using fish (<a href=\"https://fishshell.com/\">https://fishshell.com/</a>)
      as my shell.</p>\n\n<p>One of the cool things it does is autosuggestions from
      my shell history.\nAs I\u2019m typing, it suggests (in light grey) a command
      I\u2019ve run before.\nI can press the right arrow to accept the suggestion,
      or I can keep typing to ignore it.</p>\n\n<picture>\n  \n\n<source srcset=\"/images/2023/fish_autosuggestion.dark_1x.png
      500w, /images/2023/fish_autosuggestion.dark_2x.png 1000w\" sizes=\"(max-width:
      500px) 100vw, 500px\" type=\"image/png\" media=\"(prefers-color-scheme: dark)\"></source>\n\n\n
      \ \n  \n  <source srcset=\"/images/2023/fish_autosuggestion_1x.png 500w, /images/2023/fish_autosuggestion_2x.png
      1000w\" sizes=\"(max-width: 500px) 100vw, 500px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2023/fish_autosuggestion_1x.png\" class=\"screenshot dark_aware\"
      alt=\"Screenshot of my terminal, showing three commands. The first is 'mate
      src/_drafts/forgetful-fish.md' and the second is 'make html'. For the third
      command, I've typed 'mate', and it\u2019s suggested the filename 'src/_drafts/forgetful-fish.md'
      based on my first command.\" width=\"500\">\n</picture>\n\n<p>This feature is
      pretty smart and very useful, and it\u2019s probably saved me thousands of keystrokes.\nBut
      a few times recently it\u2019s gone wrong, and suggested me something I didn\u2019t
      want \u2013 so I\u2019ve been tweaking my fish config to make it easier for
      fish to \u201Cforget\u201D certain commands.</p>\n\n<h2 id=\"what-i-dont-want-suggested\">What
      I don\u2019t want suggested</h2>\n\n<p>There are a couple of categories of command
      that I don\u2019t want fish to remember or suggest:</p>\n\n<ol>\n  <li>\n    <p><strong>Typos
      and mistakes.</strong>\nIf I ever mistype a command and run it, that mistake
      will be used for future autosuggestions.\nGetting a command wrong once is annoying;
      having my mistake be continually suggested is worse.</p>\n\n    <p>A while back
      I mistyped <code class=\"language-plaintext highlighter-rouge\">hdiutil attach</code>
      as <code class=\"language-plaintext highlighter-rouge\">hdiutil atach</code>,
      and I kept getting the wrong version as an autosuggestion.\n(That annoyance
      is what led to the code in this post!)</p>\n  </li>\n  <li>\n    <p><strong>Sensitive
      information.</strong>\nSometimes I end up with sensitive information in my shell
      commands \u2013 either by accident, or because it\u2019s the fastest way to
      fix a problem.\nI know I\u2019m not meant to do that, but nobody\u2019s perfect.</p>\n\n
      \   <p>My fish shell history lives unencrypted in a file on disk, where anything
      could find it (<code class=\"language-plaintext highlighter-rouge\">~/.local/share/fish/fish_history</code>).\nI\u2019d
      rather not have passwords, keys, and other credentials living there forever.</p>\n
      \ </li>\n  <li>\n    <p><strong>Potentially dangerous commands.</strong>\nMy
      example of this is doing a Git force push, which can delete data if I\u2019m
      not careful.\nIt\u2019s the right thing to do sometimes, but I never want to
      start typing a regular Git push and get a force push as an autosuggestion.</p>\n\n
      \   <p>I never want to do a force push accidentally, and I\u2019m willing to
      give up the benefits of autosuggestion for a bit of extra safety.</p>\n  </li>\n</ol>\n\n<p>To
      help me avoid autosuggestion in these three cases, I\u2019ve added two functions
      to my shell config.</p>\n\n<h2 id=\"function-1-forget-the-last-command\">Function
      #1: forget the last command</h2>\n\n<p>This function removes the last-typed
      command from my history, which prevents it from being suggested again.\nI run
      this manually, whenever I mistype a command or some other one-off thing I don\u2019t
      want to remember.</p>\n\n<div class=\"language-shell highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">function
      </span>forget_last_command\n    <span class=\"nb\">set </span>last_typed_command
      <span class=\"o\">(</span><span class=\"nb\">history</span> <span class=\"nt\">--max</span>
      1<span class=\"o\">)</span>\n    <span class=\"nb\">history </span>delete <span
      class=\"nt\">--exact</span> <span class=\"nt\">--case-sensitive</span> <span
      class=\"s2\">\"</span><span class=\"nv\">$last_typed_command</span><span class=\"s2\">\"</span>\n
      \   <span class=\"nb\">true\n</span>end\n</code></pre></div></div>\n\n<p>You
      can test this with the following steps:</p>\n\n<ol>\n  <li>Run a command like
      <code class=\"language-plaintext highlighter-rouge\">echo \"my password is hunter2\"</code>\n</li>\n
      \ <li>Type <code class=\"language-plaintext highlighter-rouge\">echo</code>
      into your shell, and see that the previous command is suggested</li>\n  <li>Cancel
      that command, and instead, run <code class=\"language-plaintext highlighter-rouge\">forget_last_command</code>\n</li>\n
      \ <li>Start typing <code class=\"language-plaintext highlighter-rouge\">echo</code>
      again, and notice that the first command is no longer suggested</li>\n  <li>Open
      a new session, start typing <code class=\"language-plaintext highlighter-rouge\">echo</code>,
      and check that the first command isn\u2019t suggested</li>\n</ol>\n\n<p>The
      heavy lifting is done by fish\u2019s <a href=\"https://fishshell.com/docs/current/cmds/history.html\"><code
      class=\"language-plaintext highlighter-rouge\">history</code> command</a> \u2013
      first it looks up the last command I typed, then it removes that from the history,
      and finally it persists that change to disk.</p>\n\n<p>(I\u2019m not entirely
      sure the <code class=\"language-plaintext highlighter-rouge\">history save</code>
      should be necessary, but with fish 3.6.1 \u2013 the latest version \u2013 it
      is required for this to work.\nI think there\u2019s something <a href=\"https://github.com/fish-shell/fish-shell/issues/10066\">slightly
      funky</a> about <code class=\"language-plaintext highlighter-rouge\">history
      delete --exact</code>, which made this maddening to debug until I started following
      my <a href=\"https://fishshell.com/docs/current/cmds/history.html#customizing-the-name-of-the-history-file\"><code
      class=\"language-plaintext highlighter-rouge\">fish_history</code> file</a>.)</p>\n\n<h2
      id=\"function-2-never-remember-certain-commands\">Function #2: never remember
      certain commands</h2>\n\n<p>Forgetting a command on a one-off basis is good
      for typos and accidental passwords, but what about commands I use on a semi-regular
      basis?\nIt\u2019d be annoying if I had to type <code class=\"language-plaintext
      highlighter-rouge\">forget_last_command</code> every time I ran <code class=\"language-plaintext
      highlighter-rouge\">git push --force</code>.</p>\n\n<p>This function looks at
      my last command, and if it\u2019s dangerous, it removes it from my history.\nCrucially,
      this runs as part of my shell prompt, so it runs as soon as a command completes
      \u2013 I don\u2019t need to remember to forget:</p>\n\n<div class=\"language-shell
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">function </span>forget_dangerous_history_commands\n    <span class=\"nb\">set
      </span>last_typed_command <span class=\"o\">(</span><span class=\"nb\">history</span>
      <span class=\"nt\">--max</span> 1<span class=\"o\">)</span>\n\n    <span class=\"k\">if</span>
      <span class=\"o\">[</span> <span class=\"s2\">\"</span><span class=\"nv\">$last_typed_command</span><span
      class=\"s2\">\"</span> <span class=\"o\">=</span> <span class=\"s2\">\"git push
      origin (gcb) --force\"</span> <span class=\"o\">]</span>\n        <span class=\"nb\">history
      </span>delete <span class=\"nt\">--exact</span> <span class=\"nt\">--case-sensitive</span>
      <span class=\"s2\">\"</span><span class=\"nv\">$last_typed_command</span><span
      class=\"s2\">\"</span>\n        <span class=\"nb\">history </span>save\n    end\nend\n</code></pre></div></div>\n\n<p>You
      can test this with the following steps:</p>\n\n<ol>\n  <li>Switch to a Git repository
      where it\u2019s safe to force push</li>\n  <li>Run the command <code class=\"language-plaintext
      highlighter-rouge\">git push origin (gcb) --force</code> (here <code class=\"language-plaintext
      highlighter-rouge\">gcb</code> is an alias for <code class=\"language-plaintext
      highlighter-rouge\">git rev-parse --abbrev-ref HEAD</code>, which prints the
      name of the currently checked-out branch)</li>\n  <li>Start typing <code class=\"language-plaintext
      highlighter-rouge\">git push</code> again, and notice that the force push isn\u2019t
      suggested</li>\n</ol>\n\n<p>A force push is the only example of a dangerous
      command that I use regularly, but there could be others \u2013 anything involving
      <code class=\"language-plaintext highlighter-rouge\">rm -rf</code>, for example.\nIf
      I ever find myself doing something dangerous that I never want suggested, it
      should be pretty easy to extend this function.</p>\n\n\n    <p>[If the formatting
      of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/forgetful-fish/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"shell-scripting\"/>\n
      \   <category term=\"fish-shell\"/>\n    <summary type=\"html\">A few commands
      that help me keep unwanted entries out of my shell\u2019s autocomplete.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">Hyperfocus and hobbies &amp;rarr;</title>\n
      \   <link href=\"https://wellcomecollection.org/articles/ZRrH3RIAACIAALP5\"
      rel=\"alternate\" type=\"text/html\" title=\"Hyperfocus and hobbies\"/>\n    <published>2023-10-20T09:16:15+00:00</published>\n
      \   <updated>2023-10-20T09:16:15+00:00</updated>\n    <id>https://alexwlchan.net/2023/hyperfocus-and-hobbies</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/hyperfocus-and-hobbies/\"><![CDATA[\n<p>One
      of the last things I did at Wellcome Collection was writing a story about hyperfocus
      and how it affects my cross-stitch.\nI\u2019m really proud of this one, and
      I hope you\u2019ll consider reading.</p>\n\n<p>Writing for Stories was one of
      my \u201Cbucket list\u201D items while working at Wellcome, and I actually submitted
      the pitch on the same night I decided to start looking for new jobs.\nIt\u2019s
      among the more personal things I\u2019ve written, but I\u2019m really pleased
      with the result.\nI\u2019m incredibly grateful to Alice White (my editor) and
      Steven Pocock (who took the photographs) who helped turn my rough idea into
      something great, and a nice capstone for my time at Wellcome.</p>\n\n<p>There
      are photos of several of my finished or in-progress pieces in the article, which
      come from a variety of artists:</p>\n\n<ul>\n  <li>\n<em>The World is Quiet
      Here</em> is a reference to the Lemony Snicket books, and <a href=\"https://www.etsy.com/uk/listing/1203491391/a-series-of-unfortunate-events-lemony\">the
      pattern is by NeatoBurritoStitches</a>.</li>\n  <li>\n<em>Vintage Clothes not
      Vintage Values</em> is <a href=\"https://www.etsy.com/uk/listing/862043025/vintage-clothes-not-vintage-values-cross\">a
      pattern by HappySlothPatterns</a>.\nI changed the tint colour from a soft pink
      to a vibrant green, to match the frame I\u2019m planning to use.</li>\n  <li>The
      black cat in the plants is one of <a href=\"https://www.etsy.com/uk/listing/1244615562/funny-cats-cross-stitch-pattern-home\">a
      set of patterns by SamXstitch</a>, and I\u2019m working my way through the rest
      now.</li>\n  <li>The close-up stitching on black aida is from <em>Silver Needle</em>
      by perennial favourite Mathysphere, and was published <a href=\"https://xstitchmag.com/space-cross-stitch/\">in
      XStitch Magazine</a>.</li>\n</ul>\n\n<p>You can read the story <a href=\"https://wellcomecollection.org/articles/ZRrH3RIAACIAALP5\">on
      the Wellcome Collection website</a>.</p>\n\n\n    <p>[If the formatting of this
      post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/hyperfocus-and-hobbies/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"personal\"/>\n
      \   <category term=\"cross-stitch\"/>\n    <category term=\"wellcome-collection\"/>\n
      \   <summary type=\"html\">The power of ADHD-associated hyperfocus and how I\u2019ve
      become wary of feeding it too often.</summary>\n  </entry>\n  <entry>\n    <title
      type=\"html\">Finding the biggest items in my Photos Library</title>\n    <link
      href=\"https://alexwlchan.net/2023/finding-big-photos/\" rel=\"alternate\" type=\"text/html\"
      title=\"Finding the biggest items in my Photos Library\"/>\n    <published>2023-10-15T16:12:21+00:00</published>\n
      \   <updated>2023-10-15T16:12:21+00:00</updated>\n    <id>https://alexwlchan.net/2023/finding-big-photos</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/finding-big-photos/\"><![CDATA[\n<p>I\u2019m
      approaching the limit of my current iCloud storage tier, and most of that is
      my Photos Library.\nI don\u2019t really want to pay for the next iCloud storage
      tier \u2013 I\u2019d be tripling my bill, but I\u2019d barely use the extra
      space.\n(My library grows pretty slowly \u2013 I\u2019ve only added ~6GB of
      photos this year.)</p>\n\n<p>What I\u2019d rather do is move some big items
      out of my library, and get some space back.\nI\u2019ve got <a href=\"/2023/blink/\">a
      pretty good workflow</a> for reviewing new photos, but what about ones from
      before I had my reviewing tool?</p>\n\n<p>I wrote a short Swift script which
      prints a list of all the largest files in my Photos Library.\nThe key part is
      two methods in PhotoKit: <a href=\"https://developer.apple.com/documentation/photokit/phasset/1624783-fetchassets\">PHAsset.fetchAssets</a>
      to enumerate all the files, and <a href=\"https://developer.apple.com/documentation/photokit/phassetresource/1623988-assetresources\">PHAssetResource.assetResources</a>
      to retrieve the original filename and file size.\nThe rest of the script takes
      the data and does some sorting and pretty-printing.</p>\n\n<div class=\"language-swift
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"cp\">#!/usr/bin/env swift</span>\n\n<span class=\"kd\">import</span>
      <span class=\"kt\">Photos</span>\n\n<span class=\"kd\">struct</span> <span class=\"kt\">AssetData</span><span
      class=\"p\">:</span> <span class=\"kt\">Codable</span> <span class=\"p\">{</span>\n
      \ <span class=\"k\">var</span> <span class=\"nv\">localIdentifier</span><span
      class=\"p\">:</span> <span class=\"kt\">String</span>\n  <span class=\"k\">var</span>
      <span class=\"nv\">originalFilename</span><span class=\"p\">:</span> <span class=\"kt\">String</span>\n
      \ <span class=\"k\">var</span> <span class=\"nv\">fileSize</span><span class=\"p\">:</span>
      <span class=\"kt\">Int64</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">///
      Returns a list of assets in the Photos Library.</span>\n<span class=\"c1\">///</span>\n<span
      class=\"c1\">/// The list is sorted by file size, from largest to smallest.</span>\n<span
      class=\"kd\">func</span> <span class=\"nf\">getAssetsBySize</span><span class=\"p\">()</span>
      <span class=\"o\">-&gt;</span> <span class=\"p\">[</span><span class=\"kt\">AssetData</span><span
      class=\"p\">]</span> <span class=\"p\">{</span>\n  <span class=\"k\">var</span>
      <span class=\"nv\">allAssets</span><span class=\"p\">:</span> <span class=\"p\">[</span><span
      class=\"kt\">AssetData</span><span class=\"p\">]</span> <span class=\"o\">=</span>
      <span class=\"p\">[]</span>\n\n  <span class=\"k\">let</span> <span class=\"nv\">options</span><span
      class=\"p\">:</span> <span class=\"kt\">PHFetchOptions</span><span class=\"p\">?</span>
      <span class=\"o\">=</span> <span class=\"kc\">nil</span>\n\n  <span class=\"kt\">PHAsset</span><span
      class=\"o\">.</span><span class=\"nf\">fetchAssets</span><span class=\"p\">(</span><span
      class=\"nv\">with</span><span class=\"p\">:</span> <span class=\"n\">options</span><span
      class=\"p\">)</span>\n    <span class=\"o\">.</span><span class=\"nf\">enumerateObjects</span><span
      class=\"p\">({</span> <span class=\"p\">(</span><span class=\"n\">asset</span><span
      class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span
      class=\"n\">_</span><span class=\"p\">)</span> <span class=\"k\">in</span>\n
      \     <span class=\"k\">let</span> <span class=\"nv\">resource</span> <span
      class=\"o\">=</span> <span class=\"kt\">PHAssetResource</span><span class=\"o\">.</span><span
      class=\"nf\">assetResources</span><span class=\"p\">(</span><span class=\"nv\">for</span><span
      class=\"p\">:</span> <span class=\"n\">asset</span><span class=\"p\">)[</span><span
      class=\"mi\">0</span><span class=\"p\">]</span>\n\n      <span class=\"k\">let</span>
      <span class=\"nv\">data</span> <span class=\"o\">=</span> <span class=\"kt\">AssetData</span><span
      class=\"p\">(</span>\n        <span class=\"nv\">localIdentifier</span><span
      class=\"p\">:</span> <span class=\"n\">asset</span><span class=\"o\">.</span><span
      class=\"n\">localIdentifier</span><span class=\"p\">,</span>\n        <span
      class=\"nv\">originalFilename</span><span class=\"p\">:</span> <span class=\"n\">resource</span><span
      class=\"o\">.</span><span class=\"n\">originalFilename</span><span class=\"p\">,</span>\n
      \       <span class=\"nv\">fileSize</span><span class=\"p\">:</span> <span class=\"n\">resource</span><span
      class=\"o\">.</span><span class=\"nf\">value</span><span class=\"p\">(</span><span
      class=\"nv\">forKey</span><span class=\"p\">:</span> <span class=\"s\">\"fileSize\"</span><span
      class=\"p\">)</span> <span class=\"k\">as!</span> <span class=\"kt\">Int64</span>\n
      \     <span class=\"p\">)</span>\n\n      <span class=\"n\">allAssets</span><span
      class=\"o\">.</span><span class=\"nf\">append</span><span class=\"p\">(</span><span
      class=\"n\">data</span><span class=\"p\">)</span>\n    <span class=\"p\">})</span>\n\n
      \ <span class=\"n\">allAssets</span><span class=\"o\">.</span><span class=\"n\">sort</span>
      <span class=\"p\">{</span> <span class=\"nv\">$0</span><span class=\"o\">.</span><span
      class=\"n\">fileSize</span> <span class=\"o\">&gt;</span> <span class=\"nv\">$1</span><span
      class=\"o\">.</span><span class=\"n\">fileSize</span> <span class=\"p\">}</span>\n\n
      \ <span class=\"k\">return</span> <span class=\"n\">allAssets</span>\n<span
      class=\"p\">}</span>\n\n<span class=\"c1\">/// Quick extension to allow left-padding
      a string in Swift</span>\n<span class=\"c1\">///</span>\n<span class=\"c1\">///
      By user2878850 on Stack Overflow:</span>\n<span class=\"c1\">/// https://stackoverflow.com/a/69859859/1558022</span>\n<span
      class=\"kd\">extension</span> <span class=\"kt\">String</span> <span class=\"p\">{</span>\n
      \ <span class=\"kd\">func</span> <span class=\"nf\">leftPadding</span><span
      class=\"p\">(</span><span class=\"nv\">toLength</span><span class=\"p\">:</span>
      <span class=\"kt\">Int</span><span class=\"p\">,</span> <span class=\"nv\">withPad</span><span
      class=\"p\">:</span> <span class=\"kt\">String</span><span class=\"p\">)</span>
      <span class=\"o\">-&gt;</span> <span class=\"kt\">String</span> <span class=\"p\">{</span>\n
      \   <span class=\"kt\">String</span><span class=\"p\">(</span>\n      <span
      class=\"kt\">String</span><span class=\"p\">(</span><span class=\"nf\">reversed</span><span
      class=\"p\">())</span>\n        <span class=\"o\">.</span><span class=\"nf\">padding</span><span
      class=\"p\">(</span><span class=\"nv\">toLength</span><span class=\"p\">:</span>
      <span class=\"n\">toLength</span><span class=\"p\">,</span> <span class=\"nv\">withPad</span><span
      class=\"p\">:</span> <span class=\"n\">withPad</span><span class=\"p\">,</span>
      <span class=\"nv\">startingAt</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span
      class=\"p\">)</span>\n        <span class=\"o\">.</span><span class=\"nf\">reversed</span><span
      class=\"p\">()</span>\n    <span class=\"p\">)</span>\n  <span class=\"p\">}</span>\n<span
      class=\"p\">}</span>\n\n<span class=\"k\">let</span> <span class=\"nv\">bcf</span>
      <span class=\"o\">=</span> <span class=\"kt\">ByteCountFormatter</span><span
      class=\"p\">()</span>\n\n<span class=\"k\">for</span> <span class=\"n\">photo</span>
      <span class=\"k\">in</span> <span class=\"nf\">getAssetsBySize</span><span class=\"p\">()</span>
      <span class=\"p\">{</span>\n  <span class=\"k\">let</span> <span class=\"nv\">size</span>
      <span class=\"o\">=</span>\n    <span class=\"n\">bcf</span>\n      <span class=\"o\">.</span><span
      class=\"nf\">string</span><span class=\"p\">(</span><span class=\"nv\">fromByteCount</span><span
      class=\"p\">:</span> <span class=\"n\">photo</span><span class=\"o\">.</span><span
      class=\"n\">fileSize</span><span class=\"p\">)</span>\n      <span class=\"o\">.</span><span
      class=\"nf\">leftPadding</span><span class=\"p\">(</span><span class=\"nv\">toLength</span><span
      class=\"p\">:</span> <span class=\"mi\">8</span><span class=\"p\">,</span> <span
      class=\"nv\">withPad</span><span class=\"p\">:</span> <span class=\"s\">\" \"</span><span
      class=\"p\">)</span>\n  <span class=\"nf\">print</span><span class=\"p\">(</span><span
      class=\"s\">\"</span><span class=\"se\">\\(</span><span class=\"n\">size</span><span
      class=\"se\">)</span><span class=\"s\">  </span><span class=\"se\">\\(</span><span
      class=\"n\">photo</span><span class=\"o\">.</span><span class=\"n\">originalFilename</span><span
      class=\"se\">)</span><span class=\"s\">\"</span><span class=\"p\">)</span>\n<span
      class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>When I run the script,
      I combine it with <a href=\"https://en.wikipedia.org/wiki/Head_(Unix)\"><code
      class=\"language-plaintext highlighter-rouge\">head</code></a> to get a list
      of the top N files:</p>\n\n<div class=\"language-console highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">$</span><span
      class=\"w\"> </span>swift get_photo_sizes.swift | <span class=\"nb\">head</span>
      <span class=\"nt\">-n</span> 5\n<span class=\"go\">   578 MB  IMG_3607.MOV\n
      518.5 MB  IMG_0794.MOV\n 494.1 MB  IMG_9858.MOV\n 373.6 MB  IMG_1933.MOV\n 372.5
      MB  IMG_3751.MOV\n</span></code></pre></div></div>\n\n<p>In my library of 26k\_items,
      the script takes about about a minute or so to run.</p>\n\n<p>I went through
      the first 50 or so items, one-by-one.\nI moved about 30 videos out of my photos
      library and on to an external disk, and I deleted a few more \u2013 in total
      I recovered about 7GB of space.\nIt\u2019s not a lot, but it gives me some more
      breathing room.</p>\n\n<p>Pretty much all these files were video messages I\u2019d
      made for friends and family, and sent as soon as they were recorded.\nHonestly,
      I think it\u2019s unlikely I\u2019ll ever watch these again \u2013 I\u2019m
      keeping them just-in-case, but I definitely don\u2019t need them in my synced-everywhere
      photo library.</p>\n\n<p>I don\u2019t know if I\u2019ll use this exact script
      again, but it was a good opportunity to practice using Swift and PhotoKit.\nI\u2019m
      gradually building a little collection of scripts and tools I can use to do
      stuff with photos, and this is another pebble on that pile.</p>\n\n\n    <p>[If
      the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/finding-big-photos/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"photo-management\"/>\n
      \   <category term=\"swift\"/>\n    <summary type=\"html\">A quick script to
      help move the biggest items out of my main Photos Library.</summary>\n  </entry>\n
      \ <entry>\n    <title type=\"html\">Spotting spam in our CloudFront logs</title>\n
      \   <link href=\"https://alexwlchan.net/2023/spotting-spam-in-our-cloudfront-logs/\"
      rel=\"alternate\" type=\"text/html\" title=\"Spotting spam in our CloudFront
      logs\"/>\n    <published>2023-09-28T01:21:05+00:00</published>\n    <updated>2023-09-28T01:21:05+00:00</updated>\n
      \   <id>https://alexwlchan.net/2023/spotting-spam-in-our-cloudfront-logs</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/spotting-spam-in-our-cloudfront-logs/\"><![CDATA[\n<p>About
      two months ago, I wrote about some <a href=\"/2023/cloudfront-logs/\">Python
      code I\u2019d written to parse CloudFront logs</a>.\nI wrote this code to help
      with analysing some searches on wellcomecollection.org, and I thought it would
      be useful to explain a bit more of what I was doing.</p>\n\n<p>There\u2019s
      a lot of spam in the catalogue search.\nSomebody types in a search query which
      can\u2019t possibly return any results \u2013 instead it\u2019s a message (often
      not in English) promoting sketchy-sounding services and domains.\nCall me sceptical,
      but I don\u2019t think somebody who types in:</p>\n\n<div class=\"language-plaintext
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>escort
      girls in your area play free casino games \u2714\uFE0F with chatgpt \u23E9 whatsapp
      scamalot.xyz\n</code></pre></div></div>\n\n<p>is actually looking for catalogue
      results in a library/museum website.</p>\n\n<p>I don\u2019t know why people
      set up bots to do this \u2013 but whatever the reason, dealing with this sort
      of spam is an inevitable part of running a website on the public Internet.</p>\n\n<p>Before
      I started this work, we were sending all these spam queries to our back-end
      search API and Elasticsearch cluster.\nOver time, the load from the spam was
      starting to add up, and starting to crowd out real queries on our cluster.</p>\n\n<p>We
      wanted to find a way to identify the spam, so we could return a \u201Cno results
      page\u201D ASAP, without actually sending the query to our Elasticsearch cluster.\nIt
      was usually \u201Cobvious\u201D if you read the queries as a human, but how
      could we teach the computer to make the same distinction?</p>\n\n<hr>\n\n<p>I
      started by using the code from my last post to get all the CloudFront logs for
      our catalogue search:</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span>
      <span class=\"n\">datetime</span>\n<span class=\"kn\">import</span> <span class=\"n\">json</span>\n\n\n<span
      class=\"k\">class</span> <span class=\"nc\">DatetimeEncoder</span><span class=\"p\">(</span><span
      class=\"n\">json</span><span class=\"p\">.</span><span class=\"n\">JSONEncoder</span><span
      class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">default</span><span
      class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span>
      <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span>
      <span class=\"nf\">isinstance</span><span class=\"p\">(</span><span class=\"n\">obj</span><span
      class=\"p\">,</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span
      class=\"n\">datetime</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span>
      <span class=\"n\">obj</span><span class=\"p\">.</span><span class=\"nf\">isoformat</span><span
      class=\"p\">()</span>\n\n\n<span class=\"n\">log_entries</span> <span class=\"o\">=</span>
      <span class=\"nf\">get_cloudfront_logs_from_s3</span><span class=\"p\">(</span>\n
      \   <span class=\"n\">sess</span><span class=\"p\">,</span>\n    <span class=\"n\">Bucket</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">wellcomecollection-experience-cloudfront-logs</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"n\">Prefix</span><span
      class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">wellcomecollection.org/prod/</span><span
      class=\"sh\">\"</span>\n<span class=\"p\">)</span>\n\n<span class=\"k\">with</span>
      <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">search_log_entries.json</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">w</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span>
      <span class=\"n\">out_file</span><span class=\"p\">:</span>\n    <span class=\"k\">for</span>
      <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">log_entries</span><span
      class=\"p\">:</span>\n        <span class=\"k\">if</span> <span class=\"n\">entry</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">cs-uri-stem</span><span
      class=\"sh\">\"</span><span class=\"p\">].</span><span class=\"nf\">startswith</span><span
      class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">/search</span><span
      class=\"sh\">\"</span><span class=\"p\">):</span>\n            <span class=\"n\">out_file</span><span
      class=\"p\">.</span><span class=\"nf\">write</span><span class=\"p\">(</span><span
      class=\"n\">json</span><span class=\"p\">.</span><span class=\"nf\">dumps</span><span
      class=\"p\">(</span><span class=\"n\">entry</span><span class=\"p\">,</span>
      <span class=\"n\">cls</span><span class=\"o\">=</span><span class=\"n\">DatetimeEncoder</span><span
      class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"sh\">\"</span><span
      class=\"se\">\\n</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>That
      gave me about 7\_million log entries that I could analyse.\nThen I started developing
      my spam heuristic, which had a single Python function as its interface:</p>\n\n<div
      class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"k\">def</span> <span class=\"nf\">is_spam</span><span class=\"p\">(</span><span
      class=\"n\">log_entry</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span>
      <span class=\"nb\">bool</span><span class=\"p\">:</span>\n    <span class=\"k\">return</span>
      <span class=\"bp\">False</span>\n</code></pre></div></div>\n\n<p>To develop
      the heuristic, I wrote a bunch of versions of this function, trying various
      techniques to look at different fields in the log entry and decide if a particular
      request was spam.\nTo help me evaluate the different versions, I wrote a test
      script I could run repeatedly as I tweaked the function:</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"kn\">import</span> <span class=\"n\">random</span>\n<span class=\"kn\">import</span>
      <span class=\"n\">time</span>\n\n<span class=\"kn\">import</span> <span class=\"n\">humanize</span>\n<span
      class=\"kn\">import</span> <span class=\"n\">termcolor</span>\n\n\n<span class=\"n\">spam</span>
      <span class=\"o\">=</span> <span class=\"p\">[]</span>\n<span class=\"n\">legit</span>
      <span class=\"o\">=</span> <span class=\"p\">[]</span>\n\n<span class=\"c1\">#
      Get all the log entries\n#\n# This will load them into a single list, which
      uses a lot of memory.\n# It is possible to do this in a more memory-efficient
      way using a\n# generator, but I had memory to spare and I didn't want\n</span><span
      class=\"n\">log_entries</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span
      class=\"n\">json</span><span class=\"p\">.</span><span class=\"nf\">loads</span><span
      class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">)</span>
      <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span>
      <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">log_entries.json</span><span class=\"sh\">\"</span><span class=\"p\">)]</span>\n\n<span
      class=\"c1\"># Go through all the log entries and classify them as spam/not
      spam\n</span><span class=\"n\">time_start</span> <span class=\"o\">=</span>
      <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span
      class=\"p\">()</span>\n\n<span class=\"k\">for</span> <span class=\"n\">log_entry</span>
      <span class=\"ow\">in</span> <span class=\"n\">log_entries</span><span class=\"p\">:</span>\n
      \   <span class=\"k\">if</span> <span class=\"nf\">is_spam</span><span class=\"p\">(</span><span
      class=\"n\">log_entry</span><span class=\"p\">):</span>\n        <span class=\"n\">spam</span><span
      class=\"p\">.</span><span class=\"nf\">append</span><span class=\"p\">(</span><span
      class=\"n\">log_entry</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span
      class=\"p\">:</span>\n        <span class=\"n\">legit</span><span class=\"p\">.</span><span
      class=\"nf\">append</span><span class=\"p\">(</span><span class=\"n\">log_entry</span><span
      class=\"p\">)</span>\n\n<span class=\"n\">time_end</span> <span class=\"o\">=</span>
      <span class=\"n\">time</span><span class=\"p\">.</span><span class=\"nf\">time</span><span
      class=\"p\">()</span>\n\n<span class=\"c1\"># Print a brief summary of the results\n</span><span
      class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span
      class=\"sh\">\"</span><span class=\"s\">Rejected = </span><span class=\"si\">{</span><span
      class=\"n\">humanize</span><span class=\"p\">.</span><span class=\"nf\">intcomma</span><span
      class=\"p\">(</span><span class=\"nf\">len</span><span class=\"p\">(</span><span
      class=\"n\">spam</span><span class=\"p\">))</span><span class=\"si\">}</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span
      class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span
      class=\"s\">Allowed  = </span><span class=\"si\">{</span><span class=\"n\">humanize</span><span
      class=\"p\">.</span><span class=\"nf\">intcomma</span><span class=\"p\">(</span><span
      class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">legit</span><span
      class=\"p\">))</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span
      class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">         =
      </span><span class=\"si\">{</span><span class=\"nf\">len</span><span class=\"p\">(</span><span
      class=\"n\">spam</span><span class=\"p\">)</span> <span class=\"o\">/</span>
      <span class=\"p\">(</span><span class=\"nf\">len</span><span class=\"p\">(</span><span
      class=\"n\">spam</span><span class=\"p\">)</span> <span class=\"o\">+</span>
      <span class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">legit</span><span
      class=\"p\">))</span> <span class=\"o\">*</span> <span class=\"mi\">100</span><span
      class=\"si\">:</span><span class=\"p\">.</span><span class=\"mi\">2</span><span
      class=\"n\">f</span><span class=\"si\">}</span><span class=\"s\">% marked as
      spam</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"n\">elapsed</span>
      <span class=\"o\">=</span> <span class=\"n\">time_end</span> <span class=\"o\">-</span>
      <span class=\"n\">time_start</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span
      class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Per req  =
      ~</span><span class=\"si\">{</span><span class=\"n\">elapsed</span> <span class=\"o\">/</span>
      <span class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">queries</span><span
      class=\"p\">)</span><span class=\"si\">}</span><span class=\"s\">s</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Print
      a sample of the log entries marked as spam/not spam, to give\n# me something
      to evaluate.\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">---</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span>\n\n<span class=\"k\">for</span> <span class=\"n\">log_entry</span>
      <span class=\"ow\">in</span> <span class=\"n\">random</span><span class=\"p\">.</span><span
      class=\"nf\">sample</span><span class=\"p\">(</span><span class=\"n\">spam</span><span
      class=\"p\">,</span> <span class=\"n\">k</span><span class=\"o\">=</span><span
      class=\"nf\">min</span><span class=\"p\">(</span><span class=\"mi\">100</span><span
      class=\"p\">,</span> <span class=\"nf\">len</span><span class=\"p\">(</span><span
      class=\"n\">spam</span><span class=\"p\">))):</span>\n    <span class=\"nf\">print</span><span
      class=\"p\">(</span><span class=\"n\">termcolor</span><span class=\"p\">.</span><span
      class=\"nf\">colored</span><span class=\"p\">(</span><span class=\"n\">log_entry</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">cs-uri-query</span><span
      class=\"sh\">\"</span><span class=\"p\">],</span> <span class=\"sh\">\"</span><span
      class=\"s\">red</span><span class=\"sh\">\"</span><span class=\"p\">))</span>\n\n<span
      class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">---</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span
      class=\"k\">for</span> <span class=\"n\">log_entry</span> <span class=\"ow\">in</span>
      <span class=\"n\">random</span><span class=\"p\">.</span><span class=\"nf\">sample</span><span
      class=\"p\">(</span><span class=\"n\">legit</span><span class=\"p\">,</span>
      <span class=\"n\">k</span><span class=\"o\">=</span><span class=\"mi\">100</span><span
      class=\"p\">):</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span
      class=\"n\">termcolor</span><span class=\"p\">.</span><span class=\"nf\">colored</span><span
      class=\"p\">(</span><span class=\"n\">log_entry</span><span class=\"p\">[</span><span
      class=\"sh\">\"</span><span class=\"s\">cs-uri-query</span><span class=\"sh\">\"</span><span
      class=\"p\">],</span> <span class=\"sh\">\"</span><span class=\"s\">green</span><span
      class=\"sh\">\"</span><span class=\"p\">))</span>\n</code></pre></div></div>\n\n<p>The
      output gives me a summary with a few statistics:</p>\n\n<div class=\"language-plaintext
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Rejected
      = 5,136,696\nAllowed  = 1,805,073\n         = 74.00% marked as spam\nPer req
      \ = ~1.4436019812105793e-05s\n</code></pre></div></div>\n\n<p>The proportion
      of rejected traffic is so I can see whether my proposed heuristic is actually
      making a difference to the volume of requests.\nThe per request time is for
      measuring performance; I didn\u2019t want to introduce noticeable latency for
      legitimate users.</p>\n\n<p>It also prints a random sample of the queries marked
      as legitimate and spam.\nThis gave me a spot check on the heuristic \u2013 I
      could see if legitimate queries were being rejected, or if I wanted to add another
      rule for matching spam.</p>\n\n<p>Repeatedly re-running this test harness gave
      me a workflow for developing my spam detection heuristic: I\u2019d tweak my
      function, re-run, and see how it affected the results.\nI kept iterating until
      I was catching a decent proportion of spam, without penalising real users.</p>\n\n<hr>\n\n<p>Most
      of my analysis focused on the search query, and there were several patterns
      I spotted which seemed to be strong indicators of spam:</p>\n\n<ul>\n  <li>\n
      \   <p>Certain keywords like <code class=\"language-plaintext highlighter-rouge\">chatgpt</code>,
      <code class=\"language-plaintext highlighter-rouge\">casino</code> and <code
      class=\"language-plaintext highlighter-rouge\">crypto</code>.</p>\n\n    <p>This
      was my first idea, because it was pretty obvious in the queries I was reading,
      but it was dropped from the final heuristic for two reasons.\nIt only dropped
      a fairly small amount of traffic (~2%) and it was hard to agree on a list of
      words that were definitely spam.</p>\n  </li>\n  <li>\n    <p>Emoji, of which
      \u23E9, \u2714\uFE0F, \u3299\uFE0F were particularly common examples.\nThere\u2019s
      no emoji in our catalogue data so it\u2019s unlikely a real person would search
      for it (and they won\u2019t find anything if they do!).</p>\n  </li>\n  <li>\n
      \   <p>Long, all-Chinese queries.\nThere is some Chinese in the catalogue, but
      it\u2019s a tiny proportion \u2013  the vast majority of our data is in English.</p>\n
      \ </li>\n  <li>\n    <p>Mangled character encodings, aka <a href=\"https://en.wikipedia.org/wiki/Mojibake\">Mojibake</a>.\nNot
      all of the non-English text was encoded properly, and there were a lot of queries
      like <code class=\"language-plaintext highlighter-rouge\">\xE2\\x8f\xA9\xE2\\x9c\\x94\xEF\\x8f\xE3\\x8a</code>.\nI
      don\u2019t think a real person would ever type this in, but a poorly coded spam
      bot quite likely.</p>\n  </li>\n</ul>\n\n<p>As I was going, I did tally some
      other fields in the logs I\u2019d marked as spam, to see if I could spot any
      other patterns I could use for spam detection \u2013 for example, I counted
      IP\_addresses to see if all the spam was coming from a single IP\_address that
      we could just block.</p>\n\n<div class=\"language-python highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"kn\">import</span>
      <span class=\"n\">collections</span>\n\n<span class=\"n\">spam_ips</span> <span
      class=\"o\">=</span> <span class=\"n\">collections</span><span class=\"p\">.</span><span
      class=\"nc\">Counter</span><span class=\"p\">(</span><span class=\"n\">log_entry</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">c-ip</span><span
      class=\"sh\">\"</span><span class=\"p\">]</span> <span class=\"k\">for</span>
      <span class=\"n\">log_entry</span> <span class=\"ow\">in</span> <span class=\"n\">spam</span><span
      class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>Unfortunately I didn\u2019t
      find any good patterns this way, so I stuck to the query-based analysis.</p>\n\n<hr>\n\n<p>For
      the first version of our spam detection, I settled on this heuristic:</p>\n\n<blockquote>\n
      \ <p><em>Reject queries with more than 25\_characters from character ranges
      which are rarely used in our catalogue data (Chinese, Korean, Mojibake, emoji)</em></p>\n</blockquote>\n\n<p>Later
      we reduced that threshold to 20, and so far it seems to have worked well.\nYou
      can see <a href=\"https://github.com/wellcomecollection/wellcomecollection.org/blob/509ef612b7a0ff4003f358ab2c637c544c0c870b/content/webapp/utils/spam-detector.ts#L94\">the
      implementation</a> and <a href=\"https://github.com/wellcomecollection/wellcomecollection.org/blob/509ef612b7a0ff4003f358ab2c637c544c0c870b/content/webapp/utils/spam-detector.test.ts\">the
      associated tests</a> on GitHub.</p>\n\n<p>If your query is marked as spam, we
      now show the \u201Cno results\u201D page immediately in our frontend web app,
      rather than sending your search to our backend Elasticsearch cluster.\nAs part
      of this change, we tweaked the copy on our \u201Cno results\u201D page, asking
      people to email us if their search unexpectedly returned no results:</p>\n\n<picture>\n
      \ <source srcset=\"/images/2023/weco_no_results.dark_1x.avif 750w, /images/2023/weco_no_results.dark_2x.avif
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n<source srcset=\"/images/2023/weco_no_results.dark_1x.webp
      750w, /images/2023/weco_no_results.dark_2x.webp 1500w\" sizes=\"(max-width:
      750px) 100vw, 750px\" type=\"image/webp\" media=\"(prefers-color-scheme: dark)\"></source>\n\n<source
      srcset=\"/images/2023/weco_no_results.dark_1x.png 750w, /images/2023/weco_no_results.dark_2x.png
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/png\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n\n  <source srcset=\"/images/2023/weco_no_results_1x.avif
      750w, /images/2023/weco_no_results_2x.avif 1500w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2023/weco_no_results_1x.webp
      750w, /images/2023/weco_no_results_2x.webp 1500w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/weco_no_results_1x.png
      750w, /images/2023/weco_no_results_2x.png 1500w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2023/weco_no_results_1x.png\"
      alt=\"Screenshot of a search page with no results. \u201CWe couldn\u2019t find
      anything that matched \xE2\\x8f\xA9\xE2\\x9c\\x94\xEF\\x8f\xE3\\x8a. Please
      adjust your search terms and try again. If you think this search should show
      some results, please email digital@wellcomecollection.org.\u201D\" width=\"750\"
      class=\"dark_aware\">\n</picture>\n\n<p>This was a hedge against mistakes in
      the spam heuristic \u2013 if it somehow got a false positive and binned a query
      from a real user who should have seen results, we\u2019d hear about it.\nIn
      practice, I don\u2019t think there\u2019s been a single one.\nWe\u2019ve managed
      to cut the load on our Elasticsearch cluster, without impacting real users.</p>\n\n<p>I\u2019m
      almost certain our spam is automated bots rather than targeted spam, which is
      why I can safely publish this analysis.\nNobody is going to read this and adapt
      their spam attack to counter it, but maybe it\u2019ll be useful if you have
      to analyse a spam problem of your own.</p>\n\n\n    <p>[If the formatting of
      this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/spotting-spam-in-our-cloudfront-logs/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"python\"/>\n
      \   <category term=\"amazon-cloudfront\"/>\n    <summary type=\"html\">Looking
      for search queries that came from robots, not real people.</summary>\n  </entry>\n
      \ <entry>\n    <title type=\"html\">Adding locations to my photos from my Apple
      Watch workouts</title>\n    <link href=\"https://alexwlchan.net/2023/adding-watch-locations/\"
      rel=\"alternate\" type=\"text/html\" title=\"Adding locations to my photos from
      my Apple Watch workouts\"/>\n    <published>2023-09-24T16:31:02+00:00</published>\n
      \   <updated>2023-09-24T16:31:02+00:00</updated>\n    <id>https://alexwlchan.net/2023/adding-watch-locations</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/adding-watch-locations/\"><![CDATA[\n<p>A
      week or so ago, I was hiking around <a href=\"https://en.wikipedia.org/wiki/Lake_Bohinj\">Lake
      Bohinj</a>, a gorgeous Alpine lake in northwest Slovenia.\nIt\u2019s a very
      photogenic landscape, so I was taking some pictures with my \u201Cnice\u201D
      camera.\nIt\u2019s an Olympus that takes better photos than my iPhone, but it\u2019s
      quite old and it doesn\u2019t have built-in GPS \u2013 so none of the photos
      have <a href=\"https://en.wikipedia.org/wiki/Geotagging\">location geotags</a>.</p>\n\n<p>I
      find location data quite useful on my photos, and I was wondering if I could
      add it after the fact.\nAlthough my camera doesn\u2019t know where I was, I
      had a walking workout running on my Apple Watch, and that was tracking my location
      \u2013 could I combine the photos from my camera and the location data from
      my watch?</p>\n\n<hr>\n\n<picture>\n  \n  <source srcset=\"/images/2023/confused-camera_1x.avif
      750w, /images/2023/confused-camera_2x.avif 1500w, /images/2023/confused-camera_3x.avif
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/confused-camera_1x.webp 750w, /images/2023/confused-camera_2x.webp
      1500w, /images/2023/confused-camera_3x.webp 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/confused-camera_1x.jpg
      750w, /images/2023/confused-camera_2x.jpg 1500w, /images/2023/confused-camera_3x.jpg
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/confused-camera_1x.jpg\" class=\"full_width\" alt=\"A
      black Olympus character looking out of a window, with a cartoon thought bubble
      showing a location pin and a question mark. It\u2019s wondering what GPS and
      locations are.\" width=\"750\">\n</picture>\n\n<p>The first step was to get
      all the data from my walking workout.\nI was able to export the data from the
      Health app on my iPhone, following the <a href=\"https://support.apple.com/en-gb/guide/iphone/iph5ede58c3d/ios#iphe962dcbd2\">instructions
      in an Apple Support document</a>:</p>\n\n<blockquote>\n  <p>You can export all
      of your health and fitness data from Health in XML format, which is a common
      format for sharing data between apps.</p>\n\n  <ol>\n    <li>\n      <p>Tap
      your picture or initials at the top right.</p>\n\n      <p>If you don\u2019t
      see your picture or initials, tap Summary or Browse at the bottom of the screen,
      then scroll to the top of the screen.</p>\n    </li>\n    <li>\n      <p>Tap
      Export All Health Data, then choose a method for sharing your data.</p>\n    </li>\n
      \ </ol>\n</blockquote>\n\n<p>When I tried this, my iPhone said it would take
      \u201Ca few moments\u201D.\nIt took much longer than that, and the lack of progress
      bar made me wonder if it was broken.</p>\n\n<p>But it did eventually finish,
      and fifteen minutes later, I had a 174MB ZIP file full of my health data.\nWhen
      I unzipped it, this is what it looked like inside:</p>\n\n<div class=\"language-plaintext
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>apple_health_export/\n
      \ \u251C\u2500 export.xml\n  \u251C\u2500 export_cda.xml\n  \u251C\u2500 electrocardiograms/\n
      \ \u2502    \u251C\u2500 ecg_2020-12-27.csv\n  \u2502    \u2514\u2500 ...10
      other files\n  \u2514\u2500 workout-routes/\n       \u251C\u2500 route_2020-12-26_1.47pm.gpx\n
      \      \u251C\u2500 route_2020-12-27_1.04pm.gpx\n       \u2514\u2500 ...1556
      other files\n</code></pre></div></div>\n\n<p>The GPX files are the interesting
      thing here \u2013 GPX is <a href=\"https://en.wikipedia.org/wiki/GPS_Exchange_Format\">a
      standard format</a> for passing around GPS data.\nIf I preview one of those
      files in Quick Look, I can see my walking route shown as a thick green line
      on a map:</p>\n\n<picture>\n  <source srcset=\"/images/2023/bohinj_gpx.dark_1x.avif
      750w, /images/2023/bohinj_gpx.dark_2x.avif 1500w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/avif\" media=\"(prefers-color-scheme: dark)\"></source>\n\n<source
      srcset=\"/images/2023/bohinj_gpx.dark_1x.webp 750w, /images/2023/bohinj_gpx.dark_2x.webp
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n<source srcset=\"/images/2023/bohinj_gpx.dark_1x.png 750w,
      /images/2023/bohinj_gpx.dark_2x.png 1500w\" sizes=\"(max-width: 750px) 100vw,
      750px\" type=\"image/png\" media=\"(prefers-color-scheme: dark)\"></source>\n\n\n
      \ <source srcset=\"/images/2023/bohinj_gpx_1x.avif 750w, /images/2023/bohinj_gpx_2x.avif
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/bohinj_gpx_1x.webp 750w, /images/2023/bohinj_gpx_2x.webp
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/bohinj_gpx_1x.png 750w, /images/2023/bohinj_gpx_2x.png
      1500w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2023/bohinj_gpx_1x.png\" alt=\"An outline map of mostly
      green countryside with a blue lake (Bohinjsko jezero) in the middle. There's
      a thick green line that goes around the lake, showing my walking route.\" width=\"750\"
      class=\"dark_aware\">\n</picture>\n\n<p>GPX files are XML, and the format of
      the Apple Health workout routes isn\u2019t especially complicated.\nHere\u2019s
      the first few lines of a file:</p>\n\n<div class=\"language-xml highlighter-rouge\"><div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"cp\">&lt;?xml
      version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>\n<span class=\"nt\">&lt;gpx</span>\n
      \ <span class=\"na\">version=</span><span class=\"s\">\"1.1\"</span>\n  <span
      class=\"na\">creator=</span><span class=\"s\">\"Apple Health Export\"</span>\n
      \ <span class=\"na\">xmlns=</span><span class=\"s\">\"http://www.topografix.com/GPX/1/1\"</span>\n
      \ <span class=\"na\">xmlns:xsi=</span><span class=\"s\">\"http://www.w3.org/2001/XMLSchema-instance\"</span>\n
      \ <span class=\"na\">xsi:schemaLocation=</span><span class=\"s\">\"http://www.topografix.com/GPX/1/1
      http://www.topografix.com/GPX/1/1/gpx.xsd\"</span>\n<span class=\"nt\">&gt;</span>\n
      \ <span class=\"nt\">&lt;metadata&gt;</span>\n    <span class=\"nt\">&lt;time&gt;</span>2023-09-19T21:04:33Z<span
      class=\"nt\">&lt;/time&gt;</span>\n  <span class=\"nt\">&lt;/metadata&gt;</span>\n
      \ <span class=\"nt\">&lt;trk&gt;</span>\n    <span class=\"nt\">&lt;name&gt;</span>Route
      2023-09-17 2:38pm<span class=\"nt\">&lt;/name&gt;</span>\n    <span class=\"nt\">&lt;trkseg&gt;</span>\n
      \     <span class=\"nt\">&lt;trkpt</span> <span class=\"na\">lon=</span><span
      class=\"s\">\"13.887391\"</span> <span class=\"na\">lat=</span><span class=\"s\">\"46.277433\"</span><span
      class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;ele&gt;</span>532.367857<span
      class=\"nt\">&lt;/ele&gt;</span>\n        <span class=\"nt\">&lt;time&gt;</span>2023-09-17T07:05:52Z<span
      class=\"nt\">&lt;/time&gt;</span>\n        <span class=\"nt\">&lt;extensions&gt;</span>\n
      \         <span class=\"nt\">&lt;speed&gt;</span>1.400002<span class=\"nt\">&lt;/speed&gt;</span>\n
      \         <span class=\"nt\">&lt;course&gt;</span>287.656214<span class=\"nt\">&lt;/course&gt;</span>\n
      \         <span class=\"nt\">&lt;hAcc&gt;</span>2.032849<span class=\"nt\">&lt;/hAcc&gt;</span>\n
      \         <span class=\"nt\">&lt;vAcc&gt;</span>1.793892<span class=\"nt\">&lt;/vAcc&gt;</span>\n
      \       <span class=\"nt\">&lt;/extensions&gt;</span>\n      <span class=\"nt\">&lt;/trkpt&gt;</span>\n
      \     <span class=\"nt\">&lt;trkpt</span> <span class=\"na\">lon=</span><span
      class=\"s\">\"13.887373\"</span> <span class=\"na\">lat=</span><span class=\"s\">\"46.277437\"</span><span
      class=\"nt\">&gt;</span>\n        <span class=\"nt\">&lt;ele&gt;</span>532.469812<span
      class=\"nt\">&lt;/ele&gt;</span>\n        <span class=\"nt\">&lt;time&gt;</span>2023-09-17T07:05:53Z<span
      class=\"nt\">&lt;/time&gt;</span>\n        <span class=\"nt\">&lt;extensions&gt;</span>\n
      \         <span class=\"nt\">&lt;speed&gt;</span>1.398853<span class=\"nt\">&lt;/speed&gt;</span>\n
      \         <span class=\"nt\">&lt;course&gt;</span>283.005353<span class=\"nt\">&lt;/course&gt;</span>\n
      \         <span class=\"nt\">&lt;hAcc&gt;</span>1.821742<span class=\"nt\">&lt;/hAcc&gt;</span>\n
      \         <span class=\"nt\">&lt;vAcc&gt;</span>1.615372<span class=\"nt\">&lt;/vAcc&gt;</span>\n
      \       <span class=\"nt\">&lt;/extensions&gt;</span>\n      <span class=\"nt\">&lt;/trkpt&gt;</span>\n
      \     \u2026\n</code></pre></div></div>\n\n<p>The file is a series of <code
      class=\"language-plaintext highlighter-rouge\">trkpt</code> (\u201Ctrack points\u201D),
      each of which has a longitude, a latitude, an elevation and a timestamp.\nThe
      timestamps are in UTC \u2013 the first timestamp is just after 7am, but I didn\u2019t
      arrive at Bohinj until just after 9am.\nLike the rest of Slovenia, Bohinj is
      currently on UTC+2.</p>\n\n<p>There are also a couple of data points which I
      think are something related to direction and speed?\nI\u2019m not looking into
      those, but it was interesting to see they\u2019re in there.\nI don\u2019t think
      I\u2019ve worked with GPS data before, and there\u2019s a bit more than I expected
      \u2013 I thought I\u2019d just be getting longitude and latitude coordinates,
      but these extra values make sense, particular when I\u2019m walking.</p>\n\n<p>I
      used <a href=\"https://lxml.de/index.html\">lxml</a> to write a Python function
      which extracts all these track points from the file.\nThere are dedicated libraries
      for dealing with GPX files, but I already know how to use lxml and it was simple
      enough to write something for this one-off task.</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"kn\">import</span> <span class=\"n\">datetime</span>\n\n<span class=\"kn\">from</span>
      <span class=\"n\">lxml</span> <span class=\"kn\">import</span> <span class=\"n\">etree</span>\n<span
      class=\"kn\">import</span> <span class=\"n\">pytz</span>\n\n\n<span class=\"n\">utc</span>
      <span class=\"o\">=</span> <span class=\"n\">pytz</span><span class=\"p\">.</span><span
      class=\"nf\">timezone</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">UTC</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n\n<span
      class=\"k\">def</span> <span class=\"nf\">get_track_points</span><span class=\"p\">(</span><span
      class=\"n\">tree</span><span class=\"p\">:</span> <span class=\"n\">etree</span><span
      class=\"p\">.</span><span class=\"n\">_ElementTree</span><span class=\"p\">):</span>\n
      \   <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Generate a series
      of track points from an Apple Health workout route.\n    </span><span class=\"sh\">\"\"\"</span>\n
      \   <span class=\"n\">namespaces</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span
      class=\"sh\">\"</span><span class=\"s\">gpx</span><span class=\"sh\">\"</span><span
      class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">http://www.topografix.com/GPX/1/1</span><span
      class=\"sh\">\"</span><span class=\"p\">}</span>\n\n    <span class=\"k\">for</span>
      <span class=\"n\">trkpt</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span
      class=\"p\">.</span><span class=\"nf\">xpath</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">//gpx:trkpt</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"n\">namespaces</span><span class=\"o\">=</span><span
      class=\"n\">namespaces</span><span class=\"p\">):</span>\n\n        <span class=\"c1\">#
      e.g. 2023-09-17T07:05:52Z\n</span>        <span class=\"n\">time_str</span>
      <span class=\"o\">=</span> <span class=\"n\">trkpt</span><span class=\"p\">.</span><span
      class=\"nf\">xpath</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">.//gpx:time</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"n\">namespaces</span><span class=\"o\">=</span><span class=\"n\">namespaces</span><span
      class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span
      class=\"n\">text</span>\n        <span class=\"n\">time</span> <span class=\"o\">=</span>
      <span class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"n\">datetime</span><span
      class=\"p\">.</span><span class=\"nf\">strptime</span><span class=\"p\">(</span><span
      class=\"n\">time_str</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span
      class=\"s\">%Y-%m-%dT%H:%M:%SZ</span><span class=\"sh\">\"</span><span class=\"p\">).</span><span
      class=\"nf\">astimezone</span><span class=\"p\">(</span><span class=\"n\">utc</span><span
      class=\"p\">)</span>\n\n        <span class=\"n\">elevation</span> <span class=\"o\">=</span>
      <span class=\"nf\">float</span><span class=\"p\">(</span><span class=\"n\">trkpt</span><span
      class=\"p\">.</span><span class=\"nf\">xpath</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">.//gpx:ele</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"n\">namespaces</span><span class=\"o\">=</span><span
      class=\"n\">namespaces</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span
      class=\"p\">].</span><span class=\"n\">text</span><span class=\"p\">)</span>\n\n
      \       <span class=\"n\">latitude</span> <span class=\"o\">=</span> <span class=\"nf\">float</span><span
      class=\"p\">(</span><span class=\"n\">trkpt</span><span class=\"p\">.</span><span
      class=\"n\">attrib</span><span class=\"p\">[</span><span class=\"sh\">\"</span><span
      class=\"s\">lat</span><span class=\"sh\">\"</span><span class=\"p\">])</span>\n
      \       <span class=\"n\">longitude</span> <span class=\"o\">=</span> <span
      class=\"nf\">float</span><span class=\"p\">(</span><span class=\"n\">trkpt</span><span
      class=\"p\">.</span><span class=\"n\">attrib</span><span class=\"p\">[</span><span
      class=\"sh\">\"</span><span class=\"s\">lon</span><span class=\"sh\">\"</span><span
      class=\"p\">])</span>\n\n        <span class=\"k\">yield</span> <span class=\"p\">{</span>\n
      \           <span class=\"sh\">\"</span><span class=\"s\">time</span><span class=\"sh\">\"</span><span
      class=\"p\">:</span> <span class=\"n\">time</span><span class=\"p\">,</span>\n
      \           <span class=\"sh\">\"</span><span class=\"s\">elevation</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">elevation</span><span
      class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">latitude</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">latitude</span><span
      class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">longitude</span><span
      class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">longitude</span>\n
      \       <span class=\"p\">}</span>\n\n\n<span class=\"k\">with</span> <span
      class=\"nf\">open</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span
      class=\"s\">route_2023-09-17_2.38pm.gpx</span><span class=\"sh\">\"</span><span
      class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">infile</span><span
      class=\"p\">:</span>\n    <span class=\"n\">tree</span> <span class=\"o\">=</span>
      <span class=\"n\">etree</span><span class=\"p\">.</span><span class=\"nf\">parse</span><span
      class=\"p\">(</span><span class=\"n\">infile</span><span class=\"p\">)</span>\n\n
      \   <span class=\"k\">for</span> <span class=\"n\">track_point</span> <span
      class=\"ow\">in</span> <span class=\"nf\">get_track_points</span><span class=\"p\">(</span><span
      class=\"n\">tree</span><span class=\"p\">):</span>\n        <span class=\"nf\">print</span><span
      class=\"p\">(</span><span class=\"n\">track_point</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>I
      pulled all these track points into a single Python dictionary, mapping time
      to location:</p>\n\n<div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre
      class=\"highlight\"><code><span class=\"k\">with</span> <span class=\"nf\">open</span><span
      class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">route_2023-09-17_2.38pm.gpx</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span>
      <span class=\"n\">infile</span><span class=\"p\">:</span>\n    <span class=\"n\">tree</span>
      <span class=\"o\">=</span> <span class=\"n\">etree</span><span class=\"p\">.</span><span
      class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">infile</span><span
      class=\"p\">)</span>\n\n    <span class=\"n\">locations</span> <span class=\"o\">=</span>
      <span class=\"p\">{</span>\n        <span class=\"n\">track_point</span><span
      class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">time</span><span
      class=\"sh\">\"</span><span class=\"p\">]:</span> <span class=\"n\">track_point</span>\n
      \       <span class=\"k\">for</span> <span class=\"n\">track_point</span> <span
      class=\"ow\">in</span> <span class=\"nf\">get_track_points</span><span class=\"p\">(</span><span
      class=\"n\">tree</span><span class=\"p\">)</span>\n    <span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>I
      discovered that there are some duplicate timestamps in the GPX file \u2013 although
      there\u2019s second-level precision, occasionally it would record two locations
      for the same time.\nThe two locations were pretty close, maybe a metre or so
      apart.\nFor this sort of casual photo analysis that\u2019s fine, but it might
      cause issues if you need more precision.</p>\n\n<p>Pulling them all into a dictionary
      means picking the last location that appeared in the file.\nThat\u2019s somewhat
      arbitrary, but I didn\u2019t want to spend too much time on this so I called
      it good.\nBecause they\u2019re so close together, either is fine for my purposes.</p>\n\n<p>To
      tie this all together, I wrote a bit more Python which would find all the JPEG
      files from my camera, get the timestamp of that photo, and use <code class=\"language-plaintext
      highlighter-rouge\">exiftool</code> to add location metadata if my workout had
      recorded a location at that precise timestamp:</p>\n\n<div class=\"language-python
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"kn\">import</span> <span class=\"n\">subprocess</span>\n\n\n<span class=\"k\">def</span>
      <span class=\"nf\">get_created_time</span><span class=\"p\">(</span><span class=\"n\">jpeg_path</span><span
      class=\"p\">,</span> <span class=\"o\">*</span><span class=\"p\">,</span> <span
      class=\"n\">camera_timezone</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span
      class=\"s\">\n    Returns the created time of a photo, according to ``exiftool``.\n
      \   </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"n\">created_time_str</span>
      <span class=\"o\">=</span> <span class=\"n\">subprocess</span><span class=\"p\">.</span><span
      class=\"nf\">check_output</span><span class=\"p\">([</span>\n        <span class=\"sh\">\"</span><span
      class=\"s\">exiftool</span><span class=\"sh\">\"</span><span class=\"p\">,</span>
      <span class=\"sh\">\"</span><span class=\"s\">-s3</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">-DateTimeOriginal</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">jpeg_path</span>\n
      \   <span class=\"p\">]).</span><span class=\"nf\">decode</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">ascii</span><span class=\"sh\">\"</span><span
      class=\"p\">).</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n\n
      \   <span class=\"c1\"># e.g. 2023:09:17 10:40:49\n</span>    <span class=\"n\">created_time</span>
      <span class=\"o\">=</span> <span class=\"n\">datetime</span><span class=\"p\">.</span><span
      class=\"n\">datetime</span><span class=\"p\">.</span><span class=\"nf\">strptime</span><span
      class=\"p\">(</span><span class=\"n\">created_time_str</span><span class=\"p\">,</span>
      <span class=\"sh\">\"</span><span class=\"s\">%Y:%m:%d %H:%M:%S</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n\n    <span class=\"c1\">#
      Assume the camera was set to match the timezone where the photo\n</span>    <span
      class=\"c1\"># was taken; convert the timestamp to UTC first.\n</span>    <span
      class=\"k\">return</span> <span class=\"n\">timezone</span><span class=\"p\">.</span><span
      class=\"nf\">localize</span><span class=\"p\">(</span><span class=\"n\">created_time</span><span
      class=\"p\">).</span><span class=\"nf\">astimezone</span><span class=\"p\">(</span><span
      class=\"n\">utc</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span>
      <span class=\"nf\">set_location</span><span class=\"p\">(</span><span class=\"n\">jpeg_path</span><span
      class=\"p\">,</span> <span class=\"o\">*</span><span class=\"p\">,</span> <span
      class=\"n\">location_info</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span
      class=\"s\">\n    Set the location information on a file using ``exiftool``.\n
      \   </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"c1\"># The Apple
      Watch locations record latitude/longitude/elevation\n</span>    <span class=\"c1\">#
      as a single value, whereas exiftool wants an absolute value\n</span>    <span
      class=\"c1\"># and a direction.\n</span>    <span class=\"c1\">#\n</span>    <span
      class=\"c1\"># e.g. the Apple Watch might record a position as (37.3346, -122.0090),\n</span>
      \   <span class=\"c1\"># which exiftool wants to see as (37.3346, N, 122.0090,
      W).\n</span>    <span class=\"n\">subprocess</span><span class=\"p\">.</span><span
      class=\"nf\">check_call</span><span class=\"p\">([</span>\n        <span class=\"sh\">\"</span><span
      class=\"s\">exiftool</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n
      \       <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">-GPSLatitude=</span><span
      class=\"si\">{</span><span class=\"nf\">abs</span><span class=\"p\">(</span><span
      class=\"n\">location_info</span><span class=\"p\">[</span><span class=\"sh\">'</span><span
      class=\"s\">latitude</span><span class=\"sh\">'</span><span class=\"p\">])</span><span
      class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n
      \       <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">-GPSLatitudeRef=</span><span
      class=\"si\">{</span><span class=\"sh\">\"</span><span class=\"s\">N</span><span
      class=\"sh\">\"</span> <span class=\"k\">if</span> <span class=\"n\">location_info</span><span
      class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">latitude</span><span
      class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"o\">&gt;</span>
      <span class=\"mi\">0</span> <span class=\"k\">else</span> <span class=\"sh\">'</span><span
      class=\"s\">S</span><span class=\"sh\">'</span><span class=\"si\">}</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"sa\">f</span><span
      class=\"sh\">\"</span><span class=\"s\">-GPSLongitude=</span><span class=\"si\">{</span><span
      class=\"nf\">abs</span><span class=\"p\">(</span><span class=\"n\">location_info</span><span
      class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">longitude</span><span
      class=\"sh\">'</span><span class=\"p\">])</span><span class=\"si\">}</span><span
      class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"sa\">f</span><span
      class=\"sh\">\"</span><span class=\"s\">-GPSLongitudeRef=</span><span class=\"si\">{</span><span
      class=\"sh\">\"</span><span class=\"s\">E</span><span class=\"sh\">\"</span>
      <span class=\"k\">if</span> <span class=\"n\">location_info</span><span class=\"p\">[</span><span
      class=\"sh\">'</span><span class=\"s\">longitude</span><span class=\"sh\">'</span><span
      class=\"p\">]</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span>
      <span class=\"k\">else</span> <span class=\"sh\">'</span><span class=\"s\">W</span><span
      class=\"sh\">'</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span>\n        <span class=\"sa\">f</span><span class=\"sh\">\"</span><span
      class=\"s\">-GPSAltitude=</span><span class=\"si\">{</span><span class=\"nf\">abs</span><span
      class=\"p\">(</span><span class=\"n\">location_info</span><span class=\"p\">[</span><span
      class=\"sh\">'</span><span class=\"s\">elevation</span><span class=\"sh\">'</span><span
      class=\"p\">])</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span>\n        <span class=\"sa\">f</span><span class=\"sh\">\"</span><span
      class=\"s\">-GPSAltitudeRef=</span><span class=\"si\">{</span><span class=\"sh\">\"</span><span
      class=\"s\">0</span><span class=\"sh\">\"</span> <span class=\"k\">if</span>
      <span class=\"n\">location_info</span><span class=\"p\">[</span><span class=\"sh\">'</span><span
      class=\"s\">elevation</span><span class=\"sh\">'</span><span class=\"p\">]</span>
      <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">else</span>
      <span class=\"sh\">'</span><span class=\"s\">1</span><span class=\"sh\">'</span><span
      class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n
      \       <span class=\"n\">jpeg_path</span>\n    <span class=\"p\">])</span>\n\n\n<span
      class=\"c1\"># See https://alexwlchan.net/2023/snake-walker/ for get_file_paths_under()\n</span><span
      class=\"k\">for</span> <span class=\"n\">jpeg_path</span> <span class=\"ow\">in</span>
      <span class=\"nf\">get_file_paths_under</span><span class=\"p\">(</span><span
      class=\"sh\">\"</span><span class=\"s\">100_OLYMP</span><span class=\"sh\">\"</span><span
      class=\"p\">,</span> <span class=\"n\">suffix</span><span class=\"o\">=</span><span
      class=\"sh\">\"</span><span class=\"s\">.jpg</span><span class=\"sh\">\"</span><span
      class=\"p\">):</span>\n\n    <span class=\"n\">slovenia</span> <span class=\"o\">=</span>
      <span class=\"n\">pytz</span><span class=\"p\">.</span><span class=\"nf\">timezone</span><span
      class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">Europe/Ljubljana</span><span
      class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">created_time</span>
      <span class=\"o\">=</span> <span class=\"nf\">get_created_time</span><span class=\"p\">(</span><span
      class=\"n\">jpeg_path</span><span class=\"p\">,</span> <span class=\"n\">camera_timezone</span><span
      class=\"o\">=</span><span class=\"n\">slovenia</span><span class=\"p\">)</span>\n\n
      \   <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">location_info</span>
      <span class=\"o\">=</span> <span class=\"n\">locations</span><span class=\"p\">[</span><span
      class=\"n\">created_time</span><span class=\"p\">]</span>\n    <span class=\"k\">except</span>
      <span class=\"nb\">KeyError</span><span class=\"p\">:</span>\n        <span
      class=\"k\">pass</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n
      \     <span class=\"nf\">set_location</span><span class=\"p\">(</span><span
      class=\"n\">jpeg_path</span><span class=\"p\">,</span> <span class=\"n\">location_info</span><span
      class=\"o\">=</span><span class=\"n\">location_info</span><span class=\"p\">)</span>\n</code></pre></div></div>\n\n<p>This
      code has a big assumption at its core: that my Watch will have recorded a location
      at the precise second I took each photo.\nIn practice, that seems to work well
      enough \u2013 I don\u2019t know if my Watch is doing second-by-second location,
      but I\u2019d stand still to take my photos, and it would record at least one
      data point in that time.\nAll my photos from Bohinj got tagged.</p>\n\n<p>If
      this was an issue, you could write a looser heuristic to matching photos to
      location data in the workout \u2013 for example, using any location that was
      recorded within a few seconds of the photo being taken.\nBut \u201Csame second\u201D
      worked fine for me, so that\u2019s all I\u2019ve done.</p>\n\n<p>After I ran
      this code, I did some spot-checking of individual photos \u2013 it took a few
      tries to get the timezone handling correct.\nI\u2019d taken a photo of the <em>\u201CWelcome
      to Bohinj\u201D</em> sign right after I got off the bus, and that turned out
      to be super helpful \u2013 I knew exactly where it was, and I could keep tweaking
      my code until that photo got the right location.</p>\n\n<p>I was once given
      a tip: when travelling between time zones, take a photo of a clock that\u2019s
      correctly set to the local time.\nThat way, you can easily correct the time
      offset later if your camera was configured incorrectly.\nIf I plan to reuse
      this location tagging code, I\u2019d use the same trick, but with a photo of
      something in a known location.</p>\n\n<hr>\n\n<p>Once this was done, I imported
      all the files into my Photos Library, and voila: I could see all my photos plotted
      on a map, even though I\u2019d taken them on a camera without GPS support.</p>\n\n<picture>\n
      \ \n\n<source srcset=\"/images/2023/photos_on_map.dark_1x.png 950w, /images/2023/photos_on_map.dark_2x.png
      1900w\" sizes=\"(max-width: 950px) 100vw, 950px\" type=\"image/png\" media=\"(prefers-color-scheme:
      dark)\"></source>\n\n\n  \n  \n  <source srcset=\"/images/2023/photos_on_map_1x.png
      950w, /images/2023/photos_on_map_2x.png 1900w\" sizes=\"(max-width: 950px) 100vw,
      950px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2023/photos_on_map_1x.png\"
      class=\"screenshot dark_aware\" alt=\"A map view of Lake Bohinj. Dotted around
      the map are small markers with a photo and number, showing the number of photos
      taken at that exact location.\" width=\"950\">\n</picture>\n\n<p>I\u2019m pretty
      happy with this project \u2013 for half an hour\u2019s work, I have a nicely-tagged
      set of photos and a better understanding of the location data recorded by my
      Apple Watch.</p>\n\n\n    <p>[If the formatting of this post looks odd in your
      feed reader, <a href=\"https://alexwlchan.net/2023/adding-watch-locations/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"python\"/>\n
      \   <category term=\"photo-management\"/>\n    <summary type=\"html\">My Apple
      Watch knows where I am, which is handy when I have a camera that doesn't.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">Fare-Wellcome Collection</title>\n
      \   <link href=\"https://alexwlchan.net/2023/fare-wellcome-collection/\" rel=\"alternate\"
      type=\"text/html\" title=\"Fare-Wellcome Collection\"/>\n    <published>2023-09-20T07:12:54+00:00</published>\n
      \   <updated>2023-09-20T07:12:54+00:00</updated>\n    <id>https://alexwlchan.net/2023/fare-wellcome-collection</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/fare-wellcome-collection/\"><![CDATA[\n<p>I
      still remember the first time I visited Wellcome Collection \u2013 just over
      seven years ago.\nI was living and working in the Cambridge at the time, and
      I\u2019d come into London for the day to hang out with a friend who lived near
      King\u2019s Cross.\nWe wandered up the Euston Road, popped into the British
      Library and the British Museum, and then\u2026 Wellcome Collection.</p>\n\n<figure>\n
      \ <picture>\n  \n  <source srcset=\"/images/2023/reading-room_1x.avif 750w,
      /images/2023/reading-room_2x.avif 1500w, /images/2023/reading-room_3x.avif 2250w\"
      sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/reading-room_1x.webp 750w, /images/2023/reading-room_2x.webp
      1500w, /images/2023/reading-room_3x.webp 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/webp\"></source>\n\n  <source srcset=\"/images/2023/reading-room_1x.jpg
      750w, /images/2023/reading-room_2x.jpg 1500w, /images/2023/reading-room_3x.jpg
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/reading-room_1x.jpg\" alt=\"The Reading Room at Wellcome
      Collection. A large, brightly-lit room with shelves interspersed with museum
      objects and comfy chairs.\" class=\"fullwidth_img\" width=\"750\">\n</picture>\n
      \ <figcaption>\n    We were enchanted by <a href=\"https://wellcomecollection.org/pages/Wvlk4yAAAB8A3ufp\">the
      Reading Room</a>, which is a pretty common experience.\n  </figcaption>\n</figure>\n\n<p>I\u2019d
      already been thinking about getting a new job, so when I saw an ad for software
      developers at Wellcome a week later, it felt like the universe was telling me
      something.\nI applied, I was hired, and I started at the beginning of 2017.</p>\n\n<p>After
      nearly seven years, it\u2019s time for something new.\nI\u2019m going to be
      leaving Wellcome at the end of September, and joining <a href=\"https://www.flickr.org/\">the
      Flickr Foundation</a> as their new Tech Lead.</p>\n\n<p>This was a bittersweet
      decision.\nI\u2019ve loved my time at Wellcome.\nI got to work with a fantastic
      group of people, who\u2019ve helped me grow and learn and fix my mistakes.\nI\u2019m
      a much better person now than I was in 2017, and much of that comes from the
      people I met at Wellcome.\n(Of whom there are far, far too many to name.)</p>\n\n<p>I\u2019ve
      been able to work on a number of cool projects while I\u2019ve been at Wellcome,
      including:</p>\n\n<ul>\n  <li>\n    <p>The <a href=\"https://wellcomecollection.org/collections\">unified
      collections search</a>, which combines records from across Wellcome\u2019s different
      catalogues into a single search box.\nThis was my first exposure to AWS, Elasticsearch
      and large-scale data pipelines, and I learnt a lot doing this project.</p>\n
      \ </li>\n  <li>\n    <p>The <a href=\"https://github.com/wellcomecollection/storage-service\">storage
      service</a>, which is the permanent storage for Wellcome Collection\u2019s digital
      collections.\nI\u2019m proud of how robust and reliable it\u2019s become, and
      working on this will be a highlight of my entire software engineering career.</p>\n
      \ </li>\n  <li>\n    <p>Helping to write Wellcome\u2019s first <a href=\"https://wellcome.org/news/our-trans-inclusion-policy-latest-step-making-wellcome-more-inclusive\">trans
      inclusion policy</a>.\nThis was a major milestone for the LGBTQ+ Staff Network,
      and helped me feel comfortable coming out at work in 2019.</p>\n  </li>\n  <li>\n
      \   <p>Getting my first experience of line management.\nI\u2019m immensely grateful
      that the team gave me feedback and patience in equal measure as I warmed up
      to this change \u2013 I made lots of mistakes in the first few months!</p>\n
      \ </li>\n</ul>\n\n<p>As I\u2019ve stepped into a more managerial role, one of
      the most gratifying things has been to watch people take something that I worked
      on, and find ways to make it better.\nThe architecture of the catalogue pipeline
      has been streamlined and improved, making it more reliable and efficient. The
      trans inclusion policy has been rewritten with more detail and clarity. People
      are finding new ways to use the data in the storage service.</p>\n\n<p>I\u2019m
      leaving behind a remarkable team of smart, thoughtful, and capable people.\nI
      hope Wellcome knows just how lucky they are to have them.</p>\n\n<p>At the start
      of October, I\u2019ll be joining <a href=\"https://www.flickr.org/\">the Flickr
      Foundation</a> as their Tech Lead.\nThe mission \u2013 keeping Flickr\u2019s
      pictures visible for 100 years \u2013 is a daunting one, but I\u2019m excited
      about the challenge.\nI start in just under a fortnight, and I\u2019m really
      looking forward to it.</p>\n\n<p>This is a role I couldn\u2019t have done back
      in 2017 \u2013 I had no experience designing large systems, or managing a team,
      or doing software in a group that wasn\u2019t just software engineers.\nThose
      are all things I learnt while working at Wellcome.</p>\n\n<p>I\u2019m immensely
      grateful for my time at Wellcome Collection, for all the people I got to meet
      there, and for everything I learnt that\u2019s enabling me take this next step.</p>\n\n\n
      \   <p>[If the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/fare-wellcome-collection/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"personal\"/>\n
      \   <category term=\"wellcome-collection\"/>\n    <summary type=\"html\">After
      nearly seven years, it's time for something new.</summary>\n  </entry>\n  <entry>\n
      \   <title type=\"html\">How I set up my Obsidian vaults</title>\n    <link
      href=\"https://alexwlchan.net/2023/obsidian-setup/\" rel=\"alternate\" type=\"text/html\"
      title=\"How I set up my Obsidian vaults\"/>\n    <published>2023-09-19T21:30:59+00:00</published>\n
      \   <updated>2023-09-19T21:30:59+00:00</updated>\n    <id>https://alexwlchan.net/2023/obsidian-setup</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/obsidian-setup/\"><![CDATA[\n<p>Obsidian
      still feels like my \u201Cnew\u201D app for managing my notes, but according
      to my daily journal I\u2019ve been using it for nearly three years.\nTime flies
      when you\u2019re organising information!</p>\n\n<p>I\u2019ve grown to really
      like it, and I expect to keep using it for a while to come.\nIts approach to
      tagging and linked notes fits my mental model, and there\u2019s a lot of flexibility
      in the plugin architecture.\nI can make it look nice, add a few basic features
      I want, and it syncs nicely across my Mac and my iPhone.</p>\n\n<p>Inspired
      by <a href=\"https://stephango.com/vault\">Steph Ango\u2019s example</a>, I
      thought it might be useful to write a little about how I structure my Obsidian
      vaults.\nMy setup is somewhat fluid, so consider this as more of a point-in-time
      snapshot than a definitive approach \u2013 I keep tweaking it as I find better
      ways to organise my notes.</p>\n\n<hr>\n\n<h1 id=\"my-vaults\">My vaults</h1>\n\n<p>I
      have two vaults:</p>\n\n<ul>\n  <li>My <strong>work</strong> vault has everything
      that\u2019s specific to my day job \u2013 meeting minutes, project plans, notes
      about ongoing work.\nThis is scoped to my current employer and lives on my work
      laptop \u2013 when I change jobs, I\u2019ll throw this vault away and create
      a new one.</li>\n  <li>My <strong>personal</strong> vault has everything else.</li>\n</ul>\n\n<p>The
      two vaults have the same structure, but different contents.\nUsually the distinction
      is pretty clear-cut, but occasionally there\u2019s some overlap.\nFor example,
      I learn about AWS in the course of my work.\nIf I learn something which is generically
      useful and not specific to my employer\u2019s setup, I\u2019ll put the notes
      in my personal vault rather than the work vault.</p>\n\n\n\n<figure id=\"screenshots\">\n
      \ <picture>\n  \n  \n  \n  <source srcset=\"/images/2023/obsidian-personal-theme_1x.png
      523w, /images/2023/obsidian-personal-theme_2x.png 1046w\" sizes=\"(max-width:
      523px) 100vw, 523px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2023/obsidian-personal-theme_1x.png\"
      class=\"screenshot first\" alt=\"A screenshot of a note and the top bar in my
      personal vault. The top bar has a red tint, and the title of the note is a matching
      shade of red. The note text is in a serif font (Geneva).\" width=\"523\">\n</picture>\n
      \ <picture>\n  \n  \n  \n  <source srcset=\"/images/2023/obsidian-work-theme_1x.png
      523w, /images/2023/obsidian-work-theme_2x.png 1046w\" sizes=\"(max-width: 523px)
      100vw, 523px\" type=\"image/png\"></source>\n\n  <img src=\"/images/2023/obsidian-work-theme_1x.png\"
      class=\"screenshot second\" alt=\"A screenshot of a note and the top bar in
      my work vault. The top bar has a yellow tint, but the title of the note is a
      dark green. The note text is in a sans serif font (Inter).\" width=\"523\">\n</picture>\n</figure>\n\n<p>I\u2019m
      using the <a href=\"https://minimal.guide/home\">Minimal theme</a>, and I use
      the <a href=\"https://minimal.guide/plugins/minimal-theme-settings\">Minimal
      Settings plugin</a> to give each vault a distinct appearance.\nI\u2019m a very
      visual person, and making the two vaults look different helps reinforce the
      distinction in my mind.\nI use a similar set of colour-based themes to help
      me distinguish between Slack workspaces.</p>\n\n<hr>\n\n\n\n<picture>\n  \n
      \ \n  \n  <source srcset=\"/images/2023/obsidian-tags_1x.png 299w, /images/2023/obsidian-tags_2x.png
      598w\" sizes=\"(max-width: 299px) 100vw, 299px\" type=\"image/png\"></source>\n\n
      \ <img src=\"/images/2023/obsidian-tags_1x.png\" class=\"screenshot\" id=\"obsidian_tags\"
      alt=\"A screenshot of my tag panel in Obsidian. There's a list of tags on the
      left-hand side, and counts down the right. The first few tags are daily-journal
      (773), books-ive-read (173), articles-to-write (124) and talks-ive-watched (97).
      There are also a couple of collapsed tag lists, which indicate prefixes, including
      'aws', 'event' and 'python'.\" width=\"299\">\n</picture>\n\n<h1 id=\"tags\">Tags</h1>\n\n<p>I\u2019m
      a <a href=\"https://alexwlchan.net/2019/my-scanning-setup/#how-should-i-organise-my-files\">big
      fan of keyword tagging</a>, and I use it in all my notes.\nEvery note has at
      least one tag; often multiple.</p>\n\n<p>I tag liberally, adding all the keywords
      that I think I might use to search for something later \u2013 I think of my
      tags as a <a href=\"https://idlewords.com/talks/fan_is_a_tool_using_animal.htm\">\u201Csearch
      engine in reverse\u201D</a>.\nIf I think I might look for a note in three different
      ways, I give it three different tags.</p>\n\n<p>I create lot of different tags
      \u2013 my primary vault has at least 800.\nThe distribution is very skewed,
      with maybe 50\_tags that I use a lot, and then a long tail of tags that are
      only used a handful of times.\nThis might seem messy to some people, but it
      works for me \u2013 even if a tag is only used once or twice, it\u2019s still
      useful for searching.</p>\n\n<p>I use prefixes as a way to namespace some of
      tags, like <code class=\"language-plaintext highlighter-rouge\">aws/amazon-s3</code>
      and <code class=\"language-plaintext highlighter-rouge\">python/pip</code>.\nThis
      helps keep my list of tags somewhat organised, but otherwise it\u2019s a bit
      of an inconsistent mess.\ne.g. I don\u2019t have any rules about singular vs
      plural</p>\n\n<p>I have different tags in each of my vaults, but I try to use
      the same tag in both places if it means the same thing.</p>\n\n<hr>\n\n<h1 id=\"folders\">Folders</h1>\n\n<p>I
      have a handful of top-level folders, and I put most notes in folders.\nBoth
      of my vaults have the same set of top-level folders.</p>\n\n<p>I try not to
      keep too many notes in my root \u2013 it\u2019s mostly brand new notes, stuff
      I\u2019m actively working on, or notes I refer to frequently.\nWhen I\u2019m
      finished working on a note, I move it into a folder.</p>\n\n<p>The folders I
      use:</p>\n\n<ul>\n  <li>\n    <p><strong>Attachments</strong> for images, audio,
      PDFs, and so on. Anything that isn\u2019t a text file.\nI use my <a href=\"/2022/obsidian-plugin/\">image
      gallery plugin</a> to browse the contents of this folder.</p>\n  </li>\n  <li>\n
      \   <p><strong>Ideas</strong> for anything I think of that I might like to do
      in the future, but don\u2019t want to do right now.\nThis includes ideas for
      projects, books I might like to read, half-finished blog posts, and more.\nI
      like being able to capture my ideas and then get them out of the way, without
      committing to finishing them.</p>\n\n    <p>Some of these entries are very long-lived,
      and I\u2019ve built them up over multiple years.\nI\u2019ll capture the initial
      spark of something, then go back and add more details as I think of them.\nThis
      accumulation of thoughts can be useful if I ever go back and actually do the
      thing.</p>\n  </li>\n  <li>\n    <p><strong>Journal</strong> is for all of my
      journal entries, or anything I\u2019ve done that\u2019s bound to a particular
      time (DIY, craft projects, holiday plans, and so on).</p>\n\n    <p>I have per-year
      folders to keep it manageable, but there\u2019s not a lot of consistency.\nI
      have my journal entries going back as far as 2009, and I\u2019ve had quite a
      few different approaches to journaling in that time!</p>\n  </li>\n  <li>\n
      \   <p><strong>People</strong> is for per-person notes.\nThese files are pretty
      small, and usually exist for easy linking rather than for in-depth notes.\nFor
      example, it\u2019s much easier to search for all journal entries linked to \u201CJane
      Smith\u201D than it is to search for all instances of the word \u201CJane\u201D.</p>\n\n
      \   <p>Occasionally I do put bits of info in somebody\u2019s note that isn\u2019t
      bound to a specific journal entry \u2013 food allergies, the names of their
      kids, gift preferences, and so on.</p>\n  </li>\n  <li>\n    <p><strong>Reference</strong>
      is for detailed notes on anything outside my vault \u2013 books I\u2019ve read,
      videos I\u2019ve watched, podcasts I\u2019ve listened to.\nI have subfolders
      for the different types of media.</p>\n  </li>\n  <li>\n    <p><strong>Snippets</strong>
      is for little bits of information I want to save. A cool tweet, an interesting
      word, some trivia fact.</p>\n  </li>\n</ul>\n\n<p>At least to me, it\u2019s
      always obvious which of these folders a note belongs in.\nThis has been a constant
      feature of all my folder setups \u2013 I want to be able to file notes immediately,
      without thinking.\nI don\u2019t want to be wondering where a particular note
      should be stored on a day-to-day basis.</p>\n\n\n    <p>[If the formatting of
      this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/obsidian-setup/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"obsidian\"/>\n
      \   <category term=\"taking-notes\"/>\n    <summary type=\"html\">The tags,
      folders, and themes I use to manage information in my Obsidian vaults.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">Finding a mystery IAM access
      key</title>\n    <link href=\"https://alexwlchan.net/2023/iam-keys/\" rel=\"alternate\"
      type=\"text/html\" title=\"Finding a mystery IAM access key\"/>\n    <published>2023-08-26T09:22:23+00:00</published>\n
      \   <updated>2023-08-26T09:22:23+00:00</updated>\n    <id>https://alexwlchan.net/2023/iam-keys</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/iam-keys/\"><![CDATA[\n<p>Recently
      I had an issue with some IAM keys.\nSomebody was trying to use an IAM access
      key to download some objects from S3, and it wasn\u2019t working \u2013 it was
      giving a \u201Cpermission denied\u201D error.\nI wanted to inspect the permissions,
      but first I had to find where this IAM key came from.\nIAM keys are associated
      with IAM users, but which user had this key?</p>\n\n<p>I found a couple of useful,
      new-to-me AWS APIs for doing this.</p>\n\n<ol>\n  <li>\n    <p>You can find
      the <strong>account ID</strong> using the <a href=\"https://docs.aws.amazon.com/STS/latest/APIReference/API_GetAccessKeyInfo.html\">GetAccessKeyInfo
      API</a>, for example:</p>\n\n    <div class=\"language-console highlighter-rouge\">\n<div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">$</span><span
      class=\"w\"> </span>aws sts get-access-key-info <span class=\"nt\">--access-key-id</span>
      AKIA3B6K4VLAVGRVTXJA\n<span class=\"go\">{\n  \"Account\": \"760097843905\"\n}\n</span></code></pre></div>
      \   </div>\n\n    <p>This should work when you authenticate as <em>any</em>
      IAM entity that has the <code class=\"language-plaintext highlighter-rouge\">sts:GetAccessKeyInfo</code>
      permission, even if it\u2019s in a different account to the key.</p>\n\n    <p>This
      is useful because the AWS estate at work is split over a dozen accounts, and
      some of the accounts have overlapping use cases.\nEven if you know roughly what
      a key is used for, it may not be obvious which account it\u2019s defined in.</p>\n
      \ </li>\n  <li>\n    <p>Once you know the account, you can find the <strong>username</strong>
      with the <a href=\"https://docs.aws.amazon.com/IAM/latest/APIReference/API_GetAccessKeyLastUsed.html\">GetAccessKeyLastUsed
      API</a>.\nYou\u2019ll need to authenticate as an IAM entity with the <code class=\"language-plaintext
      highlighter-rouge\">iam:GetAccessKeyLastUsed</code> permission in that particular
      account:</p>\n\n    <p>For example:</p>\n\n    <div class=\"language-console
      highlighter-rouge\">\n<div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>aws iam get-access-key-last-used
      <span class=\"nt\">--access-key-id</span> <span class=\"s2\">\"AKIA3B6K4VLAVGRVTXJA\"</span>\n<span
      class=\"go\">{\n    \"UserName\": \"example-user-2023-08-26\",\n    \"AccessKeyLastUsed\":
      {\n        \"LastUsedDate\": \"2023-08-24T15:58:00Z\",\n        \"ServiceName\":
      \"s3\",\n        \"Region\": \"eu-west-1\"\n    }\n}\n</span></code></pre></div>
      \   </div>\n\n    <p>Note that this works even if the access key has never actually
      been used, for example:</p>\n\n    <div class=\"language-console highlighter-rouge\">\n<div
      class=\"highlight\"><pre class=\"highlight\"><code><span class=\"gp\">$</span><span
      class=\"w\"> </span>aws iam get-access-key-last-used <span class=\"nt\">--access-key-id</span>
      <span class=\"s2\">\"AKIA3B6K4VLAVGRVTXJA\"</span>\n<span class=\"go\">{\n    \"UserName\":
      \"example-user-2023-08-26\",\n    \"AccessKeyLastUsed\": {\n        \"ServiceName\":
      \"N/A\",\n        \"Region\": \"N/A\"\n    }\n}\n</span></code></pre></div>
      \   </div>\n  </li>\n</ol>\n\n<p>I took these APIs and wrapped them in <a href=\"https://github.com/wellcomecollection/aws-account-infrastructure/blob/f06cb97094ddeab27c58ca2a6123de2b90511651/scripts/describe_iam_access_key.py\">a
      Python script</a> that takes an access key as input, and prints a bunch of information
      about the key and the associated user.\nThis is what it looks like:</p>\n\n<div
      class=\"language-console highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"gp\">$</span><span class=\"w\"> </span>python3 describe_iam_access_key.py
      AKIA3B6K4VLAVGRVTXJA\n<span class=\"go\">access key:       AKIA3B6K4VLAVGRVTXJA\naccount:
      \         platform (760097843905)\nusername:         example-user-2023-08-26\nkey
      created:      26 August 2023\nstatus:           Active\n\nIAM permissions:  example-user-2023-08-26.iam_permissions.txt\n\nconsole:
      \         https://us-east-1.console.aws.amazon.com/iamv2/home#/users/details/example-user-2023-08-26\nterraform:
      \       https://github.com/wellcomecollection/platform-infrastructure/tree/main/terraform/users\n</span></code></pre></div></div>\n\n<p>This
      script won\u2019t work for everyone \u2013 in particular, going from an AWS
      account ID to an authenticated IAM session is probably going to look different
      for every organisation, but a lot of the bigger pieces are reusable.</p>\n\n<p>Because
      the IAM permissions can be quite long and verbose, it saves them to a separate
      text file.\nIt also includes links to the IAM console and the Terraform configuration
      (and it can find the latter because <a href=\"/2023/tag-iac-resources/\">we
      tag the user with that link</a>).</p>\n\n<p>This script only works with long-term
      credentials created for an IAM user.\nIt doesn\u2019t work for temporary credentials
      using AWS STS \u2013 if you want to find out who owns the latter, you have to
      <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#Using_access-keys-audit\">review
      your CloudTrail logs</a> \u2013 but for my purposes, that\u2019s not an issue.</p>\n\n<p>When
      writing this script, one of the things I was pleasantly surprised by was the
      presence of AWS APIs that feel tailor-made for this use case.\nI was expecting
      I\u2019d have to loop through every account, every user, every access key, and
      look for one that matched, which could have been pretty slow.\nUsing these APIs
      was much simpler and quicker!</p>\n\n\n    <p>[If the formatting of this post
      looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/iam-keys/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"aws\"/>\n
      \   <category term=\"aws-iam\"/>\n    <summary type=\"html\">Using the GetAccessKeyInfo
      and GetAccessKeyLastUsed APIs can help us trace an IAM key back to its source.</summary>\n
      \ </entry>\n  <entry>\n    <title type=\"html\">A blue plaque for Hester</title>\n
      \   <link href=\"https://alexwlchan.net/2023/hester/\" rel=\"alternate\" type=\"text/html\"
      title=\"A blue plaque for Hester\"/>\n    <published>2023-08-19T07:14:31+00:00</published>\n
      \   <updated>2023-08-19T07:14:31+00:00</updated>\n    <id>https://alexwlchan.net/2023/hester</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/hester/\"><![CDATA[\n<p>In
      the last year, my theatre trips have been dominated by <a href=\"https://www.operationmincemeat.com/\"><em>Operation
      Mincemeat</em></a>, a comedy musical currently playing in the Fortune Theatre.\nThe
      writing is clever, the songs are catchy, and it\u2019s laugh-a-minute funny,
      but it can also be solemn and moving.</p>\n\n<p>The show is based on the real-life
      wartime deception operation <a href=\"https://en.wikipedia.org/wiki/Operation_Mincemeat\">of
      the same name</a>.\nBritish spies took a corpse, dressed him as a pilot with
      a suitcase full of fake documents, and let him wash up on the coast of Spain
      \u2013 feeding the Nazis false information about the planned invasion of Sicily.</p>\n\n<p>Making
      a musical about Second World War espionage is a delicate balancing act.\nYou
      want to write jokes so the audience have fun, but you don\u2019t want to trivialise
      the horror and suffering of war.\nI think the show handles this pretty well
      \u2013 there\u2019s lots of laughter, but every so often the theatre falls silent
      as we\u2019re reminded that <em>\u201Cthese men\u2019s lives are not a joke\u201D</em>.\n(This
      line was added in the West End transfer, and it\u2019s one of my favourites.)</p>\n\n<hr>\n\n<p>The
      emotional high point of the show is <em>Dear Bill</em>, a solo in which a quiet
      secretary (Jak Malone, Christian Andrews) writes a fake love letter for the
      fictional Allied pilot. All the jokes fade away, and we realise the letter isn\u2019t
      as fake as we thought. It\u2019s a moving and powerful number, and I still cry
      every time I hear it.</p>\n\n<p>The secretary is Hester Leggatt, a real woman
      who really did work on Operation Mincemeat.\nShe was the head of the MI5 secretaries,
      and she wrote the letter that went in the pilot\u2019s briefcase.\nSeveral of
      the lines in the song are taken directly from her words. (<em>\u201CDarling,
      why did we go and meet in the middle of a war, such a silly thing for anybody
      to do.\u201D</em>)</p>\n\n\n\n<figure id=\"jak_on_stage\">\n  <picture>\n  \n
      \ <source srcset=\"/images/2023/jak-on-stage_1x.avif 270w, /images/2023/jak-on-stage_2x.avif
      540w\" sizes=\"(max-width: 270px) 100vw, 270px\" type=\"image/avif\"></source>\n\n
      \ <source srcset=\"/images/2023/jak-on-stage_1x.webp 270w, /images/2023/jak-on-stage_2x.webp
      540w\" sizes=\"(max-width: 270px) 100vw, 270px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/jak-on-stage_1x.jpg 270w, /images/2023/jak-on-stage_2x.jpg
      540w\" sizes=\"(max-width: 270px) 100vw, 270px\" type=\"image/jpeg\"></source>\n\n
      \ <img src=\"/images/2023/jak-on-stage_1x.jpg\" alt=\"A senior officer (Colonel
      Bevan, played by Zo\xEB Roberts) looks on sceptically at something happening
      out of shot. Standing next to him, Hester (Jak Malone) stands sternly, her head
      held down in disapproval.\" width=\"270\">\n</picture>\n  <figcaption>\n    Hester
      (Malone, right) had a reputation as the stern, uptight, office matriarch.\n
      \   In the show, we get to see another side to her.\n  </figcaption>\n</figure>\n\n<p>Beautiful
      as it is, I don\u2019t think <em>Dear Bill</em> can stand on its own. It shows
      us the pain in Hester\u2019s heart; the grief of her lost lover; a tragedy she
      has kept from her coworkers \u2013 but that can\u2019t be her whole arc. Nothing
      can ever bring Tom back, but we want to see her begin to heal.</p>\n\n<p>That
      healing starts to come in the second act song <em>Useful</em>. Hester is talking
      to Jean Leslie, another MI5 secretary (Claire-Marie\_Hall, Holly Sumpton), about
      how they can both be useful even if their contributions aren\u2019t recognised
      by the men in charge. The song calls back to <em>Dear Bill</em>, echoing its
      lyrics as Jean tells Hester how much she\u2019s grown under Hester\u2019s supervision.\nIt\u2019s
      a beautiful moment of realisation, as Hester sees how much Jean looks up to
      her.</p>\n\n<p>The song has a sad ring of truth \u2013 Hester wasn\u2019t considered
      important by history, and SpitLip (the writers of the show) <a href=\"https://twitter.com/spitlip/status/1667806430831734784\">struggled
      to find much information about her</a>.\nUnlike the men whose histories were
      extensively documented and recorded, Hester died almost without trace.</p>\n\n<p>But
      after falling in love with her, the show\u2019s \u201CMincefluencer\u201D fandom
      have been righting this wrong \u2013 there\u2019s been <a href=\"https://www.independent.co.uk/voices/world-war-operation-mincemeat-musical-theatre-b2371745.html\">an
      extensive investigation</a> to learn more about her, and to uncover her life
      story.\nI haven\u2019t been part of this, but I\u2019ve been watching the #find-hester
      channel in the Discord, and the amount they\u2019ve found is quite astounding.</p>\n\n<p>One
      of the perennial topics is the idea of getting Hester a <a href=\"https://en.wikipedia.org/wiki/Blue_plaque\">blue
      plaque</a> to commemorate her life.\nIt\u2019s not clear whether she would qualify,
      and so this hasn\u2019t happened.\n(Yet.)</p>\n\n<p>But the other night I was
      sitting in the theatre, and I heard Jak sing the line <em>\u201Cperhaps just
      a small plaque, something tasteful and small\u201D</em>.\nI thought of all the
      fan discussions, and I decided to take matters into my own hands.</p>\n\n<hr>\n\n<p>I
      had some spare blue cross-stitch fabric from <a href=\"/2022/saturn-v/\">my
      <em>Saturn V</em> blueprint</a>, and I have plenty of white thread.\nThat\u2019s
      basically a plaque, right?\nI started sketching out a design \u2013 blue plaques
      usually have the name of the person, their dates, and a line or two about why
      they\u2019re worth remembering.</p>\n\n<p>I already had her name, which is \u201CLeggatt\u201D
      with an \u201Ca\u201D \u2013 at some point a transcription error had corrupted
      this to \u201CLeggett\u201D in the popular record, making her harder to track
      down.\nThis error was found by the fandom research.\nThat research also gave
      me her dates (1905\u20131995), and then I used one of Jean\u2019s lines as her
      description (<em>\u201Ca timeless inspiration\u201D</em>).</p>\n\n<p>For the
      letters themselves, I used two fonts.\nHer name is written in Needlework Gazette\u2019s
      <a href=\"https://www.wonderfulstitches.com/fancy-alphabet\">Fancy Alphabet</a>
      (three strands of cross-stitch), and the rest of the text is in StitchPoint\u2019s
      <a href=\"https://stitchpoint.com/eng/tool/alph/cross-stitch-writer.php\">Monaco</a>
      (two strands of back-stitch).\nI planned out the rough shape in a spreadsheet,
      made a few adjustments to the spacing between letters, and then I stitched it
      up.</p>\n\n<p>I mounted the piece in a 6\u2033 hoop which I\u2019d painted white,
      and I gave it to Jak on stage door a few weeks ago.\nI futzed a bit of the glue,
      but otherwise I\u2019m pretty pleased with the result.\nI\u2019m told that it
      now hangs backstage at the Fortune, among other pieces of fan art.</p>\n\n<picture>\n
      \ \n  <source srcset=\"/images/2023/a-small-plaque_1x.avif 750w, /images/2023/a-small-plaque_2x.avif
      1500w, /images/2023/a-small-plaque_3x.avif 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/avif\"></source>\n\n  <source srcset=\"/images/2023/a-small-plaque_1x.webp
      750w, /images/2023/a-small-plaque_2x.webp 1500w, /images/2023/a-small-plaque_3x.webp
      2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" type=\"image/webp\"></source>\n\n
      \ <source srcset=\"/images/2023/a-small-plaque_1x.jpg 750w, /images/2023/a-small-plaque_2x.jpg
      1500w, /images/2023/a-small-plaque_3x.jpg 2250w\" sizes=\"(max-width: 750px)
      100vw, 750px\" type=\"image/jpeg\"></source>\n\n  <img src=\"/images/2023/a-small-plaque_1x.jpg\"
      alt=\"Some embroidery on blue fabric with a circular frame. There's white text
      that says \u201CHester Leggatt / a timeless inspiration / 1905\u20131995\u201D.
      I\u2019m holding it in the auditorium of the Fortune Theatre, where the play
      is being shown \u2013 some seats are visible in the background, along with the
      bright yellow curtain on stage.\" width=\"750\">\n</picture>\n\n<p>It\u2019s
      not a garden or a grand royal park, but I hope Hester would like it all the
      same.</p>\n\n\n    <p>[If the formatting of this post looks odd in your feed
      reader, <a href=\"https://alexwlchan.net/2023/hester/\">visit the original article</a>]</p>\n
      \   ]]></content>\n    <category term=\"theatre\"/>\n    <category term=\"cross-stitch\"/>\n
      \   <category term=\"operation-mincemeat\"/>\n    <summary type=\"html\">Making
      a small memorial to a forgotten secretary who helped pull off one of the most
      daring deceptions of WWII.</summary>\n  </entry>\n  <entry>\n    <title type=\"html\">Tag
      your infrastructure-as-code resources with a link to their definitions</title>\n
      \   <link href=\"https://alexwlchan.net/2023/tag-iac-resources/\" rel=\"alternate\"
      type=\"text/html\" title=\"Tag your infrastructure-as-code resources with a
      link to their definitions\"/>\n    <published>2023-08-18T08:04:30+00:00</published>\n
      \   <updated>2023-08-18T08:04:30+00:00</updated>\n    <id>https://alexwlchan.net/2023/tag-iac-resources</id>\n
      \   <content type=\"html\" xml:base=\"https://alexwlchan.net/2023/tag-iac-resources/\"><![CDATA[\n<p>The
      aspiration of <a href=\"https://en.wikipedia.org/wiki/Infrastructure_as_code\">infrastructure-as-code
      tools</a> is that you use them to manage <em>everything</em>.\nYou create all
      your resources by writing a file that defines them, and any time you change
      something, you update the definition in that file.\nIt\u2019s a nice idea, but
      easier said than done.</p>\n\n<p>Creating the resources with infrastructure-as-code
      isn\u2019t too bad; the tricky part is updating them later.\nIf you have a large
      or thorny codebase, it may not be obvious where a particular resource is defined
      \u2013 when you want to make changes, which file should you update?</p>\n\n<p>If
      you\u2019re in a hurry, it\u2019s tempting to make a manual change now, and
      tell yourself you\u2019ll come back to update the code \u201Clater\u201D \u2013
      when you have more time to find the file \u2013 but \u201Clater\u201D rarely
      comes.</p>\n\n<p>To make this easier, I recommend tagging all your resources
      with a link to the file where the resource is defined.</p>\n\n<hr>\n\n<p>At
      work, we\u2019re managing AWS resources defined in Terraform.\nThe Terraform
      AWS Provider supports setting <a href=\"https://www.hashicorp.com/blog/default-tags-in-the-terraform-aws-provider\">default
      tags</a> \u2013 you write them once, and then they get applied to every resource
      that can be tagged.\nThis is what that looks like for us:</p>\n\n<div class=\"language-hcl
      highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span
      class=\"nx\">provider</span> <span class=\"s2\">\"aws\"</span> <span class=\"p\">{</span>\n
      \ <span class=\"nx\">default_tags</span> <span class=\"p\">{</span>\n    <span
      class=\"nx\">tags</span> <span class=\"p\">=</span> <span class=\"p\">{</span>\n
      \     <span class=\"nx\">TerraformConfigurationURL</span> <span class=\"p\">=</span>
      <span class=\"s2\">\"https://github.com/wellcomecollection/aws-account-infrastructure/tree/main/accounts/storage\"</span>\n
      \   <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n\n<p>The
      <code class=\"language-plaintext highlighter-rouge\">TerraformConfigurationURL</code>
      points to a specific subfolder of a GitHub repository, which is where this particular
      set of Terraform configuration files are stored.</p>\n\n<p>If we\u2019re looking
      at a resource in the AWS console, we can look for the <code class=\"language-plaintext
      highlighter-rouge\">TerraformConfigurationURL</code> tag.\nIf it\u2019s there,
      we can follow the URL to find the Terraform where the resource is defined.</p>\n\n<p>This
      is particularly simple with Terraform and AWS, because of the support for default
      tags.\nIt might be more cumbersome if you\u2019re using a different tool or
      managing different types of resources, but I still think it\u2019s worth the
      benefits.</p>\n\n<hr>\n\n<p>I originally created these tags to solve the \u201Cwhere
      is this thing defined\u201D problem.\nI\u2019ve found something in the AWS console,
      I want to make a change to it, and I want to find the Terraform definition so
      I can manage the change using infrastructure-as-code.\nIt has been useful for
      that, but it\u2019s also been helpful in other, unexpected ways.</p>\n\n<p>On
      one occasion, they highlighted some resources that were defined in multiple
      places.\nWe could see two Terraform configurations fighting over the value of
      the <code class=\"language-plaintext highlighter-rouge\">TerraformConfigurationURL</code>
      tag \u2013 one would set it to A, the other would set it to B, the first would
      set it back to A, and so on.\nThis conflict helped us find and delete the duplicate
      definition.</p>\n\n<p>It\u2019s also been a good way to find resources that
      aren\u2019t managed with infrastructure-as-code.\nBecause this tag should be
      applied to everything that\u2019s managed with Terraform, anything without this
      tag was probably created some other way.</p>\n\n<p>Some of our AWS infrastructure
      predates our use of Terraform, and we\u2019ve been trying to bring it into Terraform
      \u2013 looking for resources that don\u2019t have this tag is one way to do
      that.\nI also check for this tag as part of our security audits, looking for
      untagged IAM users that might have been created quietly for malicious purposes.</p>\n\n<p>As
      with any tagging strategy, it\u2019s not perfect.\nNot every resource supports
      tagging, and we haven\u2019t always remembered to create these tags \u2013 but
      it\u2019s good enough.\nWe have enough resources using this tag for it to be
      useful, and it\u2019s been handy on plenty of occasions.</p>\n\n\n    <p>[If
      the formatting of this post looks odd in your feed reader, <a href=\"https://alexwlchan.net/2023/tag-iac-resources/\">visit
      the original article</a>]</p>\n    ]]></content>\n    <category term=\"aws\"/>\n
      \   <category term=\"terraform\"/>\n    <summary type=\"html\">Applying a default
      tag that points to the IaC definition makes it easy to go from the console to
      the code.</summary>\n  </entry>\n</feed>\n\n"
    headers:
      Accept-Ranges:
      - bytes
      Age:
      - '5259'
      Cache-Control:
      - public,max-age=0,must-revalidate
      Cache-Status:
      - '"Netlify Edge"; hit'
      Content-Encoding:
      - gzip
      Content-Length:
      - '94404'
      Content-Type:
      - application/xml
      Date:
      - Wed, 24 Apr 2024 09:23:41 GMT
      Etag:
      - '"0000324632b28b40f5c5b54eddbc91a4-ssl-df"'
      Server:
      - Netlify
      Strict-Transport-Security:
      - max-age=31536000
      Vary:
      - Accept-Encoding
      X-Nf-Request-Id:
      - 01HW7PNZN8DBTA1RMHHKPY0NP0
    http_version: HTTP/1.1
    status_code: 200
- request:
    body: ''
    headers:
      accept:
      - '*/*'
      accept-encoding:
      - gzip, deflate
      connection:
      - keep-alive
      host:
      - alexwlchan.net
      if-modified-since:
      - Wed, 24 Apr 2024 09:23:41 UTC
      user-agent:
      - python-httpx/0.26.0
    method: GET
    uri: https://alexwlchan.net/atom.xml
  response:
    content: ''
    headers:
      Cache-Control:
      - public,max-age=0,must-revalidate
      Cache-Status:
      - '"Netlify Edge"; hit'
      Date:
      - Wed, 24 Apr 2024 09:23:41 GMT
      Etag:
      - '"0000324632b28b40f5c5b54eddbc91a4-ssl-df"'
      Server:
      - Netlify
      Strict-Transport-Security:
      - max-age=31536000
      Vary:
      - Accept-Encoding
      X-Nf-Request-Id:
      - 01HW7PP06XE53CSHH533E5C7NN
    http_version: HTTP/1.1
    status_code: 304
version: 1
